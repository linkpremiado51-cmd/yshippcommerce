<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistir Vídeo</title>
    <style>
        body { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background: #1a1a1a; font-family: 'Segoe UI', sans-serif; }
        .container { text-align: center; padding: 20px; background: #111; border-radius: 16px; box-shadow: 0 8px 25px rgba(0,0,0,0.6); max-width: 90%; }
        img { max-width: 100%; height: auto; border-radius: 12px; margin-bottom: 20px; border: 2px solid #333; }
        .btn { padding: 14px 36px; font-size: 20px; font-weight: bold; color: white; background: linear-gradient(135deg, #ff6b6b, #ff8e53); border: none; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(255,107,107,0.4); }
        .btn:hover { transform: translateY(-3px); background: linear-gradient(135deg, #ff5252, #ff7043); box-shadow: 0 6px 20px rgba(255,82,82,0.6); }
    </style>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
</head>
<body>
    <div class="container">
        <img src="https://i.postimg.cc/6Qwvq5qZ/IMG-20251102-221221.jpg" alt="Prévia">
        <br>
        <button class="btn" id="assistirBtn">Assistir</button>
    </div>

    <script>
        // === CONFIGURAÇÃO DO PROJETO "sorteio-mega-sorte" ===
        const firebaseConfig = {
            apiKey: "AIzaSyA9vB_annutvZByThKrsPJbsP9VZ7gyWB0",
            authDomain: "sorteio-mega-sorte.firebaseapp.com",
            projectId: "sorteio-mega-sorte",
            storageBucket: "sorteio-mega-sorte.appspot.com",
            messagingSenderId: "776750928407",
            appId: "1:776750928407:web:72da06debB97302b5c252"
            // measurementId: "G-6DZ7030N00"  ← opcional
        };

        // Inicializa Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // === VERIFICA SE O USUÁRIO ESTÁ LOGADO (invisível) ===
        let isAuthenticated = false;
        let userId = null;

        auth.onAuthStateChanged((user) => {
            if (user) {
                isAuthenticated = true;
                userId = user.uid;
            } else {
                isAuthenticated = false;
                userId = null;
            }
        });

        // === REGISTRA ACESSO/CLIQUE NO FIRESTORE ===
        function registrar(tipo) {
            db.collection("cliques").add({
                tipo: tipo,
                videoId: "68a561a740be4",
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                referrer: document.referrer || "direto",
                url: window.location.href,
                isAuthenticated: isAuthenticated,
                userId: userId || "anônimo"
            }).catch(err => {
                console.error("Erro ao salvar:", err);
            });
        }

        // Acesso à página
        window.addEventListener("load", () => {
            setTimeout(() => registrar("acesso"), 800);
        });

        // Clique no botão
        document.getElementById("assistirBtn").addEventListener("click", () => {
            registrar("clique");

            // Gate + redirecionamento
            localStorage.setItem('finalVideoUrl', 'https://pt.pornhub.com/view_video.php?viewkey=68a561a740be4');
            const gate = window.open('https://www.effectivegatecpm.com/gi25c6365j?key=67989d4028b5c809586132717898b1cb', '_blank');

            const check = setInterval(() => {
                if (gate.closed) {
                    clearInterval(check);
                    const url = localStorage.getItem('finalVideoUrl');
                    if (url) {
                        localStorage.removeItem('finalVideoUrl');
                        window.location.href = url;
                    }
                }
            }, 1000);
        });
    </script>
</body>
</html>
