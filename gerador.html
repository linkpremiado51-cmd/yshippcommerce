<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Gerencie sua carteira e ganhe Golds visualizando propagandas no YshippCommerce">
  <title>Gerador - YshippCommerce</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>
  <style>
    :root {
      --background: #f5f7fa;
      --surface: #ffffff;
      --text-primary: #1a202c;
      --text-secondary: #4a5568;
      --primary: #2d3748;
      --primary-hover: #1a202c;
      --secondary: #3182ce;
      --secondary-hover: #2b6cb0;
      --border: #e2e8f0;
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.15);
      --accent: #e53e3e;
      --gold: #d69e2e;
      --reais: #10b981;
      --progress-bg: #edf2f7;
      --tutorial-bg: #3498db;
      --tutorial-hover: #2980b9;
      --button-bg: #9ca3af;
      --button-hover: #6b7280;
      --nsfw-bg: #e74c3c;
      --nsfw-hover: #c0392b;
      --crypto: #e74c3c;
      --tasks: #8e44ad;
      --surveys: #27ae60;
      --afiliado: #d69e2e;
    }
    [data-theme="dark"] {
      --background: #1a202c;
      --surface: #2d3748;
      --text-primary: #e2e8f0;
      --text-secondary: #a0aec0;
      --border: #4a5568;
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.4);
      --accent: #f56565;
      --gold: #e6a24b;
      --reais: #059669;
      --progress-bg: #4a5568;
      --tutorial-bg: #1e90ff;
      --tutorial-hover: #1c86ee;
      --button-bg: #6b7280;
      --button-hover: #4b5563;
      --nsfw-bg: #c0392b;
      --nsfw-hover: #a5281a;
      --crypto: #c0392b;
      --tasks: #6c3483;
      --surveys: #1b5e20;
      --afiliado: #b7791f;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      user-select: none;
      -webkit-user-select: none;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--background);
      color: var(--text-primary);
      line-height: 1.5;
      min-height: 100vh;
      padding-top: 60px;
      overflow-x: hidden;
    }
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 16px;
      z-index: 1001;
      box-shadow: var(--shadow);
    }
    .header h1 {
      font-size: 1.125rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .header h1 i {
      color: var(--primary);
    }
    .top-bar__section {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .top-bar__icon {
      color: var(--text-primary);
      background: none;
      border: none;
      padding: 8px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .top-bar__icon i {
      font-size: 1.125rem;
    }
    .top-bar__icon:hover {
      background: var(--primary);
      color: white;
    }
    .menu {
      position: fixed;
      top: 60px;
      left: 0;
      width: 240px;
      height: calc(100vh - 60px);
      background: var(--surface);
      border-right: 1px solid var(--border);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
      box-shadow: var(--shadow);
    }
    .menu.open {
      transform: translateX(0);
    }
    .menu__list {
      list-style: none;
      padding: 12px 0;
    }
    .menu__item {
      margin: 4px 12px;
    }
    .menu__link {
      color: var(--text-primary);
      text-decoration: none;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      border-radius: 4px;
      transition: background 0.2s ease;
      background: transparent;
    }
    .menu__link:hover {
      background: var(--primary);
      color: white;
    }
    .menu__link i {
      margin-right: 8px;
      font-size: 1.125rem;
      color: var(--text-secondary);
      transition: color 0.2s ease;
    }
    .menu__link:hover i {
      color: white;
    }
    .notification {
      position: fixed;
      bottom: 16px;
      right: 16px;
      padding: 8px 16px;
      background: var(--surface);
      color: var(--text-primary);
      border-radius: 4px;
      box-shadow: var(--shadow-lg);
      opacity: 0;
      transform: translateY(16px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 2000;
    }
    .notification.show {
      opacity: 1;
      transform: translateY(0);
    }
    .balance-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 0.75rem;
      width: 100%;
      max-width: 1000px;
      padding: 0.75rem;
      margin: 0 auto;
    }
    .balance-card {
      border-radius: 8px;
      padding: 1rem;
      color: white;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .balance-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }
    .balance-card.gold {
      background: linear-gradient(135deg, var(--gold), #b7791f);
    }
    .balance-card.reais {
      background: linear-gradient(135deg, var(--reais), #059669);
    }
    .balance-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      opacity: 0.9;
      margin-bottom: 0.3rem;
      font-weight: 500;
    }
    .balance-amount {
      font-size: 1.5rem;
      font-weight: 600;
    }
    .balance-desc {
      font-size: 0.8rem;
      opacity: 0.85;
      margin-top: 0.3rem;
    }
    .ads-section {
      width: 100%;
      max-width: 1000px;
      padding: 1rem;
      background: var(--surface);
      border-radius: 8px;
      box-shadow: var(--shadow);
      margin: 1rem auto;
      border: 1px solid var(--border);
    }
    .ads-section h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .ads-section h2 i {
      color: var(--secondary);
    }
    .ads-section > p {
      color: var(--text-secondary);
      font-size: 0.85rem;
      margin-bottom: 0.75rem;
    }
    .carousel-container {
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      display: flex;
      gap: 0.75rem;
      padding: 0 0.75rem 0.75rem;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    .carousel-container::-webkit-scrollbar {
      display: none;
    }
    .carousel-container .ad-card {
      flex: 0 0 calc(100% - 1.5rem);
      max-width: 100%;
      scroll-snap-align: start;
      min-height: 280px;
    }
    .ad-card {
      background: var(--background);
      border-radius: 8px;
      padding: 1rem;
      box-shadow: var(--shadow);
      transition: all 0.2s ease;
      border: 1px solid var(--border);
      position: relative;
      display: flex;
      flex-direction: column;
    }
    .ad-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }
    .ad-card h3 {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: var(--text-primary);
    }
    .ad-card .steps-list {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
      flex-grow: 1;
    }
    .ad-card .steps-list ul {
      list-style-type: disc;
      padding-left: 1rem;
    }
    .ad-card .steps-list li {
      margin-bottom: 0.25rem;
    }
    .ad-card .golds-reward {
      font-size: 0.8rem;
      color: var(--text-primary);
      margin: 0.75rem 0;
      text-align: center;
    }
    .ad-card .view-button {
      width: 100%;
      padding: 0.5rem;
      background: var(--button-bg);
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease;
      margin-top: auto;
    }
    .ad-card .view-button:hover {
      background: var(--button-hover);
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .modal-content {
      background: var(--surface);
      padding: 1rem;
      border-radius: 8px;
      text-align: center;
      max-width: 90%;
      width: 480px;
      box-shadow: var(--shadow-lg);
    }
    .modal-content h2 {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    .modal-content p {
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
      font-size: 0.85rem;
    }
    .modal-content input {
      padding: 0.5rem;
      margin-bottom: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 0.85rem;
      width: 100%;
      max-width: 300px;
    }
    .modal-content button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .modal-content button.cancel {
      background: white;
      color: var(--text-primary);
      border: 1px solid var(--border);
    }
    .modal-content button:not(.cancel) {
      background: var(--secondary);
      color: white;
    }
    .modal-content button:hover:not(.cancel) {
      background: var(--secondary-hover);
    }
    .cookie-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--surface);
      color: var(--text-primary);
      padding: 0.75rem;
      box-shadow: var(--shadow);
      border-top: 1px solid var(--border);
      z-index: 1000;
      display: none;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
      text-align: center;
    }
    .cookie-banner.active {
      display: flex;
    }
    .cookie-banner .content {
      font-size: 0.8rem;
    }
    .cookie-banner .content a {
      color: var(--secondary);
      text-decoration: underline;
    }
    .cookie-banner .content a:hover {
      color: var(--secondary-hover);
    }
    .cookie-banner .buttons {
      display: flex;
      gap: 0.5rem;
    }
    .cookie-banner button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .cookie-banner button.accept {
      background: var(--secondary);
      color: white;
    }
    .cookie-banner button.accept:hover {
      background: var(--secondary-hover);
    }
    .cookie-banner button.decline {
      background: white;
      color: var(--text-primary);
      border: 1px solid var(--border);
    }
    .cookie-banner button.decline:hover {
      background: var(--accent);
      color: white;
    }
    #loadingOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      font-size: 1rem;
      z-index: 9999;
    }
    #userStatus {
      background: var(--primary);
      color: white;
      padding: 0.3rem 0.5rem;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 9999;
      font-size: 0.75rem;
    }
    footer#userInfoFooter {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--primary);
      color: white;
      text-align: center;
      padding: 0.3rem;
      font-size: 0.8rem;
      border-top: 1px solid var(--border);
      z-index: 999;
      font-family: 'Inter', sans-serif;
    }
    .info-card {
      width: 100%;
      max-width: 1000px;
      border-radius: 8px;
      padding: 1rem;
      color: white;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 0.5rem auto;
    }
    .info-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }
    .info-card.links {
      background: linear-gradient(135deg, var(--tutorial-bg), var(--tutorial-hover));
    }
    .info-card.crypto {
      background: linear-gradient(135deg, var(--crypto), var(--nsfw-hover));
    }
    .info-card.tasks {
      background: linear-gradient(135deg, var(--tasks), #6c3483);
    }
    .info-card.surveys {
      background: linear-gradient(135deg, var(--surveys), #1b5e20);
    }
    .info-card.afiliado {
      background: linear-gradient(135deg, var(--afiliado), #b7791f);
    }
    .info-card .info-text {
      font-size: 0.8rem;
      line-height: 1.4;
    }
    .info-card .hamburger-btn {
      background: none;
      border: none;
      color: white;
      font-size: 1.125rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 4px;
      transition: background 0.2s ease;
    }
    .info-card .hamburger-btn:hover {
      background: rgba(0, 0, 0, 0.1);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in {
      animation: fadeIn 0.4s ease-out forwards;
    }
    @media (max-width: 768px) {
      .menu {
        width: min(80vw, 240px);
      }
      .header {
        padding: 0 12px;
      }
      .top-bar__icon {
        padding: 6px;
      }
      .top-bar__icon i {
        font-size: 1rem;
      }
      .menu__link {
        padding: 8px 10px;
        font-size: 0.85rem;
      }
      .menu__link i {
        font-size: 1rem;
      }
      .notification {
        right: 8px;
        bottom: 8px;
        padding: 8px 12px;
      }
      .balance-cards {
        padding: 0.5rem;
      }
      .balance-card {
        padding: 0.75rem;
      }
      .balance-amount {
        font-size: 1.25rem;
      }
      .ads-section {
        padding: 0.75rem;
      }
      .ads-section h2 {
        font-size: 1.125rem;
      }
      .carousel-container .ad-card {
        flex: 0 0 calc(100% - 1rem);
      }
      .ad-card {
        padding: 0.75rem;
      }
      .ad-card h3 {
        font-size: 1rem;
      }
      .ad-card .steps-list {
        font-size: 0.75rem;
      }
      .ad-card .golds-reward {
        font-size: 0.75rem;
      }
      .ad-card .view-button {
        font-size: 0.8rem;
        padding: 0.5rem;
      }
      .modal-content {
        padding: 0.75rem;
        width: 95%;
      }
      .modal-content h2 {
        font-size: 1rem;
      }
      .modal-content p {
        font-size: 0.8rem;
      }
      .modal-content input {
        font-size: 0.8rem;
        padding: 0.4rem;
      }
      .modal-content button {
        font-size: 0.8rem;
        padding: 0.5rem;
      }
      .cookie-banner .content {
        font-size: 0.75rem;
      }
      .cookie-banner button {
        font-size: 0.75rem;
      }
      .info-card {
        padding: 0.75rem;
      }
      .info-card .info-text {
        font-size: 0.75rem;
      }
      .info-card .hamburger-btn {
        font-size: 1rem;
      }
    }
    @media (min-width: 601px) and (max-width: 1024px) {
      .header h1 {
        font-size: 1.125rem;
      }
      .balance-cards {
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      }
      .ads-section {
        padding: 0.75rem;
      }
      .ads-section h2 {
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body data-theme="light">
  <div id="loadingOverlay">Carregando dados do gerador...</div>
  <div id="userStatus">Usuário ativo: Carregando...</div>

  <div class="header-menu">
    <nav aria-label="Navegação principal" class="header" role="navigation">
      <div class="top-bar__section">
        <h1><i class="fas fa-rocket"></i>Gerador de Golds - YshippCommerce</h1>
      </div>
      <div class="top-bar__section">
        <button aria-label="Alternar menu" class="top-bar__icon" id="menu-icon">
          <i class="fas fa-bars"></i>
        </button>
        <button aria-label="Alternar tema claro/escuro" class="top-bar__icon" id="theme-toggle" title="Alternar tema">
          <i class="fas fa-adjust"></i>
        </button>
      </div>
    </nav>
    <nav aria-label="Menu principal" class="menu" id="main-menu">
      <ul class="menu__list">
        <li class="menu__item">
          <button class="menu__link" onclick="navigateTo('home')">
            <i class="fas fa-home"></i>
            <span>Página Principal</span>
          </button>
        </li>
        <li class="menu__item">
          <button class="menu__link" onclick="navigateTo('yshippcommerce')">
            <i class="fas fa-store"></i>
            <span>YshippCommerce</span>
          </button>
        </li>
        <li class="menu__item">
          <button class="menu__link" onclick="navigateTo('market')">
            <i class="fas fa-briefcase"></i>
            <span>Mercado de Serviços</span>
          </button>
        </li>
        <li class="menu__item">
          <button class="menu__link" onclick="navigateTo('store')">
            <i class="fas fa-shopping-cart"></i>
            <span>Loja</span>
          </button>
        </li>
        <li class="menu__item">
          <button class="menu__link" onclick="navigateTo('generator')">
            <i class="fas fa-ticket-alt"></i>
            <span>Gerador de Bilhetes</span>
          </button>
        </li>
        <li class="menu__item">
          <button class="menu__link" onclick="navigateTo('wallet')">
            <i class="fas fa-wallet"></i>
            <span>Carteira</span>
          </button>
        </li>
        <li class="menu__item">
          <button class="menu__link" id="logout-button">
            <i class="fas fa-sign-out-alt"></i>
            <span>Sair</span>
          </button>
        </li>
      </ul>
    </nav>
  </div>

  <div class="notification" id="notification"></div>
  <div id="overlay" class="overlay"></div>

  <main style="width:100%;max-width:1000px;padding:0 0.75rem 120px;margin:0 auto;">
    <div class="balance-cards">
      <div class="balance-card gold fade-in">
        <div class="balance-label">Saldo em Golds</div>
        <div id="golds-balance" class="balance-amount">0</div>
        <div class="balance-desc">Moeda virtual do sistema</div>
      </div>
      <div class="balance-card reais fade-in">
        <div class="balance-label">Saldo em Reais</div>
        <div id="reais-balance" class="balance-amount">R$ 0,00</div>
        <div class="balance-desc">Saldo disponível</div>
      </div>
    </div>

    <section class="ads-section fade-in">
      <h2><i class="fas fa-link"></i>Gerador de Golds via Links Curtos</h2>
      <p>Acesse links curtos e ganhe 150 Golds por visualização.</p>
      <div class="carousel-container" id="links-carousel"></div>
    </section>
    <div class="info-card links fade-in">
      <div class="info-text">
        <strong>Links curtos Instruções e ganhos:</strong><br>
        Encurte seus links e compartilhe. Cada pessoa que passar pelo seu link gera um pequeno valor em dólar pra você.
      </div>
      <button class="hamburger-btn"><i class="fas fa-bars"></i></button>
    </div>

    <section class="ads-section fade-in">
      <h2><i class="fas fa-coins"></i>Gerador de Golds via Cripto</h2>
      <p>Realize tarefas de criptomoedas e ganhe Golds inserindo o código fornecido.</p>
      <div class="carousel-container" id="crypto-carousel"></div>
    </section>
    <div class="info-card crypto fade-in">
      <div class="info-text">
        <strong>Instruções:</strong><br>
        Veja como funciona
      </div>
      <button class="hamburger-btn"><i class="fas fa-bars"></i></button>
    </div>

    <section class="ads-section fade-in">
      <h2><i class="fas fa-tasks"></i>Gerador de Golds via Offers</h2>
      <p>Realize tarefas e ganhe Golds inserindo o código fornecido.</p>
      <div class="carousel-container" id="tasks-carousel"></div>
    </section>
    <div class="info-card tasks fade-in">
      <div class="info-text">
        <strong>Instruções:</strong><br>
        Explique aqui como funciona
      </div>
      <button class="hamburger-btn"><i class="fas fa-bars"></i></button>
    </div>

    <section class="ads-section fade-in">
      <h2><i class="fas fa-poll"></i>Gerador de Golds via Pesquisas Remuneradas</h2>
      <p>Realize pesquisas remuneradas e ganhe Golds por participação.</p>
      <div class="carousel-container" id="pesquisas-carousel"></div>
    </section>
    <div class="info-card surveys fade-in">
      <div class="info-text">
        <strong>Instruções:</strong><br>
        Explique aqui como funciona
      </div>
      <button class="hamburger-btn"><i class="fas fa-bars"></i></button>
    </div>

    <section class="ads-section fade-in">
      <h2><i class="fas fa-user-plus"></i>Gerador de Golds via Link de Afiliado</h2>
      <p>Compartilhe links de afiliado e ganhe Golds por cada pessoa que se cadastrar ou realizar uma ação.</p>
      <div class="carousel-container" id="afiliado-carousel"></div>
    </section>
    <div class="info-card afiliado fade-in">
      <div class="info-text">
        <strong>Instruções:</strong><br>
        1. Seja um afiliado Shopee e gere seu link de afiliado exclusivo.<br>
      </div>
      <button class="hamburger-btn"><i class="fas fa-bars"></i></button>
    </div>
  </main>

  <div id="welcomeModal" class="modal" role="dialog">
    <div class="modal-content">
      <h2><i class="fas fa-bell"></i>Aviso</h2>
      <p id="welcomeModalText"></p>
      <button onclick="closeModal('welcomeModal')">OK</button>
    </div>
  </div>

  <div id="cryptoModal" class="modal" role="dialog">
    <div class="modal-content">
      <h2><i class="fas fa-coins"></i>Insira o Código</h2>
      <p>Insira o código fornecido para reivindicar seus Golds.</p>
      <input type="text" id="cryptoCode" placeholder="Digite o código">
      <div style="display:flex;gap:0.5rem">
        <button onclick="submitCryptoCode()">Confirmar</button>
        <button class="cancel" onclick="closeModal('cryptoModal')">Cancelar</button>
      </div>
    </div>
  </div>

  <div id="cookieBanner" class="cookie-banner">
    <div class="content">
      <p>Concordo que meu endereço IP seja coletado e enviado ao administrador para identificar atividades.</p>
    </div>
    <div class="buttons">
      <button id="cookie-accept" class="accept" onclick="acceptIPConsent()">Aceitar</button>
      <button id="cookie-decline" class="decline" onclick="declineIPConsent()">Recusar</button>
    </div>
  </div>

  <footer id="userInfoFooter">
    Usuário: <span id="footerUserName">Carregando...</span> | ID: <span id="footerUserId">---</span>
  </footer>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDbxygCeFLDbf6Ge6YZHJqq0VvlSSfbc_I",
      authDomain: "yshippcommerce.firebaseapp.com",
      projectId: "yshippcommerce",
      storageBucket: "yshippcommerce.appspot.com",
      messagingSenderId: "680576769517",
      appId: "1:680576769517:web:ace30d8e451ee70511dbe4"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const auth = firebase.auth();
    const db = firebase.firestore();
    window._YSHIPP_db = db;
    window._YSHIPP_auth = auth;

    console.log("[DEBUG] Firebase conectado. Versão:", firebase.SDK_VERSION || 'compat');

    const ADMIN_PHONE = "5535984072446";

    function showModal(modalId, message, autoClose = true, type = 'sucesso') {
      const modal = document.getElementById(modalId);
      const modalText = modal.querySelector('p');
      modalText.textContent = message;
      modalText.style.color = type === 'erro' ? 'var(--accent)' : 'var(--reais)';
      modal.style.display = 'flex';
      if (autoClose && !message.includes('redirecionado')) {
        setTimeout(() => {
          modal.style.display = 'none';
        }, 3000);
      }
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    function showNotification(message) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.classList.add('show');
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    function acceptIPConsent() {
      localStorage.setItem('ipConsent', 'true');
      document.getElementById('cookieBanner').classList.remove('active');
    }

    function declineIPConsent() {
      localStorage.setItem('ipConsent', 'false');
      document.getElementById('cookieBanner').classList.remove('active');
      showModal('welcomeModal', 'Você deve aceitar a coleta de IP para continuar.', false, 'erro');
    }

    async function getUserIP() {
      try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip || 'IP não disponível';
      } catch (error) {
        console.error('[DEBUG] Erro ao obter IP:', error);
        return 'IP não disponível';
      }
    }

    function updateInterface(walletData) {
      const goldsBalance = walletData.goldsBalance || 0;
      const reaisBalance = walletData.reaisBalance || 0;
      document.getElementById('golds-balance').textContent = goldsBalance.toLocaleString();
      document.getElementById('reais-balance').textContent = `R$ ${reaisBalance.toFixed(2).replace('.', ',')}`;
    }

    function updateUserStatus(uid) {
      const userStatus = document.getElementById("userStatus");
      if (userStatus) userStatus.textContent = `Usuário ativo: ${uid}`;
    }

    async function updateFooterUserName(uid) {
      try {
        const userDoc = await db.collection("wallets").doc(uid).get();
        if (userDoc.exists && userDoc.data().name) {
          document.getElementById("footerUserName").textContent = userDoc.data().name;
        } else {
          document.getElementById("footerUserName").textContent = "Usuário Anônimo";
        }
        document.getElementById("footerUserId").textContent = uid;
      } catch (error) {
        console.error("⚠️ Erro ao buscar nome do usuário:", error);
        document.getElementById("footerUserName").textContent = "Usuário Desconhecido";
      }
    }

    function loadLinksCarousel(links) {
      const carousel = document.getElementById('links-carousel');
      carousel.innerHTML = '';
      links.forEach(ad => {
        const golds = ad.golds ?? ad.reward ?? 0;
        const card = document.createElement('div');
        card.classList.add('ad-card', 'fade-in');
        card.innerHTML = `
          <h3>${ad.title}</h3>
          <div class="steps-list">
            <strong>Passos:</strong>
            <ul>${(ad.steps || []).map(step => `<li>${step}</li>`).join('')}</ul>
          </div>
          <div class="golds-reward"><strong>Recompensa:</strong> ${golds} Golds</div>
          <button class="view-button" onclick="window.open('${ad.url || '#' }', '_blank'); viewAd('${ad.id}', ${golds})">${ad.buttonText || 'Visualizar Propaganda'}</button>
        `;
        carousel.appendChild(card);
      });
      if (links.length === 0) {
        carousel.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 1rem; font-size: 0.85rem">Nenhum link disponível.</p>';
      }
    }

    function loadCryptoCarousel(cryptoAds) {
      const carousel = document.getElementById('crypto-carousel');
      carousel.innerHTML = '';
      cryptoAds.forEach(ad => {
        const golds = ad.golds ?? ad.reward ?? 0;
        const card = document.createElement('div');
        card.classList.add('ad-card', 'fade-in');
        card.innerHTML = `
          <h3>${ad.title}</h3>
          <div class="steps-list">
            <strong>Passos:</strong>
            <ul>${(ad.steps || []).map(step => `<li>${step}</li>`).join('')}</ul>
          </div>
          <div class="golds-reward"><strong>Recompensa:</strong> ${golds} Golds</div>
          <button class="view-button" onclick="showCryptoModal('${ad.id}', ${golds}, '${ad.code}')">${ad.buttonText || 'Insira o Código'}</button>
        `;
        carousel.appendChild(card);
      });
      if (cryptoAds.length === 0) {
        carousel.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 1rem; font-size: 0.85rem">Nenhuma tarefa de cripto disponível.</p>';
      }
    }

    function loadTasksCarousel(tasks) {
      const carousel = document.getElementById('tasks-carousel');
      carousel.innerHTML = '';
      tasks.forEach(ad => {
        const reward = ad.golds ?? ad.reward ?? 0;
        const freelancersNeeded = ad.freelancersNeeded ?? ad.slots ?? null;
        const acceptedCount = (ad.acceptedBy && ad.acceptedBy.length) || 0;
        const vagasText = freelancersNeeded ? ` | Vagas: ${Math.max(0, freelancersNeeded - acceptedCount)}` : '';
        const card = document.createElement('div');
        card.classList.add('ad-card', 'fade-in');
        card.innerHTML = `
          <h3>${ad.title}</h3>
          <div class="steps-list">
            <strong>Passos:</strong>
            <ul>${(ad.steps || []).map(step => `<li>${step}</li>`).join('')}</ul>
          </div>
          <div class="golds-reward"><strong>Recompensa:</strong> ${reward} Golds${vagasText}</div>
          <button class="view-button" onclick="acceptTask('${ad.id}', ${reward})">${ad.buttonText || 'Aceitar Tarefa'}</button>
        `;
        carousel.appendChild(card);
      });
      if (tasks.length === 0) {
        carousel.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 1rem; font-size: 0.85rem">Nenhuma task disponível.</p>';
      }
    }

    function loadPesquisasCarousel(pesquisas) {
      const carousel = document.getElementById('pesquisas-carousel');
      carousel.innerHTML = '';
      pesquisas.forEach(ad => {
        const reward = ad.golds ?? ad.reward ?? 0;
        const freelancersNeeded = ad.freelancersNeeded ?? ad.slots ?? null;
        const acceptedCount = (ad.acceptedBy && ad.acceptedBy.length) || 0;
        const vagasText = freelancersNeeded ? ` | Vagas: ${Math.max(0, freelancersNeeded - acceptedCount)}` : '';
        const card = document.createElement('div');
        card.classList.add('ad-card', 'fade-in');
        card.innerHTML = `
          <h3>${ad.title}</h3>
          <div class="steps-list">
            <strong>Passos:</strong>
            <ul>${(ad.steps || []).map(step => `<li>${step}</li>`).join('')}</ul>
          </div>
          <div class="golds-reward"><strong>Recompensa:</strong> ${reward} Golds${vagasText}</div>
          <button class="view-button" onclick="acceptTask('${ad.id}', ${reward})">${ad.buttonText || 'Participar da Pesquisa'}</button>
        `;
        carousel.appendChild(card);
      });
      if (pesquisas.length === 0) {
        carousel.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 1rem; font-size: 0.85rem">Nenhuma pesquisa disponível.</p>';
      }
    }

    function loadAfiliadoCarousel(afiliados) {
      const carousel = document.getElementById('afiliado-carousel');
      carousel.innerHTML = '';
      afiliados.forEach(ad => {
        const reward = ad.golds ?? ad.reward ?? 0;
        const card = document.createElement('div');
        card.classList.add('ad-card', 'fade-in');
        card.innerHTML = `
          <h3>${ad.title}</h3>
          <div class="steps-list">
            <strong>Passos:</strong>
            <ul>${(ad.steps || []).map(step => `<li>${step}</li>`).join('')}</ul>
          </div>
          <div class="golds-reward"><strong>Recompensa:</strong> ${reward} Golds</div>
          <button class="view-button" onclick="shareAfiliadoLink('${ad.id}', ${reward}, '${ad.link}')">${ad.buttonText || 'Compartilhar Link'}</button>
        `;
        carousel.appendChild(card);
      });
      if (afiliados.length === 0) {
        carousel.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 1rem; font-size: 0.85rem">Nenhum link de afiliado disponível.</p>';
      }
    }

    function viewAd(adId, golds) {
      const userId = auth.currentUser?.uid;
      if (!userId) {
        showModal('welcomeModal', 'Usuário não autenticado. Faça login novamente.', true, 'erro');
        return;
      }
      sincronizarGeradorFirebase(userId, adId, golds, `Visualização de link curto ID: ${adId}`, 'receive');
      showNotification(`Você ganhou ${golds} Golds por visualizar o link!`);
    }

    function showCryptoModal(adId, golds, code) {
      const userId = auth.currentUser?.uid;
      if (!userId) {
        showModal('welcomeModal', 'Usuário não autenticado. Faça login novamente.', true, 'erro');
        return;
      }
      if (localStorage.getItem('ipConsent') !== 'true') {
        showModal('welcomeModal', 'Você deve aceitar a coleta de IP para continuar.', false, 'erro');
        return;
      }
      window.currentAdId = adId;
      window.currentGolds = golds;
      window.expectedCode = code;
      document.getElementById('cryptoModal').style.display = 'flex';
    }

    async function submitCryptoCode() {
      const userId = auth.currentUser?.uid;
      if (!userId) {
        showModal('welcomeModal', 'Usuário não autenticado. Faça login novamente.', true, 'erro');
        return;
      }
      if (localStorage.getItem('ipConsent') !== 'true') {
        showModal('welcomeModal', 'Você deve aceitar a coleta de IP para continuar.', false, 'erro');
        return;
      }
      const inputCode = document.getElementById('cryptoCode').value.trim();
      if (inputCode === window.expectedCode) {
        try {
          const ip = await getUserIP();
          const doc = await db.collection('wallets').doc(userId).get();
          if (doc.exists) {
            const walletData = doc.data();
            const message = `Reivindicação de Cripto:\nUsuário: ${walletData.name}\nUserID: ${userId}\nCódigo: ${inputCode}\nGolds: ${window.currentGolds}\nIP: ${ip}`;
            sincronizarGeradorFirebase(userId, window.currentAdId, window.currentGolds, `Reivindicação de cripto ID: ${window.currentAdId}`, 'receive');
            showModal('welcomeModal', `Você será redirecionado para o WhatsApp em 8 segundos para enviar as informações ao atendimento.`, false, 'sucesso');
            setTimeout(() => {
              const whatsappUrl = `https://wa.me/${ADMIN_PHONE}?text=${encodeURIComponent(message)}`;
              window.open(whatsappUrl, '_blank');
              closeModal('cryptoModal');
            }, 8000);
          } else {
            showModal('welcomeModal', 'Carteira não encontrada. Tente novamente.', true, 'erro');
          }
        } catch (error) {
          console.error('[DEBUG] Erro ao verificar carteira:', error);
          showModal('welcomeModal', 'Erro ao verificar carteira. Tente novamente.', true, 'erro');
        }
      } else {
        showModal('welcomeModal', 'Código incorreto. Tente novamente.', true, 'erro');
      }
      document.getElementById('cryptoCode').value = '';
    }

    async function acceptTask(adId, reward) {
      const userId = auth.currentUser?.uid;
      if (!userId) {
        showModal('welcomeModal', 'Usuário não autenticado. Faça login novamente.', true, 'erro');
        return;
      }
      if (localStorage.getItem('ipConsent') !== 'true') {
        showModal('welcomeModal', 'Você deve aceitar a coleta de IP para continuar.', false, 'erro');
        return;
      }
      const adRef = db.collection('offers').doc(adId);
      const walletRef = db.collection('wallets').doc(userId);
      try {
        await db.runTransaction(async (t) => {
          const adDoc = await t.get(adRef);
          if (!adDoc.exists) throw new Error('Tarefa não encontrada.');
          const ad = adDoc.data();
          const required = ad.freelancersNeeded ?? ad.slots ?? null;
          const acceptedBy = Array.isArray(ad.acceptedBy) ? ad.acceptedBy.slice() : [];
          if (acceptedBy.includes(userId)) {
            throw new Error('Você já aceitou esta tarefa.');
          }
          if (required !== null && acceptedBy.length >= required) {
            throw new Error('Vagas para esta tarefa esgotadas.');
          }
          acceptedBy.push(userId);
          const newAdUpdate = { acceptedBy: acceptedBy };
          if (required !== null && acceptedBy.length >= required) {
            newAdUpdate.active = false;
          }
          t.update(adRef, newAdUpdate);
          const walletDoc = await t.get(walletRef);
          const newTransaction = {
            type: 'receive',
            amount: reward,
            currency: 'golds',
            date: new Date().toISOString(),
            description: `Aceitação da tarefa ${adId}`
          };
          if (!walletDoc.exists) {
            t.set(walletRef, {
              userId: userId,
              name: auth.currentUser?.displayName || 'Usuário',
              goldsBalance: reward,
              reaisBalance: 0,
              transactions: [newTransaction]
            });
          } else {
            const w = walletDoc.data();
            const current = Number(w.goldsBalance || 0);
            const txs = Array.isArray(w.transactions) ? w.transactions.slice() : [];
            txs.unshift(newTransaction);
            t.update(walletRef, {
              goldsBalance: current + reward,
              transactions: txs
            });
          }
        });
        const walletData = JSON.parse(localStorage.getItem('walletData') || '{}');
        walletData.goldsBalance = (walletData.goldsBalance || 0) + reward;
        walletData.transactions = walletData.transactions || [];
        walletData.transactions.unshift({
          type: 'receive',
          amount: reward,
          currency: 'golds',
          date: new Date().toISOString(),
          description: `Aceitação da tarefa ${adId}`
        });
        localStorage.setItem('walletData', JSON.stringify(walletData));
        updateInterface({ goldsBalance: walletData.goldsBalance, reaisBalance: walletData.reaisBalance || 0, transactions: walletData.transactions });
        showNotification(`Você ganhou ${reward} Golds por aceitar a tarefa!`);
      } catch (err) {
        console.error('[DEBUG] Erro ao aceitar tarefa:', err);
        showModal('welcomeModal', err.message || 'Erro ao aceitar tarefa. Tente novamente.', true, 'erro');
      }
    }

    function shareAfiliadoLink(adId, reward, link) {
      const userId = auth.currentUser?.uid;
      if (!userId) {
        showModal('welcomeModal', 'Usuário não autenticado. Faça login novamente.', true, 'erro');
        return;
      }
      if (localStorage.getItem('ipConsent') !== 'true') {
        showModal('welcomeModal', 'Você deve aceitar a coleta de IP para continuar.', false, 'erro');
        return;
      }
      sincronizarGeradorFirebase(userId, adId, reward, `Compartilhamento de link de afiliado ID: ${adId}`, 'receive');
      showNotification(`Você ganhou ${reward} Golds por compartilhar o link de afiliado!`);
      window.open(link, '_blank');
    }

    async function sincronizarGeradorFirebase(userId, adId, golds, description, type) {
      try {
        const doc = await db.collection('wallets').doc(userId).get();
        if (doc.exists) {
          const walletData = doc.data();
          const newTransaction = {
            type: type,
            amount: golds,
            currency: 'golds',
            date: new Date().toISOString(),
            description: description
          };
          await db.collection('wallets').doc(userId).update({
            goldsBalance: walletData.goldsBalance + golds,
            transactions: [newTransaction, ...(walletData.transactions || [])]
          });
          localStorage.setItem('walletData', JSON.stringify({
            userId: walletData.userId,
            name: walletData.name,
            goldsBalance: walletData.goldsBalance + golds,
            reaisBalance: walletData.reaisBalance,
            transactions: [newTransaction, ...(walletData.transactions || [])]
          }));
          console.log("[DEBUG] Ganhos sincronizados para adId:", adId, "Golds:", golds);
        } else {
          showModal('welcomeModal', 'Carteira não encontrada. Tente novamente.', true, 'erro');
        }
      } catch (error) {
        console.error('[DEBUG] Erro ao sincronizar ganhos:', error);
        showModal('welcomeModal', 'Erro ao registrar ganhos. Tente novamente.', true, 'erro');
      }
    }

    async function carregarGeradorFirebase(userId) {
      console.log("[DEBUG] carregarGeradorFirebase chamado para UID:", userId);
      const defaultWallet = {
        userId: userId,
        name: auth.currentUser?.displayName || 'Usuário',
        goldsBalance: 0,
        reaisBalance: 0,
        transactions: []
      };
      updateInterface(defaultWallet);
      try {
        const walletDoc = await db.collection('wallets').doc(userId).get();
        if (walletDoc.exists) {
          const walletData = walletDoc.data();
          console.log("[DEBUG] Carteira carregada:", walletData);
          updateInterface(walletData);
          localStorage.setItem('walletData', JSON.stringify({
            userId: walletData.userId,
            name: walletData.name,
            goldsBalance: walletData.goldsBalance,
            reaisBalance: walletData.reaisBalance,
            transactions: walletData.transactions
          }));
        } else {
          await db.collection('wallets').doc(userId).set(defaultWallet);
          console.log('[DEBUG] Default wallet created for user:', userId);
          updateInterface(defaultWallet);
          localStorage.setItem('walletData', JSON.stringify(defaultWallet));
        }
        const querySnapshot = await db.collection('offers').where('active', '==', true).get();
        console.log('[DEBUG] Snapshot offers recebido:', querySnapshot.size, 'itens');
        const links = [];
        const cryptoAds = [];
        const tasks = [];
        const pesquisas = [];
        const afiliados = [];
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          const offer = { id: doc.id, ...data };
          if (data.type === 'Link curto') {
            links.push(offer);
          } else if (data.type === 'Cripto') {
            cryptoAds.push(offer);
          } else if (['Task', 'tasks', 'tasksList'].includes(data.type)) {
            tasks.push(offer);
          } else if (data.type === 'Pesquisa Remunerada') {
            pesquisas.push(offer);
          } else if (data.type === 'Link de Afiliado') {
            afiliados.push(offer);
          }
        });
        loadLinksCarousel(links);
        loadCryptoCarousel(cryptoAds);
        loadTasksCarousel(tasks);
        loadPesquisasCarousel(pesquisas);
        loadAfiliadoCarousel(afiliados);
        document.getElementById("loadingOverlay").style.display = "none";
      } catch (error) {
        console.error('[DEBUG] Erro ao carregar dados:', error);
        showModal('welcomeModal', 'Erro ao carregar dados. Tente novamente.', true, 'erro');
        document.getElementById("loadingOverlay").style.display = "none";
      }
    }

    function navigateTo(page) {
      switch(page) {
        case 'wallet':
          window.location.href = "carteira.html";
          break;
        case 'generator':
          window.location.href = "gerador.html";
          break;
        case 'market':
          window.location.href = "mercado.html";
          break;
        case 'store':
          window.location.href = "loja.html";
          break;
        case 'yshippcommerce':
          window.location.href = "yshippcommerce.html";
          break;
        case 'home':
        default:
          window.location.href = "index.html";
          break;
      }
    }

    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body;

    themeToggle.addEventListener('click', () => {
      const currentTheme = body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      body.setAttribute('data-theme', currentTheme);
      localStorage.setItem('theme', currentTheme);
    });

    window.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme') || 'light';
      body.setAttribute('data-theme', savedTheme);
    });

    const menuToggles = {
      'menu-icon': 'main-menu'
    };

    Object.entries(menuToggles).forEach(([toggleId, menuId]) => {
      const toggle = document.getElementById(toggleId);
      const menu = document.getElementById(menuId);
      if (!toggle || !menu) {
        console.error(`Elemento ${toggleId} ou ${menuId} não encontrado`);
        return;
      }
      toggle.addEventListener('click', e => {
        e.stopPropagation();
        menu.classList.toggle('open');
        toggle.classList.toggle('active');
      });
    });

    document.addEventListener('click', e => {
      if (!e.target.closest('.menu') && !e.target.closest('.top-bar__icon')) {
        Object.values(menuToggles).forEach(menuId => {
          const menu = document.getElementById(menuId);
          if (menu) menu.classList.remove('open');
        });
        document.querySelectorAll('.top-bar__icon').forEach(icon => {
          if (icon) icon.classList.remove('active');
        });
      }
    });

    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        Object.values(menuToggles).forEach(menuId => {
          const menu = document.getElementById(menuId);
          if (menu) menu.classList.remove('open');
        });
        document.querySelectorAll('.top-bar__icon').forEach(icon => {
          if (icon) icon.classList.remove('active');
        });
      }
    });

    document.getElementById("logout-button").addEventListener("click", () => {
      auth.signOut().then(() => window.location.href = "cadastro.html");
    });

    function showCookieBannerOncePerDay() {
      const today = new Date().toISOString().split('T')[0];
      const lastShown = localStorage.getItem('cookieBannerLastShown');
      if (lastShown !== today) {
        document.getElementById('cookieBanner').classList.add('active');
        localStorage.setItem('cookieBannerLastShown', today);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem("ipConsent") === "true") {
        document.getElementById("cookieBanner").classList.remove('active');
      }
      showCookieBannerOncePerDay();
    });

    window.addEventListener('load', () => {
      console.log("[DEBUG] Aguardando autenticação...");
      const storedUID = localStorage.getItem("userUID");
      if (storedUID && !navigator.onLine) {
        console.log("[DEBUG] UID local detectado (offline):", storedUID);
        updateUserStatus(storedUID);
        updateFooterUserName(storedUID);
        carregarGeradorFirebase(storedUID);
        showModal('welcomeModal', 'Você está offline. Usando dados em cache.', false, 'erro');
        document.getElementById("loadingOverlay").style.display = "none";
        return;
      }
      auth.onAuthStateChanged((user) => {
        if (user) {
          const uid = user.uid;
          console.log("[DEBUG] Usuário logado:", uid);
          localStorage.setItem("userUID", uid);
          updateUserStatus(uid);
          updateFooterUserName(uid);
          carregarGeradorFirebase(uid);
          if (localStorage.getItem('ipConsent') !== 'true') {
            document.getElementById('cookieBanner').classList.add('active');
            console.log("[DEBUG] Banner de consentimento exibido.");
          }
        } else {
          console.log("[DEBUG] Nenhum usuário logado. Tentando login anônimo...");
          auth.signInAnonymously()
            .then((cred) => {
              console.log("✅ Login anônimo realizado com sucesso.");
              const uid = cred.user.uid;
              localStorage.setItem("userUID", uid);
              updateUserStatus(uid);
              updateFooterUserName(uid);
              carregarGeradorFirebase(uid);
              if (localStorage.getItem('ipConsent') !== 'true') {
                document.getElementById('cookieBanner').classList.add('active');
                console.log("[DEBUG] Banner de consentimento exibido após login anônimo.");
              }
              document.getElementById("loadingOverlay").style.display = "none";
            })
            .catch((error) => {
              console.error("❌ Erro no login anônimo:", error.code, error.message);
              showModal('welcomeModal', "Erro ao autenticar: " + error.message, true, 'erro');
              document.getElementById("loadingOverlay").style.display = "none";
            });
        }
      });
    });

    window.addEventListener("offline", () => {
      console.log("[DEBUG] Conexão perdida.");
      showModal('welcomeModal', 'Sem conexão com a internet. Tentando reconectar...', false, 'erro');
    });

    window.addEventListener("online", () => {
      console.log("[DEBUG] Conexão restabelecida.");
      showModal('welcomeModal', 'Reconectado. Recarregando dados...', true, 'sucesso');
      location.reload();
    });
  </script>
</body>
</html>
