<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Acesso - YshippCommerce</title>
  <link href="https://fonts.googleapis.com/css2?family=Jura:wght@400;700&family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="flex justify-center items-center min-h-screen bg-gray-100">
  <div class="bg-white p-6 rounded-2xl shadow-lg w-80">
    <div class="flex mb-4">
      <button id="login-tab" class="flex-1 py-2 font-bold bg-purple-600 text-white rounded-l" onclick="showTab('login')">Entrar</button>
      <button id="signup-tab" class="flex-1 py-2 font-bold bg-gray-200 text-gray-700 rounded-r" onclick="showTab('signup')">Cadastrar</button>
    </div>

    <div id="login-section">
      <h2 class="text-center text-xl font-bold mb-4">Acesse sua conta</h2>
      <input id="login-email" type="email" placeholder="E-mail" class="w-full mb-2 p-2 border rounded">
      <input id="login-senha" type="password" placeholder="Senha" class="w-full mb-2 p-2 border rounded">
      <button onclick="loginUsuario()" class="w-full bg-green-600 text-white py-2 rounded">Entrar</button>
    </div>

    <div id="signup-section" class="hidden">
      <h2 class="text-center text-xl font-bold mb-4">Crie sua conta</h2>
      <input id="nome" type="text" placeholder="Nome completo" class="w-full mb-2 p-2 border rounded">
      <input id="email" type="email" placeholder="E-mail" class="w-full mb-2 p-2 border rounded">
      <input id="senha" type="password" placeholder="Senha" class="w-full mb-2 p-2 border rounded">
      <button onclick="cadastrarUsuario()" class="w-full bg-green-600 text-white py-2 rounded">Cadastrar</button>
    </div>

    <p id="mensagem" class="text-center text-sm mt-3 text-red-500"></p>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js"></script>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDbxygCeFLDbf6Ge6YZHJqq0VvlSSfbc_I",
      authDomain: "yshippcommerce.firebaseapp.com",
      projectId: "yshippcommerce",
      storageBucket: "yshippcommerce.firebasestorage.app",
      messagingSenderId: "680576769517",
      appId: "1:680576769517:web:ace30d8e451ee70511dbe4"
    };

    let auth, db, firebaseReady = false;

    // Inicialização segura (garante que Firebase carregue antes de usar)
    function onFirebaseReady() {
      if (!firebaseReady) {
        firebase.initializeApp(firebaseConfig);
        auth = firebase.auth();
        db = firebase.firestore();
        firebaseReady = true;
        console.log("✅ Firebase inicializado com sucesso");
      }
    }

    // Verifica automaticamente se o Firebase carregou
    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(onFirebaseReady, 500);
    });

    // Alternar abas
    function showTab(tab) {
      document.getElementById('login-section').classList.toggle('hidden', tab !== 'login');
      document.getElementById('signup-section').classList.toggle('hidden', tab !== 'signup');
      document.getElementById('login-tab').classList.toggle('bg-purple-600', tab === 'login');
      document.getElementById('login-tab').classList.toggle('bg-gray-200', tab !== 'login');
      document.getElementById('signup-tab').classList.toggle('bg-purple-600', tab === 'signup');
      document.getElementById('signup-tab').classList.toggle('bg-gray-200', tab !== 'signup');
      document.getElementById('mensagem').textContent = '';
    }

    // Cadastro
    async function cadastrarUsuario() {
      const msg = document.getElementById("mensagem");
      if (!firebaseReady) return msg.textContent = "⏳ Inicializando sistema... aguarde um instante.";

      const nome = document.getElementById("nome").value.trim();
      const email = document.getElementById("email").value.trim();
      const senha = document.getElementById("senha").value.trim();

      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, senha);
        const user = userCredential.user;

        await db.collection("wallets").doc(user.uid).set({
          userId: user.uid,
          name: nome,
          goldsBalance: 0,
          reaisBalance: 0,
          transactions: [],
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        msg.textContent = "✅ Conta criada com sucesso! Redirecionando...";
        msg.classList.replace("text-red-500", "text-green-500");
        setTimeout(() => {
          window.location.href = "https://linkpremiado51-cmd.github.io/yshippcommerce/index.html";
        }, 2000);
      } catch (error) {
        msg.textContent = "⚠️ " + error.message;
      }
    }

    // Login
    async function loginUsuario() {
      const msg = document.getElementById("mensagem");
      if (!firebaseReady) return msg.textContent = "⏳ Inicializando sistema... aguarde um instante.";

      const email = document.getElementById("login-email").value.trim();
      const senha = document.getElementById("login-senha").value.trim();

      try {
        await auth.signInWithEmailAndPassword(email, senha);
        msg.textContent = "✅ Login realizado! Redirecionando...";
        msg.classList.replace("text-red-500", "text-green-500");
        setTimeout(() => {
          window.location.href = "https://linkpremiado51-cmd.github.io/yshippcommerce/index.html";
        }, 1500);
      } catch (error) {
        msg.textContent = "⚠️ " + error.message;
      }
    }
  </script>
</body>
</html>
