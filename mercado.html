<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Publicar serviﾃｧos no Mercado de Serviﾃｧos YshippCommerce">
  <title>Publicar Serviﾃｧo - YshippCommerce</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore-compat.js"></script>
  <style>
    :root {
      --background: #f5f7fa;
      --surface: #ffffff;
      --text-primary: #1a202c;
      --text-secondary: #4a5568;
      --primary: #2d3748;
      --primary-hover: #1a202c;
      --secondary: #3182ce;
      --secondary-hover: #2b6cb0;
      --border: #e2e8f0;
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.15);
      --accent: #e53e3e;
      --gold: #d69e2e;
      --reais: #10b981;
      --progress-bg: #edf2f7;
      --tutorial-bg: #3498db;
      --tutorial-hover: #2980b9;
      --button-bg: #9ca3af;
      --button-hover: #6b7280;
      --nsfw-bg: #e74c3c;
      --nsfw-hover: #c0392b;
      --crypto: #e74c3c;
      --tasks: #8e44ad;
      --surveys: #27ae60;
      --afiliado: #d69e2e;
    }
    [data-theme="dark"] {
      --background: #1a202c;
      --surface: #2d3748;
      --text-primary: #e2e8f0;
      --text-secondary: #a0aec0;
      --border: #4a5568;
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.4);
      --accent: #f56565;
      --gold: #e6a24b;
      --reais: #059669;
      --progress-bg: #4a5568;
      --tutorial-bg: #1e90ff;
      --tutorial-hover: #1c86ee;
      --button-bg: #6b7280;
      --button-hover: #4b5563;
      --nsfw-bg: #c0392b;
      --nsfw-hover: #a5281a;
      --crypto: #c0392b;
      --tasks: #6c3483;
      --surveys: #1b5e20;
      --afiliado: #b7791f;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      user-select: none;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--background);
      color: var(--text-primary);
      line-height: 1.5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
    }
    .header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      box-shadow: var(--shadow);
      padding: 1rem;
      text-align: center;
      width: 100%;
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 {
      font-size: 1.125rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .theme-button {
      padding: 0.5rem 1rem;
      background: var(--tutorial-bg);
      border: none;
      color: #fff;
      font-size: 0.875rem;
      font-weight: 600;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .theme-button:hover {
      background: var(--tutorial-hover);
      transform: scale(1.05);
    }
    .status-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      padding: 1rem;
      background: var(--surface);
      box-shadow: var(--shadow);
      gap: 0.5rem;
      text-align: center;
      font-size: 0.875rem;
      font-weight: 600;
      width: 100%;
      max-width: 1200px;
      border-radius: 0.375rem;
      margin: 1rem 0;
    }
    .status-bar div {
      padding: 0.75rem;
      background: var(--background);
      border-radius: 0.375rem;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .status-bar div:hover {
      background: var(--secondary);
      color: #fff;
      transform: translateY(-3px);
    }
    .status-bar span.golds-balance, .status-bar span#golds-total {
      color: var(--gold);
      font-size: 1.125rem;
      font-weight: 700;
    }
    .status-bar span.reais-balance {
      color: var(--reais);
      font-size: 1.125rem;
      font-weight: 700;
    }
    .wallet-section, .publish-section, .services-store-section, .services-list {
      width: 100%;
      max-width: 1200px;
      padding: 1.2rem;
      background: var(--surface);
      border-radius: 0.5rem;
      box-shadow: var(--shadow);
      margin: 1rem 0;
    }
    .wallet-section h2, .publish-section h2, .services-store-section h2, .services-list h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.8rem;
      color: var(--text-primary);
    }
    .balances-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.2rem;
      margin-bottom: 2rem;
    }
    .balance-card {
      background: var(--background);
      border-radius: 0.5rem;
      padding: 1.6rem;
      text-align: center;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .balance-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }
    .balance-card.golds {
      background: linear-gradient(135deg, var(--gold), #b7791f);
      color: #fff;
      border-left: 4px solid var(--gold);
    }
    .balance-card.reais {
      background: linear-gradient(135deg, var(--reais), #059669);
      color: #fff;
      border-left: 4px solid var(--reais);
    }
    .balance-card h3 {
      font-size: 0.85rem;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      opacity: 0.9;
    }
    .balance-card .balance-amount {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: #fff;
    }
    .balance-card .user-info {
      font-size: 0.875rem;
      color: var(--text-primary);
      opacity: 0.9;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    .form-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.3rem;
    }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 0.4rem;
      font-size: 0.875rem;
      background: var(--surface);
      color: var(--text-primary);
      transition: border-color 0.3s ease;
    }
    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }
    .add-remove-buttons {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    .add-remove-buttons button {
      padding: 0.5rem;
      background: var(--secondary);
      color: #fff;
      border: none;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      font-size: 0.875rem;
      font-weight: 600;
    }
    .add-remove-buttons button:hover {
      background: var(--secondary-hover);
      transform: scale(1.05);
    }
    .add-remove-buttons button.remove {
      background: var(--accent);
    }
    .add-remove-buttons button.remove:hover {
      background: var(--nsfw-hover);
    }
    .publish-button {
      width: 100%;
      padding: 0.9rem;
      background: var(--secondary);
      color: #fff;
      border: none;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      margin-top: 1rem;
    }
    .publish-button:hover {
      background: var(--secondary-hover);
      transform: scale(1.05);
    }
    .publish-button:disabled {
      background: var(--accent);
      cursor: not-allowed;
      transform: none;
    }
    .carousel-container {
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      display: flex;
      gap: 1rem;
      padding: 0 1rem 1rem;
      scrollbar-width: none;
      -ms-overflow-style: none;
      justify-content: center;
    }
    .carousel-container::-webkit-scrollbar {
      display: none;
    }
    .carousel-container .service-card {
      flex: 0 0 90%;
      max-width: 400px;
      scroll-snap-align: center;
      position: relative;
      min-height: 400px;
    }
    .service-card {
      background: var(--background);
      border-radius: 0.5rem;
      padding: 1.25rem;
      box-shadow: var(--shadow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid var(--border);
      position: relative;
      overflow: hidden;
    }
    .service-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }
    .service-card.pending {
      opacity: 0.7;
      border-color: var(--accent);
    }
    .service-card.completed {
      opacity: 0.7;
      border-color: var(--secondary);
    }
    .service-card h3 {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: var(--text-primary);
    }
    .service-card p {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }
    .service-card .golds-reward {
      font-size: 1rem;
      font-weight: 600;
      color: var(--gold);
      margin: 0.5rem 0;
    }
    .service-card .steps-list, .service-card .proofs-list {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }
    .service-card .steps-list ul, .service-card .proofs-list ul {
      list-style-type: disc;
      padding-left: 1.25rem;
    }
    .service-card .action-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.75rem;
      margin-top: 1rem;
    }
    .service-card .action-buttons button {
      padding: 0.9rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      flex: 1;
    }
    .service-card .edit-button {
      background: var(--primary);
      color: #fff;
    }
    .service-card .edit-button:hover {
      background: var(--primary-hover);
      transform: scale(1.05);
    }
    .service-card .delete-button {
      background: var(--accent);
      color: #fff;
    }
    .service-card .delete-button:hover {
      background: var(--nsfw-hover);
      transform: scale(1.05);
    }
    .service-card .claim-button {
      position: absolute;
      bottom: 1rem;
      left: 1rem;
      padding: 0.75rem;
      background: var(--secondary);
      color: #fff;
      border: none;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .service-card .claim-button:hover {
      background: var(--secondary-hover);
      transform: scale(1.05);
    }
    .service-card .claim-button:disabled {
      background: var(--accent);
      cursor: not-allowed;
      transform: none;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: var(--surface);
      padding: 1.1rem;
      border-radius: 0.6rem;
      text-align: center;
      animation: slideIn 0.5s ease forwards;
      max-width: 92%;
      width: 500px;
      box-shadow: var(--shadow-lg);
    }
    .modal-content h2 {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }
    .modal-content p {
      color: var(--text-secondary);
      margin-bottom: 1rem;
      font-size: 0.875rem;
    }
    .modal-content input, .modal-content textarea, .modal-content select {
      width: 100%;
      padding: 0.75rem;
      margin: 0.5rem 0;
      border: 1px solid var(--border);
      border-radius: 0.4rem;
      font-size: 0.875rem;
      background: var(--surface);
      color: var(--text-primary);
    }
    .modal-content button {
      padding: 0.5rem 1rem;
      background: var(--secondary);
      border: none;
      color: #fff;
      border-radius: 0.375rem;
      cursor: pointer;
      font-weight: 600;
      margin: 0.25rem;
      font-size: 0.875rem;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .modal-content button.cancel {
      background: var(--accent);
    }
    .modal-content button.cancel:hover {
      background: var(--nsfw-hover);
      transform: scale(1.05);
    }
    .modal-content button:hover {
      background: var(--secondary-hover);
      transform: scale(1.05);
    }
    #successModal .modal-content {
      border-left: 4px solid var(--secondary);
    }
    #errorModal .modal-content {
      border-left: 4px solid var(--accent);
    }
    .cookie-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--surface);
      color: var(--text-primary);
      padding: 1rem;
      box-shadow: var(--shadow);
      border-top: 1px solid var(--border);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
      text-align: center;
    }
    .cookie-banner .content {
      font-size: 0.875rem;
    }
    .cookie-banner .content a {
      color: var(--primary);
      text-decoration: underline;
    }
    .cookie-banner .content a:hover {
      color: var(--primary-hover);
    }
    .cookie-banner .buttons {
      display: flex;
      gap: 0.5rem;
    }
    .cookie-banner button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .cookie-banner button.accept {
      background: var(--secondary);
      color: #fff;
    }
    .cookie-banner button.accept:hover {
      background: var(--secondary-hover);
    }
    .cookie-banner button.decline {
      background: transparent;
      color: var(--text-primary);
      border: 1px solid var(--border);
    }
    .cookie-banner button.decline:hover {
      background: var(--accent);
      color: #fff;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    @media (max-width: 600px) {
      .header {
        padding: 0.75rem;
        flex-direction: column;
        gap: 0.5rem;
      }
      .header h1 {
        font-size: 1.125rem;
      }
      .theme-button {
        width: 100%;
        max-width: none;
      }
      .status-bar {
        font-size: 0.75rem;
        padding: 0.5rem;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }
      .status-bar div {
        padding: 0.5rem;
      }
      .wallet-section, .publish-section, .services-store-section, .services-list {
        padding: 1rem 0.5rem;
      }
      .wallet-section h2, .publish-section h2, .services-store-section h2, .services-list h2 {
        font-size: 1.125rem;
      }
      .balances-grid {
        grid-template-columns: 1fr;
      }
      .carousel-container {
        padding: 0 0.5rem 1rem;
      }
      .carousel-container .service-card {
        flex: 0 0 95%;
        max-width: 350px;
      }
      .modal-content {
        padding: 1rem;
        width: 90%;
      }
      .cookie-banner .buttons {
        flex-direction: column;
        width: 100%;
      }
      .cookie-banner button {
        width: 100%;
      }
      .balance-amount {
        font-size: 1.25rem;
      }
    }
    @media (min-width: 601px) and (max-width: 1024px) {
      .header h1 {
        font-size: 1.25rem;
      }
      .wallet-section, .publish-section, .services-store-section, .services-list {
        padding: 1rem;
      }
      .wallet-section h2, .publish-section h2, .services-store-section h2, .services-list h2 {
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body data-theme="light">
  <header class="header" role="banner">
    <h1><i class="fas fa-briefcase"></i> Publicar Serviﾃｧo - YshippCommerce</h1>
    <div>
      <button class="theme-button" id="theme-toggle">Alternar Tema</button>
    </div>
  </header>
  <main class="flex-grow w-full">
    <div class="status-bar" role="region" aria-label="Resumo de Saldo">
      <div>SALDO EM GOLDS <span class="golds-balance" id="golds-balance">0</span></div>
      <div>SALDO EM REAIS <span class="reais-balance" id="reais-balance">R$ 0,00</span></div>
    </div>
    <section class="wallet-section">
      <h2>Gerencie Sua Carteira</h2>
      <div class="balances-grid">
        <div class="balance-card golds">
          <h3>Saldo em Golds</h3>
          <div class="balance-amount golds" id="golds-balance-display">0</div>
          <p>Ganhe Golds completando tarefas ou visualizando propagandas.</p>
          <div class="user-info" id="user-info"></div>
        </div>
        <div class="balance-card reais">
          <h3>Saldo em Reais</h3>
          <div class="balance-amount reais" id="reais-balance-display">R$ 0,00</div>
          <p>Converta Golds para reais e solicite saques.</p>
        </div>
      </div>
    </section>
    <section class="services-store-section">
      <h2>Serviﾃｧos Disponﾃｭveis</h2>
      <p style="margin-bottom: 1rem; color: var(--text-secondary);">Aceite tarefas e ganhe Golds ao completﾃ｡-las. Cada serviﾃｧo mostra os passos, provas necessﾃ｡rias e recompensa.</p>
      <div class="carousel-container" id="carousel"></div>
      <button id="verMais" class="publish-button" style="margin-top: 1rem;">Ver Mais</button>
    </section>
    <section class="publish-section">
      <h2>Publicar Novo Serviﾃｧo</h2>
      <p style="margin-bottom: 1rem; color: var(--text-secondary);">Preencha os detalhes para publicar um novo serviﾃｧo no Mercado de Serviﾃｧos.</p>
      <form id="publishForm">
        <div class="form-group">
          <label for="serviceName">Nome do Serviﾃｧo</label>
          <input type="text" id="serviceName" placeholder="Ex.: Promoﾃｧﾃ｣o Instagram" required>
        </div>
        <div class="form-group">
          <label for="zone">Zona/Paﾃｭs</label>
          <select id="zone" required>
            <option value="" disabled selected>Selecione uma zona</option>
            <option value="Internacional">Internacional</option>
            <option value="Brasil">Brasil</option>
            <option value="Estados Unidos">Estados Unidos</option>
            <option value="Europa">Europa</option>
            <option value="ﾃ《ia">ﾃ《ia</option>
          </select>
        </div>
        <div class="form-group">
          <label for="serviceType">Tipo de Serviﾃｧo</label>
          <select id="serviceType" required>
            <option value="" disabled selected>Selecione um tipo</option>
            <option value="Inscrever-se">Inscrever-se</option>
            <option value="Microinfluenciador do Facebook">Microinfluenciador do Facebook</option>
            <option value="Microinfluenciador do Instagram">Microinfluenciador do Instagram</option>
            <option value="Aplicativo mﾃｳvel">Aplicativo mﾃｳvel</option>
            <option value="Telegrama">Telegrama</option>
            <option value="TikTok">TikTok</option>
            <option value="Marketing de vﾃｭdeo">Marketing de vﾃｭdeo</option>
            <option value="Discord">Discord</option>
            <option value="Comente em outros blogs">Comente em outros blogs</option>
            <option value="Reddit">Reddit</option>
            <option value="SEO, Promover Conteﾃｺdo, Pesquisar, Engajar">SEO, Promover Conteﾃｺdo, Pesquisar, Engajar</option>
          </select>
        </div>
        <div class="form-group">
          <label for="subcategory">Subcategoria</label>
          <select id="subcategory" required>
            <option value="" disabled selected>Selecione um tipo de serviﾃｧo primeiro</option>
          </select>
          <div id="difficultyInfo" style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem;"></div>
        </div>
        <div class="form-group" id="stepsContainer">
          <label>Passos do Serviﾃｧo</label>
          <div class="step-input">
            <textarea placeholder="Ex.: Acesse o link fornecido" required></textarea>
            <div class="add-remove-buttons">
              <button type="button" class="add-step">+ Adicionar Passo</button>
            </div>
          </div>
        </div>
        <div class="form-group" id="proofsContainer">
          <label>Provas Necessﾃ｡rias</label>
          <div class="proof-input">
            <select class="proof-type" required>
              <option value="Texto">Texto</option>
              <option value="Captura de Tela">Captura de Tela</option>
            </select>
            <textarea placeholder="Ex.: Screenshot da curtida" required></textarea>
            <div class="add-remove-buttons">
              <button type="button" class="add-proof">+ Adicionar Prova</button>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="freelancers">Freelancers Necessﾃ｡rios</label>
          <input type="number" id="freelancers" min="1" max="25" value="1" required>
        </div>
        <div class="form-group">
          <label for="rewardGolds">Recompensa por Tarefa (Golds)</label>
          <input type="number" id="rewardGolds" min="1" value="1" required>
        </div>
        <div class="form-group">
          <label>Custo Total: <span id="totalCost">0</span> Golds</label>
        </div>
        <button type="submit" class="publish-button">Publicar Serviﾃｧo</button>
      </form>
    </section>
    <section class="services-list" id="userServices">
      <h2>Seus Serviﾃｧos Publicados</h2>
      <p style="margin-bottom: 1rem; color: var(--text-secondary);">Visualize e gerencie os serviﾃｧos que vocﾃｪ publicou.</p>
      <div class="services-list-content"></div>
    </section>
    <!-- Modais -->
    <div id="editModal" class="modal" role="dialog" aria-labelledby="editMessage">
      <div class="modal-content">
        <h2 id="editMessage">Editar Serviﾃｧo</h2>
        <form id="editForm">
          <div class="form-group">
            <label for="editServiceName">Nome do Serviﾃｧo</label>
            <input type="text" id="editServiceName" required>
          </div>
          <div class="form-group">
            <label for="editZone">Zona/Paﾃｭs</label>
            <select id="editZone" required>
              <option value="Internacional">Internacional</option>
              <option value="Brasil">Brasil</option>
              <option value="Estados Unidos">Estados Unidos</option>
              <option value="Europa">Europa</option>
              <option value="ﾃ《ia">ﾃ《ia</option>
            </select>
          </div>
          <div class="form-group">
            <label for="editServiceType">Tipo de Serviﾃｧo</label>
            <select id="editServiceType" required>
              <option value="Inscrever-se">Inscrever-se</option>
              <option value="Microinfluenciador do Facebook">Microinfluenciador do Facebook</option>
              <option value="Microinfluenciador do Instagram">Microinfluenciador do Instagram</option>
              <option value="Aplicativo mﾃｳvel">Aplicativo mﾃｳvel</option>
              <option value="Telegrama">Telegrama</option>
              <option value="TikTok">TikTok</option>
              <option value="Marketing de vﾃｭdeo">Marketing de vﾃｭdeo</option>
              <option value="Discord">Discord</option>
              <option value="Comente em outros blogs">Comente em outros blogs</option>
              <option value="Reddit">Reddit</option>
              <option value="SEO, Promover Conteﾃｺdo, Pesquisar, Engajar">SEO, Promover Conteﾃｺdo, Pesquisar, Engajar</option>
            </select>
          </div>
          <div class="form-group">
            <label for="editSubcategory">Subcategoria</label>
            <select id="editSubcategory" required></select>
            <div id="editDifficultyInfo" style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem;"></div>
          </div>
          <div class="form-group" id="editStepsContainer">
            <label>Passos do Serviﾃｧo</label>
          </div>
          <div class="form-group" id="editProofsContainer">
            <label>Provas Necessﾃ｡rias</label>
          </div>
          <div class="form-group">
            <label for="editFreelancers">Freelancers Necessﾃ｡rios</label>
            <input type="number" id="editFreelancers" min="1" max="25" required>
          </div>
          <div class="form-group">
            <label for="editRewardGolds">Recompensa por Tarefa (Golds)</label>
            <input type="number" id="editRewardGolds" min="1" required>
          </div>
          <button type="submit" class="secondary-button">Salvar Alteraﾃｧﾃｵes</button>
          <button type="button" class="cancel" onclick="closeModal('editModal')">Cancelar</button>
        </form>
      </div>
    </div>
    <div id="claimModal" class="modal" role="dialog" aria-labelledby="claimMessage">
      <div class="modal-content">
        <h2 id="claimMessage">Aceitar Serviﾃｧo</h2>
        <p id="claimDetails"></p>
        <button class="secondary-button" onclick="confirmClaim(currentServiceId, currentOwnerId, currentRewardGolds)">Aceitar e Pagar Golds</button>
        <button class="cancel" onclick="closeModal('claimModal')">Cancelar</button>
      </div>
    </div>
    <div id="proofModal" class="modal" role="dialog" aria-labelledby="proofMessage">
      <div class="modal-content">
        <h2 id="proofMessage">Enviar Provas</h2>
        <p>Insira as provas para o serviﾃｧo.</p>
        <form id="proofForm">
          <div id="proofInputs"></div>
          <button type="submit" class="secondary-button">Enviar Prova</button>
          <button type="button" class="cancel" onclick="closeModal('proofModal')">Cancelar</button>
        </form>
      </div>
    </div>
    <div id="welcomeModal" class="modal" role="dialog" aria-labelledby="welcomeMessage">
      <div class="modal-content">
        <h2 id="welcomeMessage">Aviso</h2>
        <p></p>
        <button class="secondary-button" onclick="closeModal('welcomeModal')">OK</button>
      </div>
    </div>
    <div id="successModal" class="modal" role="dialog" aria-labelledby="successMessage">
      <div class="modal-content">
        <h2 id="successMessage">Sucesso</h2>
        <p></p>
        <button class="secondary-button" onclick="closeModal('successModal')">OK</button>
      </div>
    </div>
    <div id="errorModal" class="modal" role="dialog" aria-labelledby="errorMessage">
      <div class="modal-content">
        <h2 id="errorMessage">Erro</h2>
        <p></p>
        <button class="secondary-button" onclick="closeModal('errorModal')">OK</button>
      </div>
    </div>
    <div id="cookieBanner" class="cookie-banner">
      <div class="content">
        <p>Concordo que meu endereﾃｧo IP seja coletado e enviado ao administrador para identificar tarefas publicadas.</p>
      </div>
      <div class="buttons">
        <button class="accept" onclick="acceptIPConsent()">Aceitar</button>
        <button class="decline" onclick="declineIPConsent()">Recusar</button>
      </div>
    </div>
  </main>
  <footer class="footer py-4 mt-auto w-full">
    <div class="container text-center">
      <p class="text-sm">ﾂｩ 2025 YshippCommerce. Todos os direitos reservados. Desenvolvido por xAI.</p>
      <div class="flex justify-center space-x-4 mt-2">
        <a href="#" class="text-primary text-sm hover:underline">WhatsApp</a>
        <a href="#" class="text-primary text-sm hover:underline">Facebook</a>
      </div>
    </div>
  </footer>
  <script>
    // Firebase configuration and initialization
    const firebaseConfig = {
      apiKey: "AIzaSyDbxygCeFLDbf6Ge6YZHJqq0VvlSSfbc_I",
      authDomain: "yshippcommerce.firebaseapp.com",
      projectId: "yshippcommerce",
      storageBucket: "yshippcommerce.appspot.com",
      messagingSenderId: "680576769517",
      appId: "1:680576769517:web:ace30d8e451ee70511dbe4"
    };
    firebase.initializeApp(firebaseConfig);
    // Firebase Authentication and Firestore
    const auth = firebase.auth();
    const db = firebase.firestore();
    // Global variables to store claim details
    let currentServiceId, currentOwnerId, currentRewardGolds;
    let currentServicesLimit = 20;
    // Structured service categories
    const serviceCategories = {
      "Inscrever-se": [
        { name: "Somente envio de e-mail", golds: 150, difficulty: "Simples" },
        { name: "Cadastro simples", golds: 300, difficulty: "Simples" },
        { name: "Inscriﾃｧﾃ｣o complexa", golds: 1000, difficulty: "Intermediﾃ｡rio" }
      ],
      "Microinfluenciador do Facebook": [
        { name: "Curtir no Facebook", golds: 1000, difficulty: "Intermediﾃ｡rio" },
        { name: "Curtidas no Facebook (mais de 50 amigos)", golds: 1200, difficulty: "Intermediﾃ｡rio" },
        { name: "Curtidas no Facebook (mais de 100 amigos)", golds: 1500, difficulty: "Intermediﾃ｡rio" },
        { name: "Curtidas no Facebook (mais de 300 amigos)", golds: 2000, difficulty: "Intermediﾃ｡rio" },
        { name: "Adicionar comentﾃ｡rio ﾃ conversa existente", golds: 1500, difficulty: "Intermediﾃ｡rio" },
        { name: "Adicione-me como amigo", golds: 2000, difficulty: "Intermediﾃ｡rio" },
        { name: "Junte-se a um grupo", golds: 1500, difficulty: "Intermediﾃ｡rio" },
        { name: "Mude sua foto de perfil (por 1 semana)", golds: 3000, difficulty: "Intermediﾃ｡rio" },
        { name: "Postar no Mural", golds: 2000, difficulty: "Intermediﾃ｡rio" },
        { name: "Publique no seu mural (mais de 50 amigos)", golds: 2500, difficulty: "Intermediﾃ｡rio" },
        { name: "Publique no seu mural (mais de 100 amigos)", golds: 3000, difficulty: "Intermediﾃ｡rio" },
        { name: "Publique no seu mural (mais de 300 amigos)", golds: 3500, difficulty: "Intermediﾃ｡rio" },
        { name: "Curtir + Publicar no mural (mais de 50 amigos)", golds: 3000, difficulty: "Intermediﾃ｡rio" },
        { name: "Curtir + Publicar no mural (mais de 100 amigos)", golds: 3500, difficulty: "Intermediﾃ｡rio" },
        { name: "Curtir + Publicar no mural (mais de 300 amigos)", golds: 4000, difficulty: "Intermediﾃ｡rio" },
        { name: "Curtir + Comentar + Publicar no Mural", golds: 5000, difficulty: "Intermediﾃ｡rio" }
      ],
      "Microinfluenciador do Instagram": [
        { name: "Seguir", golds: 1000, difficulty: "Intermediﾃ｡rio" },
        { name: "Curtir", golds: 1000, difficulty: "Intermediﾃ｡rio" },
        { name: "Comentﾃ｡rio", golds: 1500, difficulty: "Intermediﾃ｡rio" },
        { name: "Seguir + Curtir", golds: 2000, difficulty: "Intermediﾃ｡rio" },
        { name: "Curtir + Comentﾃ｡rio", golds: 2500, difficulty: "Intermediﾃ｡rio" },
        { name: "Seguir + Curtir + Comentar", golds: 3500, difficulty: "Intermediﾃ｡rio" },
        { name: "Compartilhe uma publicaﾃｧﾃ｣o", golds: 3000, difficulty: "Intermediﾃ｡rio" },
        { name: "Seguir + Curtir + Comentar + Compartilhar", golds: 5000, difficulty: "Intermediﾃ｡rio" }
      ],
      "Aplicativo mﾃｳvel": [
        { name: "Somente download", golds: 500, difficulty: "Simples" },
        { name: "Baixar + Instalar", golds: 700, difficulty: "Simples" },
        { name: "Baixar + Instalar + Testar + Revisﾃ｣o de 25 palavras", golds: 1500, difficulty: "Intermediﾃ｡rio" },
        { name: "Baixar + Instalar + Cadastrar + KYC", golds: 2000, difficulty: "Intermediﾃ｡rio" },
        { name: "Baixar + Instalar + Reproduzir/Engajar (atﾃｩ 5 min ou menos)", golds: 1000, difficulty: "Intermediﾃ｡rio" },
        { name: "Baixar + Instalar + Reproduzir/Engajar (atﾃｩ 15 min + US$ 0,05 para cada 10 min)", golds: 1500, difficulty: "Intermediﾃ｡rio" }
      ],
      "Telegrama": [
        { name: "Bot Junte-se", golds: 500, difficulty: "Simples" },
        { name: "Junte-se ao grupo", golds: 700, difficulty: "Simples" },
        { name: "Airdrop simples", golds: 1000, difficulty: "Intermediﾃ｡rio" },
        { name: "Lanﾃｧamento aﾃｩreo complexo", golds: 2000, difficulty: "Intermediﾃ｡rio" },
        { name: "Bot Join (Usuﾃ｡rios Premium)", golds: 1500, difficulty: "Intermediﾃ｡rio" },
        { name: "Ingresso em grupo (usuﾃ｡rios premium)", golds: 1500, difficulty: "Intermediﾃ｡rio" },
        { name: "Airdrop simples (usuﾃ｡rios premium)", golds: 2000, difficulty: "Intermediﾃ｡rio" },
        { name: "Airdrop complexo (usuﾃ｡rios premium)", golds: 3000, difficulty: "Intermediﾃ｡rio" }
      ],
      "TikTok": [
        { name: "Crie um vﾃｭdeo (atﾃｩ 15s)", golds: 2000, difficulty: "Intermediﾃ｡rio" },
        { name: "Crie um vﾃｭdeo (atﾃｩ 1 min)", golds: 3000, difficulty: "Intermediﾃ｡rio" },
        { name: "Crie um vﾃｭdeo (atﾃｩ 3 min)", golds: 5000, difficulty: "Complexo" },
        { name: "Assista a um vﾃｭdeo (atﾃｩ 1 min)", golds: 500, difficulty: "Simples" },
        { name: "Assista a um vﾃｭdeo (atﾃｩ 3 min)", golds: 1000, difficulty: "Simples" },
        { name: "Curtir / Seguir", golds: 1000, difficulty: "Intermediﾃ｡rio" },
        { name: "Comente um vﾃｭdeo", golds: 1500, difficulty: "Intermediﾃ｡rio" },
        { name: "Compartilhe um vﾃｭdeo", golds: 2000, difficulty: "Intermediﾃ｡rio" },
        { name: "Assistir + Curtir + Comentar + Compartilhar", golds: 4000, difficulty: "Intermediﾃ｡rio" }
      ],
      "Marketing de vﾃｭdeo": [
        { name: "Assista ao vﾃｭdeo (3 min)", golds: 500, difficulty: "Simples" },
        { name: "Assista ao vﾃｭdeo (6 min)", golds: 1000, difficulty: "Simples" },
        { name: "Assista ao vﾃｭdeo (9 min)", golds: 1500, difficulty: "Intermediﾃ｡rio" },
        { name: "Assista ao vﾃｭdeo (12 min)", golds: 2000, difficulty: "Intermediﾃ｡rio" },
        { name: "Assista ao vﾃｭdeo (15+ min)", golds: 2500, difficulty: "Intermediﾃ｡rio" },
        { name: "Curtir um vﾃｭdeo", golds: 1000, difficulty: "Intermediﾃ｡rio" },
        { name: "Comentﾃ｡rio", golds: 1500, difficulty: "Intermediﾃ｡rio" },
        { name: "Inscreva-se no canal", golds: 2000, difficulty: "Intermediﾃ｡rio" },
        { name: "Quaisquer 2 tarefas", golds: 2500, difficulty: "Intermediﾃ｡rio" },
        { name: "Quaisquer 3 tarefas", golds: 3500, difficulty: "Intermediﾃ｡rio" },
        { name: "Quaisquer 4 tarefas", golds: 4500, difficulty: "Intermediﾃ｡rio" },
        { name: "1x Curtir Compartilhar, Comentﾃ｡rio Inscrever + Assistir vﾃｭdeo (6 min)", golds: 4000, difficulty: "Intermediﾃ｡rio" },
        { name: "1x Curtir Compartilhar, Comentﾃ｡rio Inscrever + Assistir vﾃｭdeo (9 min)", golds: 4500, difficulty: "Intermediﾃ｡rio" },
        { name: "1x Curtir Compartilhar, Comentﾃ｡rio Inscrever + Assistir vﾃｭdeo (12 min)", golds: 5000, difficulty: "Intermediﾃ｡rio" }
      ],
      "Discord": [
        { name: "Junte-se a um canal", golds: 700, difficulty: "Simples" },
        { name: "Ingresso no servidor", golds: 1000, difficulty: "Intermediﾃ｡rio" }
      ],
      "Comente em outros blogs": [
        { name: "Comentﾃ｡rio curto", golds: 500, difficulty: "Simples" },
        { name: "Comentﾃ｡rio curto 2x", golds: 1000, difficulty: "Simples" },
        { name: "Comentﾃ｡rio curto 3x", golds: 1500, difficulty: "Intermediﾃ｡rio" },
        { name: "Comentﾃ｡rio curto com Link", golds: 700, difficulty: "Simples" },
        { name: "Comentﾃ｡rio curto 2x com Link", golds: 1200, difficulty: "Intermediﾃ｡rio" }
      ],
      "Reddit": [
        { name: "Votar positivamente em uma postagem", golds: 1000, difficulty: "Intermediﾃ｡rio" },
        { name: "Pesquisar + votar positivamente em uma postagem", golds: 1500, difficulty: "Intermediﾃ｡rio" },
        { name: "Comentar uma postagem", golds: 1500, difficulty: "Intermediﾃ｡rio" },
        { name: "Votar positivamente + comentar uma postagem", golds: 2000, difficulty: "Intermediﾃ｡rio" },
        { name: "Votar positivamente em uma postagem (NSFW)", golds: 1200, difficulty: "Intermediﾃ｡rio" },
        { name: "Pesquisar + votar positivamente em uma postagem (NSFW)", golds: 1700, difficulty: "Intermediﾃ｡rio" },
        { name: "Comentar uma postagem (NSFW)", golds: 1700, difficulty: "Intermediﾃ｡rio" },
        { name: "Votar positivamente + comentar uma postagem (NSFW)", golds: 2200, difficulty: "Intermediﾃ｡rio" }
      ],
      "SEO, Promover Conteﾃｺdo, Pesquisar, Engajar": [
        { name: "SEO + Promover conteﾃｺdo + Engajar 1x", golds: 2000, difficulty: "Intermediﾃ｡rio" },
        { name: "SEO + Promover conteﾃｺdo + Engajar 2x", golds: 3000, difficulty: "Intermediﾃ｡rio" },
        { name: "SEO + Promover conteﾃｺdo + Engajar 3x", golds: 4000, difficulty: "Intermediﾃ｡rio" },
        { name: "SEO + Promover conteﾃｺdo + Pesquisar + Engajar 1x", golds: 2500, difficulty: "Intermediﾃ｡rio" },
        { name: "SEO + Promover conteﾃｺdo + Pesquisar + Engajar 2x", golds: 3500, difficulty: "Intermediﾃ｡rio" },
        { name: "SEO + Promover conteﾃｺdo + Pesquisar + Engajar 3x", golds: 4500, difficulty: "Intermediﾃ｡rio" },
        { name: "SEO + Promover conteﾃｺdo + Pesquisar 2x + Engajar 2x", golds: 4000, difficulty: "Intermediﾃ｡rio" },
        { name: "SEO + Promover conteﾃｺdo + Pesquisar 3x + Engajar 3x", golds: 5000, difficulty: "Intermediﾃ｡rio" },
        { name: "SEO + Promover conteﾃｺdo + Tarefas 4x extensas", golds: 6000, difficulty: "Complexo" },
        { name: "SEO + Promover conteﾃｺdo + Tarefas 5x extensas", golds: 7000, difficulty: "Complexo" }
      ]
    };
    // Theme toggle functionality
    function loadTheme() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.body.dataset.theme = savedTheme;
    }
    function saveTheme(theme) {
      localStorage.setItem('theme', theme);
    }
    // Modal control
    function showModal(modalId, message, autoClose = true) {
      const modal = document.getElementById(modalId);
      modal.querySelector('p').textContent = message;
      modal.style.display = 'flex';
      if (autoClose) {
        setTimeout(() => modal.style.display = 'none', 4000);
      }
    }
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }
    // Update local balance display
    function updateBalanceDisplay(goldsBalance, reaisBalance) {
      const goldsBalanceElement = document.getElementById('golds-balance');
      const goldsBalanceDisplayElement = document.getElementById('golds-balance-display');
      const reaisBalanceElement = document.getElementById('reais-balance');
      const reaisBalanceDisplayElement = document.getElementById('reais-balance-display');
      goldsBalanceElement.textContent = goldsBalance || 0;
      goldsBalanceDisplayElement.textContent = goldsBalance || 0;
      reaisBalanceElement.textContent = `R$ ${reaisBalance?.toFixed(2) || '0,00'}`;
      reaisBalanceDisplayElement.textContent = `R$ ${reaisBalance?.toFixed(2) || '0,00'}`;
    }
    // Calculate total cost dynamically
    function calculateCost() {
      const freelancers = parseInt(document.getElementById('freelancers').value) || 0;
      const rewardGolds = parseInt(document.getElementById('rewardGolds').value) || 0;
      const total = freelancers * rewardGolds;
      const totalCostElement = document.getElementById('totalCost');
      if (totalCostElement) {
        totalCostElement.textContent = `${total} Golds`;
      }
    }
    // Update subcategories based on service type
    function updateSubcategories(selectId = 'subcategory', rewardId = 'rewardGolds', difficultyId = 'difficultyInfo', typeSelectId = 'serviceType') {
      const category = document.getElementById(typeSelectId).value;
      const subcategorySelect = document.getElementById(selectId);
      subcategorySelect.innerHTML = '<option value="" disabled selected>Selecione uma subcategoria</option>';
      if (category && serviceCategories[category]) {
        serviceCategories[category].forEach(sub => {
          const option = document.createElement('option');
          option.value = sub.name;
          option.textContent = `${sub.name} (${sub.golds} Golds base)`;
          subcategorySelect.appendChild(option);
        });
      }
      // Reset reward and difficulty on category change
      document.getElementById(rewardId).value = '';
      document.getElementById(rewardId).min = '1';
      document.getElementById(difficultyId).textContent = '';
    }
    // Handle subcategory selection to update reward and difficulty
    function handleSubcategoryChange(selectId = 'subcategory', rewardId = 'rewardGolds', difficultyId = 'difficultyInfo', typeSelectId = 'serviceType') {
      const category = document.getElementById(typeSelectId).value;
      const subcategoryValue = document.getElementById(selectId).value;
      const rewardInput = document.getElementById(rewardId);
      if (category && subcategoryValue && serviceCategories[category]) {
        const selectedSub = serviceCategories[category].find(sub => sub.name === subcategoryValue);
        if (selectedSub) {
          const baseGolds = selectedSub.golds;
          rewardInput.value = baseGolds;
          rewardInput.min = baseGolds;
          document.getElementById(difficultyId).textContent = `Dificuldade: ${selectedSub.difficulty}`;
          calculateCost();
        }
      }
    }
    // Ensure wallet exists
    async function ensureWalletExists(userId, displayName = 'Usuﾃ｡rio') {
      const ref = db.collection('wallets').doc(userId);
      const doc = await ref.get();
      if (!doc.exists) {
        await ref.set({
          userId,
          name: displayName,
          goldsBalance: 0,
          reaisBalance: 0,
          transactions: []
        });
      }
    }
    // Add service tax to the corresponding card
    async function addServiceTaxToCard(serviceType, tax) {
      const cardId = getCardIdByServiceType(serviceType);
      if (!cardId) return;
      const cardRef = db.collection('serviceCards').doc(cardId);
      await db.runTransaction(async (transaction) => {
        const cardDoc = await transaction.get(cardRef);
        const currentGolds = cardDoc.exists ? (cardDoc.data().golds || 0) : 0;
        transaction.set(cardRef, {
          golds: currentGolds + tax,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
      });
    }
    // Get card ID by service type
    function getCardIdByServiceType(serviceType) {
      const cardMap = {
        "Microinfluenciador do Facebook": "facebook",
        "Microinfluenciador do Instagram": "instagram",
        "Aplicativo mﾃｳvel": "mobile",
        "Telegrama": "telegram",
        "TikTok": "tiktok",
        "Marketing de vﾃｭdeo": "video",
        "Discord": "discord",
        "Comente em outros blogs": "blog",
        "Reddit": "reddit",
        "SEO, Promover Conteﾃｺdo, Pesquisar, Engajar": "seo",
        "Inscrever-se": "inscricoes"
      };
      return cardMap[serviceType];
    }
    // Load market data from Firestore
    function carregarMercadoFirebase(userId) {
      console.log("沐 Carregando dados do mercado para:", userId);
      // Update user info
      const user = auth.currentUser;
      if (user) {
        document.getElementById('user-info').textContent = `${user.displayName || 'Usuﾃ｡rio'} (ID: ${user.uid})`;
      }
      // Load user's wallet balance
      db.collection('wallets').doc(userId).onSnapshot((doc) => {
        if (doc.exists) {
          const data = doc.data();
          updateBalanceDisplay(data.goldsBalance || 0, data.reaisBalance || 0);
        } else {
          updateBalanceDisplay(0, 0);
        }
      });
      // Load user's services
      db.collection("services")
        .where("ownerId", "==", userId)
        .onSnapshot((snapshot) => {
          const userServices = [];
          snapshot.forEach((doc) => {
            userServices.push({ id: doc.id, ...doc.data() });
          });
          renderUserServices(userServices, userId);
        });
      // Load public services
      loadPublicServices(userId);
    }
    function loadPublicServices(userId) {
      db.collection("services")
        .orderBy("createdAt", "desc")
        .limit(currentServicesLimit)
        .onSnapshot((snapshot) => {
          const publicServices = [];
          snapshot.forEach((doc) => {
            const service = { id: doc.id, ...doc.data() };
            if (service.status?.toLowerCase().trim() !== "ativo") return;
            if (service.ownerId === userId) return;
            publicServices.push(service);
          });
          renderPublicServices(publicServices, userId);
        });
    }
    // Render user-specific services
    function renderUserServices(services, userId) {
      const container = document.querySelector("#userServices .services-list-content");
      if (!container) return;
      container.innerHTML = services.length
        ? services.map(s => `
          <div class="service-card ${s.status === 'pending' || s.status === 'pendente_aprovaﾃｧﾃ｣o' || s.status === 'aguardando_confirmaﾃｧﾃ｣o' ? 'pending' : s.status === 'concluﾃｭdo' || s.status === 'finalizado' ? 'completed' : ''}">
            <h3>${s.title || 'Sem tﾃｭtulo'}</h3>
            <p>Zona: ${s.zone || 'Nﾃ｣o especificado'}</p>
            <p>Tipo: ${s.serviceType || 'Nﾃ｣o especificado'}</p>
            <p>Subcategoria: ${s.subcategory || 'Nﾃ｣o especificado'}</p>
            <div class="golds-reward">Recompensa: ${s.rewardGolds || 0} Golds</div>
            <div class="steps-list">
              <p>Passos:</p>
              <ul>
                ${s.steps && s.steps.length ? s.steps.map(step => `<li>${step}</li>`).join('') : '<li>Sem passos</li>'}
              </ul>
            </div>
            <div class="proofs-list">
              <p>Provas Necessﾃ｡rias:</p>
              <ul>
                ${s.proofs && s.proofs.length ? s.proofs.map(proof => `<li>${proof.type}: ${proof.description}</li>`).join('') : '<li>Sem provas</li>'}
              </ul>
            </div>
            ${s.proof ? `
              <div class="proofs-list">
                <p>Prova Enviada:</p>
                <p>${s.proof.proofText}</p>
              </div>
            ` : ''}
            <p>Freelancers: ${s.freelancers || 1}</p>
            <p>Status: ${s.status || 'Disponﾃｭvel'}</p>
            <div class="action-buttons">
              <button class="edit-button" onclick="editService('${s.id}')">Editar</button>
              <button class="delete-button" onclick="deleteService('${s.id}')">Excluir</button>
              ${s.status === 'aguardando_confirmaﾃｧﾃ｣o' && s.ownerId === userId ? `<button class="claim-button" onclick="confirmarProvaFirebase('${s.id}', '${s.claimedBy}')">Confirmar Prova</button>` : ''}
            </div>
          </div>`).join("")
        : "<p>Nenhum serviﾃｧo publicado ainda.</p>";
    }
    // Render public services in carousel
    function renderPublicServices(services, userId) {
      const container = document.querySelector("#carousel");
      if (!container) return;
      container.innerHTML = services.length
        ? services.map(s => `
          <div class="service-card ${s.status === 'pending' || s.status === 'pendente_aprovaﾃｧﾃ｣o' || s.status === 'aguardando_confirmaﾃｧﾃ｣o' ? 'pending' : s.status === 'concluﾃｭdo' || s.status === 'finalizado' ? 'completed' : ''}">
            <h3>${s.title || 'Sem tﾃｭtulo'}</h3>
            <p>Zona: ${s.zone || 'Nﾃ｣o especificado'}</p>
            <p>Tipo: ${s.serviceType || 'Nﾃ｣o especificado'}</p>
            <p>Subcategoria: ${s.subcategory || 'Nﾃ｣o especificado'}</p>
            <div class="golds-reward">Recompensa: ${s.rewardGolds || 0} Golds</div>
            <div class="steps-list">
              <p>Passos:</p>
              <ul>
                ${s.steps && s.steps.length ? s.steps.map(step => `<li>${step}</li>`).join('') : '<li>Sem passos</li>'}
              </ul>
            </div>
            <div class="proofs-list">
              <p>Provas Necessﾃ｡rias:</p>
              <ul>
                ${s.proofs && s.proofs.length ? s.proofs.map(proof => `<li>${proof.type}: ${proof.description}</li>`).join('') : '<li>Sem provas</li>'}
              </ul>
            </div>
            <p>Freelancers: ${s.freelancers || 1}</p>
            <p>Status: ${s.status || 'Disponﾃｭvel'}</p>
            ${s.ownerId !== userId && s.status === 'ativo' ? `<button class="claim-button" onclick="openClaimModal('${s.id}', '${s.ownerId}', ${s.rewardGolds || 0})">Reivindicar</button>` : ''}
            ${s.claimedBy === userId && s.status === 'concluﾃｭdo' ? `<button class="claim-button" onclick="openProofModal('${s.id}')">Enviar Prova</button>` : ''}
          </div>`).join("")
        : "<p>Nenhum serviﾃｧo disponﾃｭvel.</p>";
    }
    // Open claim modal with service details
    function openClaimModal(serviceId, ownerId, rewardGolds) {
      currentServiceId = serviceId;
      currentOwnerId = ownerId;
      currentRewardGolds = rewardGolds;
      document.getElementById('claimDetails').textContent = `Vocﾃｪ estﾃ｡ prestes a reivindicar este serviﾃｧo por ${rewardGolds} Golds.`;
      document.getElementById('claimModal').style.display = 'flex';
    }
    // Open proof submission modal
    function openProofModal(serviceId) {
      currentServiceId = serviceId;
      const proofInputs = document.getElementById('proofInputs');
      proofInputs.innerHTML = `
        <div class="form-group">
          <label for="proofText">Descriﾃｧﾃ｣o da Prova</label>
          <textarea id="proofText" placeholder="Insira a descriﾃｧﾃ｣o ou evidﾃｪncia do serviﾃｧo" required></textarea>
        </div>
      `;
      document.getElementById('proofModal').style.display = 'flex';
    }
    // Publish service to Firestore
    async function publicarServicoFirebase(userId) {
      const form = document.getElementById('publishForm');
      const title = form.querySelector('#serviceName').value.trim();
      const zone = form.querySelector('#zone').value.trim();
      const serviceType = form.querySelector('#serviceType').value.trim();
      const subcategory = form.querySelector('#subcategory').value.trim();
      const freelancers = parseInt(form.querySelector('#freelancers').value) || 1;
      const rewardGoldsInput = form.querySelector('#rewardGolds');
      const rewardGolds = parseInt(rewardGoldsInput.value) || 0;
      const rewardGoldsMin = parseInt(rewardGoldsInput.min) || 1;
      const price = freelancers * rewardGolds;
      const steps = Array.from(form.querySelectorAll('#stepsContainer textarea'))
        .map(textarea => textarea.value.trim())
        .filter(step => step);
      const proofs = Array.from(form.querySelectorAll('#proofsContainer .proof-input')).map(proofInput => ({
        type: proofInput.querySelector('.proof-type').value.trim(),
        description: proofInput.querySelector('textarea').value.trim()
      })).filter(proof => proof.description);
      if (!title || !zone || !serviceType || !subcategory || freelancers <= 0 || rewardGolds < rewardGoldsMin || price <= 0 || steps.length === 0 || proofs.length === 0) {
        showModal('errorModal', `笞ｸ Por favor, preencha todos os campos corretamente, incluindo pelo menos um passo e uma prova. A recompensa por tarefa deve ser no mﾃｭnimo ${rewardGoldsMin} Golds.`);
        return;
      }
      const user = auth.currentUser;
      if (!user) {
        showModal('errorModal', '笞ｸ ﾃ necessﾃ｡rio estar logado para publicar um serviﾃｧo.');
        window.location.href = 'login.html';
        return;
      }
      const publicationFee = 20;
      const serviceTax = 10;
      try {
        await ensureWalletExists(userId, user.displayName || 'Usuﾃ｡rio');
        await db.runTransaction(async (transaction) => {
          const walletRef = db.collection('wallets').doc(userId);
          const walletDoc = await transaction.get(walletRef);
          const currentBalance = walletDoc.exists ? walletDoc.data().goldsBalance || 0 : 0;
          if (currentBalance < price + publicationFee + serviceTax) {
            throw new Error('Saldo insuficiente para a taxa de publicaﾃｧﾃ｣o, custo do serviﾃｧo e taxa especﾃｭfica.');
          }
          const newService = {
            ownerId: user.uid,
            ownerName: user.displayName || 'Usuﾃ｡rio',
            title,
            zone,
            serviceType,
            subcategory,
            steps,
            proofs,
            freelancers,
            price,
            rewardGolds,
            status: 'ativo',
            createdAt: new Date()
          };
          const serviceRef = db.collection('services').doc();
          transaction.set(serviceRef, newService);
          // Atualiza a carteira do usuﾃ｡rio
          transaction.update(walletRef, {
            goldsBalance: currentBalance - (price + publicationFee + serviceTax),
            transactions: firebase.firestore.FieldValue.arrayUnion({
              type: 'service_publication',
              amount: -(price + publicationFee + serviceTax),
              currency: 'golds',
              description: `Publicaﾃｧﾃ｣o do serviﾃｧo: ${title}`,
              date: new Date()
            }),
            ultimaPublicacao: firebase.firestore.FieldValue.serverTimestamp()
          });
          // Adiciona os 10 Golds ao card correspondente
          await addServiceTaxToCard(serviceType, serviceTax);
        });
        showModal('successModal', '笨 Operaﾃｧﾃ｣o concluﾃｭda com sucesso! Clique em OK para continuar.', false);
        form.reset();
        calculateCost();
        updateSubcategories();
      } catch (error) {
        console.error('Erro ao publicar serviﾃｧo:', error);
        showModal('errorModal', `笶 Ocorreu um erro: ${error.message}`);
      }
    }
    // Claim a service
    async function claimServiceFirebase(serviceId, ownerId, rewardGolds) {
      const user = auth.currentUser;
      if (!user) {
        showModal('errorModal', '笞ｸ ﾃ necessﾃ｡rio estar logado para reivindicar um serviﾃｧo.');
        window.location.href = 'login.html';
        return;
      }
      if (user.uid === ownerId) {
        showModal('errorModal', '笞ｸ Vocﾃｪ nﾃ｣o pode reivindicar seu prﾃｳprio serviﾃｧo.');
        return;
      }
      try {
        await ensureWalletExists(user.uid, user.displayName || 'Usuﾃ｡rio');
        await ensureWalletExists(ownerId);
        await sincronizarMercadoFirebase(user.uid, serviceId, {
          rewardGolds,
          type: 'service_claim',
          description: `Reivindicou serviﾃｧo ID: ${serviceId}`
        });
        showModal('successModal', '笨 Operaﾃｧﾃ｣o concluﾃｭda com sucesso! Clique em OK para continuar.', false);
      } catch (error) {
        console.error('Erro ao reivindicar serviﾃｧo:', error);
        let errorMessage = '笶 Ocorreu um erro ao reivindicar o serviﾃｧo.';
        if (error.message.includes('Saldo do dono insuficiente')) {
          errorMessage = '笶 O dono do serviﾃｧo nﾃ｣o possui saldo suficiente para pagar a recompensa.';
        } else if (error.message.includes('nﾃ｣o estﾃ｡ disponﾃｭvel')) {
          errorMessage = '笶 Este serviﾃｧo nﾃ｣o estﾃ｡ mais disponﾃｭvel para reivindicaﾃｧﾃ｣o.';
        }
        showModal('errorModal', errorMessage);
      }
    }
    // Confirm claim
    async function confirmClaim(serviceId, ownerId, rewardGolds) {
      try {
        const user = auth.currentUser;
        if (!user) {
          showModal('errorModal', 'Vocﾃｪ precisa estar logado para reivindicar um serviﾃｧo.');
          return;
        }
        const userId = user.uid;
        await sincronizarMercadoFirebase(userId, serviceId, {
          rewardGolds,
          type: 'service_claim',
          description: `Reivindicou serviﾃｧo ID: ${serviceId}`
        });
        showModal('successModal', '笨 Operaﾃｧﾃ｣o concluﾃｭda com sucesso! Clique em OK para continuar.', false);
        closeModal('claimModal');
        carregarMercadoFirebase(userId);
      } catch (error) {
        console.error("Erro ao reivindicar serviﾃｧo:", error);
        showModal('errorModal', '笶 Ocorreu um erro ao concluir o serviﾃｧo. Tente novamente.');
      }
    }
    // Edit a service
    async function editService(serviceId) {
      const user = auth.currentUser;
      if (!user) {
        showModal('errorModal', '笞ｸ ﾃ necessﾃ｡rio estar logado para editar um serviﾃｧo.');
        window.location.href = 'login.html';
        return;
      }
      try {
        const serviceRef = db.collection('services').doc(serviceId);
        const serviceDoc = await serviceRef.get();
        if (!serviceDoc.exists) {
          showModal('errorModal', '笞ｸ Serviﾃｧo nﾃ｣o encontrado.');
          return;
        }
        const service = serviceDoc.data();
        if (service.ownerId !== user.uid) {
          showModal('errorModal', '笞ｸ Vocﾃｪ nﾃ｣o tem permissﾃ｣o para editar este serviﾃｧo.');
          return;
        }
        // Populate edit form
        const editForm = document.getElementById('editForm');
        document.getElementById('editServiceName').value = service.title || '';
        document.getElementById('editZone').value = service.zone || '';
        document.getElementById('editServiceType').value = service.serviceType || '';
        updateSubcategories('editSubcategory', 'editRewardGolds', 'editDifficultyInfo', 'editServiceType');
        document.getElementById('editSubcategory').value = service.subcategory || '';
        handleSubcategoryChange('editSubcategory', 'editRewardGolds', 'editDifficultyInfo', 'editServiceType');
        document.getElementById('editFreelancers').value = service.freelancers || 1;
        document.getElementById('editRewardGolds').value = service.rewardGolds || 1;
        const editStepsContainer = document.getElementById('editStepsContainer');
        editStepsContainer.innerHTML = '<label>Passos do Serviﾃｧo</label>';
        service.steps.forEach(step => {
          const stepInput = document.createElement('div');
          stepInput.className = 'step-input';
          stepInput.innerHTML = `<textarea required>${step}</textarea>`;
          editStepsContainer.appendChild(stepInput);
        });
        const editProofsContainer = document.getElementById('editProofsContainer');
        editProofsContainer.innerHTML = '<label>Provas Necessﾃ｡rias</label>';
        service.proofs.forEach(proof => {
          const proofInput = document.createElement('div');
          proofInput.className = 'proof-input';
          proofInput.innerHTML = `
            <select class="proof-type" required>
              <option value="Texto" ${proof.type === 'Texto' ? 'selected' : ''}>Texto</option>
              <option value="Captura de Tela" ${proof.type === 'Captura de Tela' ? 'selected' : ''}>Captura de Tela</option>
            </select>
            <textarea required>${proof.description}</textarea>
          `;
          editProofsContainer.appendChild(proofInput);
        });
        // Show edit modal
        document.getElementById('editModal').style.display = 'flex';
        // Handle edit form submission
        editForm.onsubmit = async (e) => {
          e.preventDefault();
          await editarServicoFirebase(serviceId);
        };
      } catch (error) {
        console.error('Erro ao carregar serviﾃｧo para ediﾃｧﾃ｣o:', error);
        showModal('errorModal', '笶 Ocorreu um erro ao carregar o serviﾃｧo.');
      }
    }
    // Submit edited service
    async function editarServicoFirebase(serviceId) {
      const user = auth.currentUser;
      if (!user) {
        showModal('errorModal', '笞ｸ ﾃ necessﾃ｡rio estar logado para editar um serviﾃｧo.');
        window.location.href = 'login.html';
        return;
      }
      const editForm = document.getElementById('editForm');
      const title = editForm.querySelector('#editServiceName').value.trim();
      const zone = editForm.querySelector('#editZone').value.trim();
      const serviceType = editForm.querySelector('#editServiceType').value.trim();
      const subcategory = editForm.querySelector('#editSubcategory').value.trim();
      const freelancers = parseInt(editForm.querySelector('#editFreelancers').value) || 1;
      const rewardGoldsInput = editForm.querySelector('#editRewardGolds');
      const rewardGolds = parseInt(rewardGoldsInput.value) || 0;
      const rewardGoldsMin = parseInt(rewardGoldsInput.min) || 1;
      const price = freelancers * rewardGolds;
      const steps = Array.from(editForm.querySelectorAll('#editStepsContainer textarea'))
        .map(textarea => textarea.value.trim())
        .filter(step => step);
      const proofs = Array.from(editForm.querySelectorAll('#editProofsContainer .proof-input')).map(proofInput => ({
        type: proofInput.querySelector('.proof-type').value.trim(),
        description: proofInput.querySelector('textarea').value.trim()
      })).filter(proof => proof.description);
      if (!title || !zone || !serviceType || !subcategory || freelancers <= 0 || rewardGolds < rewardGoldsMin || price <= 0 || steps.length === 0 || proofs.length === 0) {
        showModal('errorModal', `笞ｸ Por favor, preencha todos os campos corretamente, incluindo pelo menos um passo e uma prova. A recompensa por tarefa deve ser no mﾃｭnimo ${rewardGoldsMin} Golds.`);
        return;
      }
      try {
        await sincronizarMercadoFirebase(user.uid, serviceId, {
          title,
          zone,
          serviceType,
          subcategory,
          steps,
          proofs,
          freelancers,
          price,
          rewardGolds,
          type: 'service_edit',
          description: `Editou serviﾃｧo: ${title}`
        });
        showModal('successModal', '笨 Operaﾃｧﾃ｣o concluﾃｭda com sucesso! Clique em OK para continuar.', false);
        closeModal('editModal');
        carregarMercadoFirebase(user.uid);
      } catch (error) {
        console.error('Erro ao editar serviﾃｧo:', error);
        showModal('errorModal', `笶 Ocorreu um erro: ${error.message}`);
      }
    }
    // Delete a service
    async function deleteService(serviceId) {
      const user = auth.currentUser;
      if (!user) {
        showModal('errorModal', '笞ｸ ﾃ necessﾃ｡rio estar logado para excluir um serviﾃｧo.');
        window.location.href = 'login.html';
        return;
      }
      try {
        const serviceRef = db.collection('services').doc(serviceId);
        const serviceDoc = await serviceRef.get();
        if (!serviceDoc.exists) {
          showModal('errorModal', '笞ｸ Serviﾃｧo nﾃ｣o encontrado.');
          return;
        }
        if (serviceDoc.data().ownerId !== user.uid) {
          showModal('errorModal', '笞ｸ Vocﾃｪ nﾃ｣o tem permissﾃ｣o para excluir este serviﾃｧo.');
          return;
        }
        await serviceRef.delete();
        showModal('successModal', '笨 Operaﾃｧﾃ｣o concluﾃｭda com sucesso! Clique em OK para continuar.', false);
        carregarMercadoFirebase(user.uid);
      } catch (error) {
        console.error('Erro ao excluir serviﾃｧo:', error);
        showModal('errorModal', `笶 Ocorreu um erro: ${error.message}`);
      }
    }
    // Synchronize market data with Firestore
    async function sincronizarMercadoFirebase(userId, serviceId, data) {
      await db.runTransaction(async (transaction) => {
        const serviceRef = db.collection('services').doc(serviceId);
        const serviceDoc = await transaction.get(serviceRef);
        if (!serviceDoc.exists) {
          throw new Error('Serviﾃｧo nﾃ｣o encontrado.');
        }
        const serviceData = serviceDoc.data();
        // Padroniza formato de transaﾃｧﾃｵes
        const makeTransactionObj = (type, amount, description) => ({
          type,
          amount,
          currency: 'golds',
          description,
          date: new Date()
        });
        // CLAIM: pagar recompensas 窶 debitar dono e creditar claimant
        if (data.type === 'service_claim') {
          if (serviceData.status !== 'ativo') {
            throw new Error('Este serviﾃｧo nﾃ｣o estﾃ｡ disponﾃｭvel para reivindicaﾃｧﾃ｣o.');
          }
          if (!serviceData.ownerId) {
            throw new Error('Serviﾃｧo sem dono definido.');
          }
          const ownerRef = db.collection('wallets').doc(serviceData.ownerId);
          const claimantRef = db.collection('wallets').doc(userId);
          const ownerDoc = await transaction.get(ownerRef);
          const claimantDoc = await transaction.get(claimantRef);
          const ownerBalance = ownerDoc.exists ? (ownerDoc.data().goldsBalance || 0) : 0;
          const claimantBalance = claimantDoc.exists ? (claimantDoc.data().goldsBalance || 0) : 0;
          const reward = Number(data.rewardGolds || 0);
          if (ownerBalance < reward) {
            throw new Error('Saldo do dono insuficiente para pagar a recompensa.');
          }
          const ownerTxDesc = `Pagamento por serviﾃｧo ${serviceData.serviceType || 'desconhecido'} ID: ${serviceId}`;
          const claimantTxDesc = `Reivindicou serviﾃｧo ${serviceData.serviceType || 'desconhecido'} ID: ${serviceId}`;
          // Atualiza serviﾃｧo
          transaction.update(serviceRef, {
            status: 'concluﾃｭdo',
            claimedBy: userId,
            claimedAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          // Debita dono
          transaction.update(ownerRef, {
            goldsBalance: ownerBalance - reward,
            transactions: firebase.firestore.FieldValue.arrayUnion(
              makeTransactionObj('service_payout', -reward, ownerTxDesc)
            )
          });
          // Credita claimant
          transaction.update(claimantRef, {
            goldsBalance: claimantBalance + reward,
            transactions: firebase.firestore.FieldValue.arrayUnion(
              makeTransactionObj('service_claim', reward, claimantTxDesc)
            )
          });
          return;
        }
        // EDIT: atualizaﾃｧﾃ｣o de campos (apenas proprietario)
        if (data.type === 'service_edit') {
          if (serviceData.ownerId !== userId) {
            throw new Error('Vocﾃｪ nﾃ｣o tem permissﾃ｣o para editar este serviﾃｧo.');
          }
          const updateData = {
            title: data.title,
            zone: data.zone,
            serviceType: data.serviceType,
            subcategory: data.subcategory,
            steps: data.steps,
            proofs: data.proofs,
            freelancers: data.freelancers,
            price: data.price,
            rewardGolds: data.rewardGolds,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          };
          transaction.update(serviceRef, updateData);
          return;
        }
        // outros tipos...
        throw new Error('Tipo de sincronizaﾃｧﾃ｣o nﾃ｣o tratado.');
      });
    }
    // Submit proofs
    async function submitProofs(serviceId) {
      const userId = auth.currentUser?.uid;
      if (!userId) {
        showModal('errorModal', 'Usuﾃ｡rio nﾃ｣o autenticado. Faﾃｧa login novamente.');
        return;
      }
      await enviarProvasFirebase(serviceId, userId);
    }
    // Handle IP consent
    async function acceptIPConsent() {
      localStorage.setItem('ipConsent', 'true');
      const user = auth.currentUser;
      if (user) {
        try {
          await db.collection('users').doc(user.uid).set({
            ipConsent: true,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          }, { merge: true });
          showModal('successModal', '笨 Consentimento de IP aceito com sucesso!', false);
        } catch (error) {
          console.error('Erro ao salvar consentimento de IP:', error);
          showModal('errorModal', `笶 Erro ao salvar consentimento de IP: ${error.message}`);
        }
      }
      document.getElementById('cookieBanner').style.display = 'none';
    }
    async function declineIPConsent() {
      localStorage.setItem('ipConsent', 'false');
      const user = auth.currentUser;
      if (user) {
        try {
          await db.collection('users').doc(user.uid).set({
            ipConsent: false,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          }, { merge: true });
          showModal('successModal', '笨 Consentimento de IP recusado com sucesso!', false);
        } catch (error) {
          console.error('Erro ao salvar recusa de consentimento de IP:', error);
          showModal('errorModal', `笶 Erro ao salvar recusa de consentimento: ${error.message}`);
        }
      }
      document.getElementById('cookieBanner').style.display = 'none';
    }
    // === ENVIAR PROVAS DE EXECUﾃﾃグ ===
    async function enviarProvasFirebase(serviceId, userId) {
      const proofText = document.getElementById('proofText')?.value.trim();
      if (!proofText) {
        showModal('errorModal', 'Por favor, envie uma descriﾃｧﾃ｣o ou evidﾃｪncia vﾃ｡lida.');
        return;
      }
      const serviceRef = db.collection('services').doc(serviceId);
      const walletRef = db.collection('wallets').doc(userId);
      try {
        const serviceDoc = await serviceRef.get();
        if (!serviceDoc.exists) throw new Error('Serviﾃｧo nﾃ｣o encontrado.');
        const serviceData = serviceDoc.data();
        if (serviceData.claimedBy !== userId) {
          throw new Error('Vocﾃｪ nﾃ｣o ﾃｩ o responsﾃ｡vel por este serviﾃｧo.');
        }
        if (serviceData.status !== 'concluﾃｭdo') {
          throw new Error('O serviﾃｧo ainda nﾃ｣o foi concluﾃｭdo.');
        }
        // Atualiza serviﾃｧo com prova
        await serviceRef.update({
          proof: {
            proofText,
            userId,
            date: new Date()
          },
          status: 'aguardando_confirmaﾃｧﾃ｣o',
          proofDate: firebase.firestore.FieldValue.serverTimestamp()
        });
        // Adiciona transaﾃｧﾃ｣o temporﾃ｡ria na carteira
        const walletDoc = await walletRef.get();
        const walletData = walletDoc.data() || { transactions: [] };
        const transactions = walletData.transactions || [];
        transactions.push({
          type: 'aguardando_confirmaﾃｧﾃ｣o',
          description: `Prova enviada para serviﾃｧo: ${serviceData.title}`,
          amount: serviceData.rewardGolds,
          date: new Date()
        });
        await walletRef.update({ transactions });
        showModal('successModal', '笨 Prova enviada com sucesso! Aguardando confirmaﾃｧﾃ｣o do anunciante.', false);
        closeModal('proofModal');
        carregarMercadoFirebase(userId);
      } catch (error) {
        console.error('Erro ao enviar prova:', error);
        showModal('errorModal', `笶 Erro ao enviar prova: ${error.message}`);
      }
    }
    // === CONFIRMAR PROVA ===
    async function confirmarProvaFirebase(serviceId, claimantId) {
      const serviceRef = db.collection('services').doc(serviceId);
      const walletRef = db.collection('wallets').doc(claimantId);
      const ownerId = auth.currentUser?.uid;
      try {
        if (!ownerId) throw new Error('Usuﾃ｡rio nﾃ｣o autenticado.');
        const serviceDoc = await serviceRef.get();
        if (!serviceDoc.exists) throw new Error('Serviﾃｧo nﾃ｣o encontrado.');
        const serviceData = serviceDoc.data();
        if (serviceData.ownerId !== ownerId) {
          throw new Error('Vocﾃｪ nﾃ｣o tem permissﾃ｣o para confirmar este serviﾃｧo.');
        }
        if (serviceData.status !== 'aguardando_confirmaﾃｧﾃ｣o') {
          throw new Error('A prova jﾃ｡ foi confirmada ou o serviﾃｧo estﾃ｡ inativo.');
        }
        if (serviceData.claimedBy !== claimantId) {
          throw new Error('Reivindicador invﾃ｡lido.');
        }
        const claimantTxDesc = `Serviﾃｧo concluﾃｭdo: ${serviceData.serviceType || 'desconhecido'} - ${serviceData.title}`;
        // Atualiza serviﾃｧo
        await serviceRef.update({
          status: 'finalizado',
          confirmedAt: firebase.firestore.FieldValue.serverTimestamp(),
          finalizedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        // Atualiza carteira do usuﾃ｡rio
        const walletDoc = await walletRef.get();
        const walletData = walletDoc.data() || { goldsBalance: 0, transactions: [] };
        const transactions = walletData.transactions || [];
        transactions.push({
          type: 'entrada',
          description: claimantTxDesc,
          amount: serviceData.rewardGolds,
          date: new Date()
        });
        await walletRef.update({ transactions });
        showModal('successModal', '笨 Prova confirmada! Transaﾃｧﾃ｣o registrada.', false);
        carregarMercadoFirebase(ownerId);
      } catch (error) {
        console.error('Erro ao confirmar prova:', error);
        showModal('errorModal', `笶 Falha ao confirmar prova: ${error.message}`);
      }
    }
    // Firebase Authentication
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        await ensureWalletExists(user.uid, user.displayName || 'Usuﾃ｡rio');
        carregarMercadoFirebase(user.uid);
      } else {
        showModal('errorModal', '笞ｸ ﾃ necessﾃ｡rio estar logado para acessar o mercado.');
        window.location.href = 'login.html';
      }
    });
    // Theme toggle event listener
    const themeToggleBtn = document.getElementById('theme-toggle');
    themeToggleBtn.addEventListener('click', () => {
      const body = document.body;
      const newTheme = body.dataset.theme === 'light' ? 'dark' : 'light';
      body.dataset.theme = newTheme;
      saveTheme(newTheme);
    });
    // Ver Mais button
    document.getElementById('verMais').addEventListener('click', () => {
      currentServicesLimit += 20;
      loadPublicServices(auth.currentUser.uid);
    });
    // Add step functionality
    function addStep(containerId = 'stepsContainer') {
      const container = document.getElementById(containerId);
      const newStepDiv = document.createElement('div');
      newStepDiv.className = 'step-input';
      newStepDiv.innerHTML = `
        <textarea placeholder="Ex.: Acesse o link fornecido" required></textarea>
        <div class="add-remove-buttons">
          <button type="button" class="remove-step remove" onclick="removeStep(this)">- Remover Passo</button>
        </div>
      `;
      container.appendChild(newStepDiv);
    }
    // Remove step functionality
    function removeStep(button) {
      if (document.querySelectorAll('#stepsContainer .step-input').length > 1) {
        button.closest('.step-input').remove();
      }
    }
    // Add proof functionality
    function addProof(containerId = 'proofsContainer') {
      const container = document.getElementById(containerId);
      const newProofDiv = document.createElement('div');
      newProofDiv.className = 'proof-input';
      newProofDiv.innerHTML = `
        <select class="proof-type" required>
          <option value="Texto">Texto</option>
          <option value="Captura de Tela">Captura de Tela</option>
        </select>
        <textarea placeholder="Ex.: Screenshot da curtida" required></textarea>
        <div class="add-remove-buttons">
          <button type="button" class="remove-proof remove" onclick="removeProof(this)">- Remover Prova</button>
        </div>
      `;
      container.appendChild(newProofDiv);
    }
    // Remove proof functionality
    function removeProof(button) {
      if (document.querySelectorAll('#proofsContainer .proof-input').length > 1) {
        button.closest('.proof-input').remove();
      }
    }
    // Publish form submit listener
    document.getElementById('publishForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const user = auth.currentUser;
      if (user) {
        publicarServicoFirebase(user.uid);
      } else {
        showModal('errorModal', '笞ｸ ﾃ necessﾃ｡rio estar logado para publicar um serviﾃｧo.');
        window.location.href = 'login.html';
      }
    });
    // Proof form submit listener
    document.getElementById('proofForm').addEventListener('submit', (e) => {
      e.preventDefault();
      submitProofs(currentServiceId);
    });
    // Load theme and initialize dynamic fields
    window.addEventListener('DOMContentLoaded', () => {
      loadTheme();
      // Check IP consent
      if (localStorage.getItem('ipConsent')) {
        document.getElementById('cookieBanner').style.display = 'none';
      }
      // Initialize dynamic cost calculation
      document.getElementById('freelancers')?.addEventListener('input', calculateCost);
      document.getElementById('rewardGolds')?.addEventListener('input', calculateCost);
      // Initialize dynamic subcategories
      document.getElementById('serviceType')?.addEventListener('change', () => {
        updateSubcategories();
        handleSubcategoryChange();
      });
      document.getElementById('subcategory')?.addEventListener('change', handleSubcategoryChange);
      updateSubcategories();
      // For edit modal
      document.getElementById('editServiceType')?.addEventListener('change', () => {
        updateSubcategories('editSubcategory', 'editRewardGolds', 'editDifficultyInfo', 'editServiceType');
        handleSubcategoryChange('editSubcategory', 'editRewardGolds', 'editDifficultyInfo', 'editServiceType');
      });
      document.getElementById('editSubcategory')?.addEventListener('change', () => handleSubcategoryChange('editSubcategory', 'editRewardGolds', 'editDifficultyInfo', 'editServiceType'));
      // Event delegation for add/remove buttons
      document.addEventListener('click', (e) => {
        if (e.target.classList.contains('add-step')) {
          addStep();
          e.target.textContent = '+ Adicionar Outro Passo';
        } else if (e.target.classList.contains('add-proof')) {
          addProof();
          e.target.textContent = '+ Adicionar Outra Prova';
        }
      });
    });
  </script>
</body>
</html>
