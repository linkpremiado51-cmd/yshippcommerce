<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Centro de Comando - YshippCommerce">
  <title>Centro de Comando - YshippCommerce</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --background: #f5f7fa;
      --surface: #ffffff;
      --text-primary: #1a202c;
      --text-secondary: #4a5568;
      --primary: #2d3748;
      --primary-hover: #1a202c;
      --secondary: #3182ce;
      --secondary-hover: #2b6cb0;
      --border: #e2e8f0;
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.15);
      --accent: #e53e3e;
      --gold: #d69e2e;
      --progress-bg: #edf2f7;
    }
    [data-theme="dark"] {
      --background: #1a202c;
      --surface: #2d3748;
      --text-primary: #e2e8f0;
      --text-secondary: #a0aec0;
      --border: #4a5568;
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.4);
      --accent: #f56565;
      --progress-bg: #4a5568;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      user-select: none;
      -webkit-user-select: none;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--background);
      color: var(--text-primary);
      line-height: 1.5;
      min-height: 100vh;
      padding-top: 60px;
      overflow-x: hidden;
    }
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 16px;
      z-index: 1001;
      box-shadow: var(--shadow);
    }
    .header h1 {
      font-size: 1.125rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .header h1 i {
      color: var(--primary);
    }
    .top-bar__section {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .top-bar__icon {
      color: var(--text-primary);
      background: none;
      border: none;
      padding: 8px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .top-bar__icon i {
      font-size: 1.125rem;
    }
    .top-bar__icon:hover {
      background: var(--primary);
      color: white;
    }
    .menu {
      position: fixed;
      top: 60px;
      left: 0;
      width: 240px;
      height: calc(100vh - 60px);
      background: var(--surface);
      border-right: 1px solid var(--border);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
      box-shadow: var(--shadow);
    }
    .menu.open {
      transform: translateX(0);
    }
    .menu__list {
      list-style: none;
      padding: 12px 0;
    }
    .menu__item {
      margin: 4px 12px;
    }
    .menu__link {
      color: var(--text-primary);
      text-decoration: none;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      border-radius: 4px;
      transition: background 0.2s ease;
      background: transparent;
    }
    .menu__link:hover {
      background: var(--primary);
      color: white;
    }
    .menu__link i {
      margin-right: 8px;
      font-size: 1.125rem;
      color: var(--text-secondary);
      transition: color 0.2s ease;
    }
    .menu__link:hover i {
      color: white;
    }
    .premium-button {
      background: var(--secondary);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      width: calc(100% - 24px);
      margin: 12px;
      font-weight: 500;
      transition: background 0.2s ease;
    }
    .premium-button:hover {
      background: var(--secondary-hover);
    }
    .notification {
      position: fixed;
      bottom: 16px;
      right: 16px;
      padding: 8px 16px;
      background: var(--surface);
      color: var(--text-primary);
      border-radius: 4px;
      box-shadow: var(--shadow-lg);
      opacity: 0;
      transform: translateY(16px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 2000;
    }
    .notification.show {
      opacity: 1;
      transform: translateY(0);
    }
    .dashboard-section {
      width: 100%;
      max-width: 1000px;
      padding: 1rem;
      background: var(--surface);
      border-radius: 8px;
      box-shadow: var(--shadow);
      margin: 1rem auto;
      border: 1px solid var(--border);
    }
    .dashboard-section h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .dashboard-section h2 i {
      color: var(--secondary);
    }
    .carousel-container {
      position: relative;
      width: 100%;
      overflow: hidden;
      margin-top: 0.75rem;
    }
    .carousel {
      display: flex;
      transition: transform 0.5s ease;
      width: 100%;
      gap: 0.75rem;
      touch-action: pan-x;
    }
    .carousel .nav-card {
      flex: 0 0 100%;
      min-width: 100%;
      max-width: 100%;
    }
    .nav-card {
      background: var(--surface);
      border-radius: 8px;
      padding: 1rem;
      box-shadow: var(--shadow);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border: 1px solid var(--border);
      text-align: center;
      position: relative;
    }
    .nav-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }
    .nav-card i {
      font-size: 2rem;
      margin-bottom: 0.75rem;
      display: block;
    }
    .nav-card h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }
    .nav-card p {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
    }
    .cookie-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--surface);
      color: var(--text-primary);
      padding: 0.75rem;
      box-shadow: var(--shadow);
      border-top: 1px solid var(--border);
      z-index: 1000;
      display: none;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
      text-align: center;
    }
    .cookie-banner.active {
      display: flex;
    }
    [data-theme="dark"] .cookie-banner {
      background: var(--surface);
      border-top: 1px solid var(--border);
    }
    .cookie-banner .content {
      font-size: 0.85rem;
    }
    .cookie-banner .content a {
      color: var(--secondary);
      text-decoration: underline;
    }
    .cookie-banner .content a:hover {
      color: var(--secondary-hover);
    }
    .cookie-banner .buttons {
      display: flex;
      gap: 0.5rem;
    }
    .cookie-banner button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease;
      font-size: 0.85rem;
    }
    .cookie-banner button.accept {
      background: var(--secondary);
      color: white;
    }
    .cookie-banner button.accept:hover {
      background: var(--secondary-hover);
    }
    .cookie-banner button.decline {
      background: transparent;
      color: var(--text-primary);
      border: 1px solid var(--border);
    }
    .cookie-banner button.decline:hover {
      background: var(--accent);
      color: white;
    }
    .wallet-card {
      background: var(--surface);
      border-radius: 8px;
      padding: 1rem;
      box-shadow: var(--shadow);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      color: var(--text-primary);
      text-align: center;
      margin: 1rem auto 0;
      max-width: 300px;
      position: relative;
    }
    .wallet-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }
    .wallet-card i {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      display: block;
      color: var(--secondary);
    }
    .wallet-card h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .wallet-card p {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
    }
    .wallet-card .nav-button {
      width: 100%;
      padding: 0.5rem;
      background: var(--secondary);
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .wallet-card .nav-button:hover {
      background: var(--secondary-hover);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in {
      animation: fadeIn 0.4s ease-out forwards;
    }
    .company-stats {
      margin: 1rem 0;
      padding: 0.75rem;
      background: var(--background);
      border-radius: 4px;
      border: 1px solid var(--border);
    }
    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.4rem 0;
      border-bottom: 1px solid var(--border);
    }
    .stat-item:last-child {
      border-bottom: none;
    }
    .stat-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
    }
    .stat-value {
      font-size: 0.9rem;
      color: var(--primary);
      font-weight: 600;
    }
    .nivel-progress {
      margin-top: 0.75rem;
      text-align: center;
    }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--progress-bg);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }
    .progress-fill {
      height: 100%;
      background: var(--secondary);
      transition: width 0.5s ease;
    }
    .progress-text {
      font-size: 0.75rem;
      color: var(--text-secondary);
      font-weight: 500;
    }
    .company-actions {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
    }
    .action-button {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      background: var(--surface);
      color: var(--text-primary);
      min-width: 120px;
    }
    .action-button:hover {
      background: var(--secondary);
      color: white;
      border-color: var(--secondary);
    }
    .action-button i {
      font-size: 0.9rem;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .modal.active {
        display: flex;
        opacity: 1;
    }
    /* Estilos para o novo modal de fluxo guiado */
    #guidedPublishModal .modal-content {
      /* Largura 100% do container (max-width) e centralizado */
      width: 90%; 
      max-width: 500px;
      /* Altura fixa 350px (card centralizado) */
      height: 350px; 
      /* Altura e largura proporcionais às informações (ajustado no JS) */
      transition: width 0.3s ease, height 0.3s ease; 
      overflow: hidden; /* Esconde conteúdo extra se o JS falhar no ajuste */
      padding: 1rem;
    }
    
    .modal-content {
      background: var(--surface);
      border-radius: 8px;
      box-shadow: var(--shadow-lg);
      position: relative;
    }
    
    .modal-content h2 {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--text-primary);
    }
    .modal-content label {
      display: block;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 0.25rem;
    }
    .modal-content input,
    .modal-content textarea,
    .modal-content select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 0.9rem;
      margin-bottom: 0.75rem;
      background: var(--background);
      color: var(--text-primary);
      outline: none;
    }
    .modal-content textarea {
      resize: vertical;
      min-height: 50px;
    }
    .modal-content input[readonly] {
      background: var(--progress-bg);
      cursor: not-allowed;
    }
    .modal-content button {
      width: 100%;
      padding: 0.75rem;
      background: var(--secondary);
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .modal-content button:hover {
      background: var(--secondary-hover);
    }
    .modal-content .close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: var(--text-secondary);
    }
    .modal-content .error {
      color: var(--accent);
      font-size: 0.85rem;
      margin-bottom: 1rem;
      display: none;
    }

    /* Estilos das Etapas */
    .step {
        display: none;
        height: 100%; /* Força a etapa a ocupar a altura do modal-content */
        opacity: 0;
        transition: opacity 0.3s ease;
        padding-bottom: 40px; /* Espaço para o controle de navegação */
        overflow-y: auto;
    }
    .step.active {
        display: block;
        opacity: 1;
    }
    .fade-in-step {
        opacity: 1 !important;
        animation: fadeIn 0.4s ease-out forwards;
    }
    .step-navigation {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 0.75rem 1rem;
        border-top: 1px solid var(--border);
        background: var(--surface);
        display: flex;
        justify-content: space-between;
        gap: 1rem;
    }
    .step-navigation button {
        flex: 1;
        padding: 0.5rem;
        font-size: 0.85rem;
    }
    .step-navigation .back {
        background: var(--text-secondary);
    }
    .step-navigation .back:hover {
        background: var(--text-primary);
    }
    .step-indicator {
        font-size: 0.8rem;
        color: var(--text-secondary);
        text-align: center;
        margin-bottom: 0.5rem;
    }

    /* Estilos para a lista de passos (Etapa 2) */
    .step-list-container {
        margin-bottom: 0.5rem;
        max-height: 150px;
        overflow-y: auto;
        padding-right: 5px;
    }
    .step-item {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        margin-bottom: 0.5rem;
    }
    .step-item input {
        margin-bottom: 0;
        flex-grow: 1;
    }
    .step-item button {
        width: auto;
        padding: 0.25rem 0.5rem;
        background: var(--accent);
    }
    .add-step-button {
        background: var(--secondary);
        color: white;
        padding: 0.5rem;
        margin-top: 0.5rem;
    }

    /* Estilos para o Resumo (Etapa 4) */
    .summary-item {
        display: flex;
        justify-content: space-between;
        padding: 0.3rem 0;
        font-size: 0.9rem;
        border-bottom: 1px dashed var(--border);
    }
    .summary-item:last-child {
        border-bottom: none;
    }
    .summary-item .label {
        color: var(--text-secondary);
    }
    .summary-item .value {
        font-weight: 600;
        color: var(--text-primary);
    }
    .summary-final-value {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--secondary);
        margin-top: 0.5rem;
        border-top: 2px solid var(--secondary);
        padding-top: 0.5rem;
    }
    /* Estilo para o aviso de duplicação */
    .mode-info-box {
      font-size: 0.8rem;
      color: var(--text-secondary);
      background: var(--background);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0.5rem;
      margin-top: 0.75rem;
      line-height: 1.3;
    }

    @media (max-width: 768px) {
      .menu {
        width: min(80vw, 240px);
      }
      .header {
        padding: 0 12px;
      }
      .top-bar__icon {
        padding: 6px;
      }
      .top-bar__icon i {
        font-size: 1rem;
      }
      .menu__link {
        padding: 8px 10px;
        font-size: 0.85rem;
      }
      .menu__link i {
        font-size: 1rem;
      }
      .premium-button {
        padding: 8px 12px;
        font-size: 0.85rem;
      }
      .notification {
        right: 8px;
        bottom: 8px;
        padding: 8px 12px;
      }
      .carousel .nav-card {
        flex: 0 0 100%;
        min-width: 100%;
        max-width: 100%;
      }
      /* Ajuste no modal para telas pequenas */
      #guidedPublishModal .modal-content {
        height: auto; /* Deixa a altura flexível em telas pequenas */
        max-height: 90vh;
        overflow-y: auto;
        min-height: 350px;
        width: 95%;
        padding: 1rem;
      }
      .step-navigation {
          position: sticky;
          bottom: -1rem; /* Ajusta para parecer fixo dentro do modal scrollável */
          padding: 0.5rem 1rem;
      }
      .step-navigation button {
          padding: 0.75rem;
      }
    }
    @media (max-width: 600px) {
      .header {
        padding: 0.5rem;
      }
      .header h1 {
        font-size: 1rem;
      }
      .dashboard-section {
        padding: 0.75rem;
      }
      .dashboard-section h2 {
        font-size: 1.125rem;
      }
      .nav-card {
        padding: 0.75rem;
      }
      .nav-card h3 {
        font-size: 0.9rem;
      }
      .nav-card i {
        font-size: 1.75rem;
      }
      .cookie-banner .buttons {
        flex-direction: column;
        width: 100%;
      }
      .cookie-banner button {
        width: 100%;
      }
      .wallet-card {
        padding: 0.75rem;
        max-width: 100%;
      }
      .wallet-card i {
        font-size: 1.25rem;
      }
      .company-stats {
        padding: 0.5rem;
      }
      .stat-item {
        padding: 0.3rem 0;
      }
      .stat-label {
        font-size: 0.75rem;
      }
      .stat-value {
        font-size: 0.8rem;
      }
      .action-button {
        padding: 0.5rem;
        font-size: 0.75rem;
      }
      .action-button i {
        font-size: 0.8rem;
      }
    }
    @media (min-width: 601px) and (max-width: 1024px) {
      .header h1 {
        font-size: 1.125rem;
      }
      .dashboard-section {
        padding: 0.75rem;
      }
      .dashboard-section h2 {
        font-size: 1.25rem;
      }
      .wallet-card {
        max-width: 280px;
      }
    }
    footer#userInfoFooter {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--primary);
      color: white;
      text-align: center;
      padding: 0.3rem;
      font-size: 0.8rem;
      border-top: 1px solid var(--border);
      z-index: 999;
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body data-theme="light">
  <div class="header-menu">
    <nav aria-label="Navegação principal" class="header" role="navigation">
      <div class="top-bar__section">
        <h1><i class="fas fa-rocket"></i>Publicar Serviço</h1>
      </div>
      <div class="top-bar__section">
        <button aria-label="Alternar menu" class="top-bar__icon" id="menu-icon">
          <i class="fas fa-bars"></i>
        </button>
        <button aria-label="Alternar tema claro/escuro" class="top-bar__icon" id="theme-toggle" title="Alternar tema">
          <i class="fas fa-adjust"></i>
        </button>
      </div>
    </nav>
    <nav aria-label="Menu principal" class="menu" id="main-menu">
      <ul class="menu__list">
        <li class="menu__item">
          <button class="menu__link" onclick="navigateTo('home')">
            <i class="fas fa-home"></i>
            <span>Página Principal</span>
          </button>
        </li>
        <li class="menu__item">
          <button class="menu__link" onclick="navigateTo('yshippcommerce')">
            <i class="fas fa-store"></i>
            <span>YshippCommerce invest</span>
          </button>
        </li>
        <li class="menu__item">
          <button class="menu__link" onclick="navigateTo('market')">
            <i class="fas fa-briefcase"></i>
            <span>Publicar Serviço</span>
          </button>
        </li>
        <li class="menu__item">
          <button class="menu__link" onclick="navigateTo('store')">
            <i class="fas fa-shopping-cart"></i>
            <span>Shopping Shipp</span>
          </button>
        </li>
        <li class="menu__item">
          <button class="menu__link" onclick="navigateTo('generator')">
            <i class="fas fa-ticket-alt"></i>
            <span>Gerador de Golds</span>
          </button>
        </li>
        <li class="menu__item">
          <button class="menu__link" onclick="navigateTo('wallet')">
            <i class="fas fa-wallet"></i>
            <span>Carteira e Bank Central</span>
          </button>
        </li>
        <li class="menu__item">
          <button class="menu__link" id="logout-button">
            <i class="fas fa-sign-out-alt"></i>
            <span>Sair</span>
          </button>
        </li>
      </ul>
    </nav>
  </div>
  <div class="notification" id="notification"></div>
  
  <div id="guidedPublishModal" class="modal">
    <div class="modal-content" id="modalContent">
      <button class="close" onclick="closeModal()">×</button>
      <h2 id="modalTitle">Publicar Serviço - <span id="modalCompanyName"></span></h2>
      <div id="errorMessage" class="error"></div>
      
      <p class="step-indicator">Etapa <span id="currentStepNumber">1</span> de 4</p>

      <div id="step-1" class="step active">
        <label for="subcategory">1. Selecione a Categoria do Serviço</label>
        <select id="subcategory" required onchange="calculateDifficultyAndProof()">
            <option value="" disabled selected>Escolha uma subcategoria</option>
            </select>
        
        <label for="serviceDifficulty">Nível de Dificuldade</label>
        <input type="text" id="serviceDifficulty" readonly value="Aguardando seleção...">

        <label for="freelancers">2. Quantidade de Freelancers Necessários</label>
        <input type="number" id="freelancers" min="1" required placeholder="Ex: 50" oninput="prepareSummary()">

        <label for="serviceDescription">3. Descrição Rápida do Serviço</label>
        <textarea id="serviceDescription" required placeholder="Ex: Preciso de 50 pessoas para curtir minha foto mais recente."></textarea>
      </div>

      <div id="step-2" class="step">
        <label>1. Defina os Passos do Serviço (Máx. 5)</label>
        <p style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem;">O preço base é <span id="basePriceDisplay">150 Golds</span> e aumenta com cada passo.</p>
        
        <div id="serviceStepsContainer" class="step-list-container">
            <div class="step-item" data-step-id="1">
                <input type="text" placeholder="Passo 1 (Obrigatório)" class="service-step-input" required oninput="updateStepDescription(1, this.value)">
                <button class="bg-red-500 hover:bg-red-700 text-white" style="display: none;" onclick="removeStep(1)"><i class="fas fa-trash"></i></button>
            </div>
        </div>
        
        <button class="add-step-button" onclick="addStep()" id="addStepButton"><i class="fas fa-plus"></i> Adicionar Passo (Total: <span id="stepCount">1</span>)</button>
        
        <div style="margin-top: 1rem;">
          <label for="calculatedReward">Recompensa Total Estimada por Freelancer</label>
          <input type="text" id="calculatedReward" readonly value="150 Golds (Base)">
          
          <div class="mode-info-box" id="modeDuplicationInfo">
            </div>
        </div>
      </div>

      <div id="step-3" class="step">
        <label>1. Descreva a Prova de Execução do Serviço</label>
        <textarea id="proofDescription" required placeholder="Ex: Enviar captura de tela da curtida no perfil."></textarea>
        
        <label>2. Tipos de Prova Exigidos (Mínimo: <span id="minProofCount">1</span>)</label>
        <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
          <label style="display: flex; align-items: center; gap: 0.5rem;">
            <input type="checkbox" id="proofImage" value="Imagem" checked> Imagem
          </label>
          <label style="display: flex; align-items: center; gap: 0.5rem;">
            <input type="checkbox" id="proofText" value="Texto"> Texto
          </label>
        </div>

        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
          *O número mínimo de provas aumenta com a complexidade do serviço.
        </p>
      </div>

      <div id="step-4" class="step">
        <div style="text-align: center; margin-bottom: 1rem;">
          <h3 class="text-xl font-bold" style="color: var(--secondary);">Resumo e Confirmação</h3>
          <p id="summaryUserMessage" style="margin-top: 0.5rem; font-size: 0.9rem;">
            Seu serviço será publicado. Você confirma isso, <span id="summaryUserName">...</span> (<span id="summaryUserId">...</span>)?
          </p>
        </div>
        
        <div style="background: var(--background); padding: 0.75rem; border-radius: 4px;">
            <div class="summary-item">
                <span class="label">Nível de Dificuldade</span>
                <span class="value" id="summaryDifficulty">...</span>
            </div>
            <div class="summary-item">
                <span class="label">Recompensa por Tarefa (Golds)</span>
                <span class="value" id="summaryReward">...</span>
            </div>
            <div class="summary-item">
                <span class="label">Quantidade de Freelancers</span>
                <span class="value" id="summaryFreelancers">...</span>
            </div>
            <div class="summary-item">
                <span class="label">Custo Total Bruto (Golds)</span>
                <span class="value" id="summaryGrossCost">...</span>
            </div>
            <div class="summary-item">
                <span class="label">Taxa da Empresa (1% + 50 Golds)</span>
                <span class="value" id="summaryFee">...</span>
            </div>
            <div class="summary-item" id="summaryDoubledCostRow" style="display: none;">
                <span class="label">Custo Dobrado (Para Funcionários)</span>
                <span class="value" id="summaryDoubledCost">...</span>
            </div>
            <div class="mode-info-box" id="modeDuplicationSummary" style="margin-top: 0.5rem; display: none;">
                </div>
            <div class="summary-final-value">
                <span class="label">Valor Final Total (Golds)</span>
                <span class="value" id="summaryFinalCost">...</span>
            </div>
        </div>

        <p id="summaryWarning" class="error" style="display: none; margin-top: 0.75rem; text-align: center;">Saldo insuficiente em Golds!</p>
        <button onclick="publishService()" id="confirmPublishButton" style="margin-top: 1rem;">Confirmar Publicação</button>
      </div>

      <div class="step-navigation">
        <button class="back" id="backButton" onclick="prevStep()" style="display: none;">
          <i class="fas fa-arrow-left"></i> Voltar
        </button>
        <button class="next" id="nextButton" onclick="nextStep()">
          Avançar <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>
  </div>
  <main style="width:100%; max-width:1000px; padding:0 0.75rem 120px; margin:0 auto;">
    <div id="wallet-card" class="wallet-card fade-in">
      <i class="fas fa-wallet"></i>
      <h3>Carteira</h3>
      <p>Gerencie seus Golds e transações.</p>
      <button class="nav-button" onclick="navigateTo('wallet')">Acessar Carteira</button>
    </div>
    
    <section id="dashboard-section-empresarial" class="dashboard-section fade-in">
      <div id="empresasSection">
        <h2><i class="fas fa-building"></i>Modo Empresarial</h2>
        <p style="margin-bottom: 0.75rem; color: var(--text-secondary); font-size: 0.85rem;">Conheça nossas parceiras e acompanhe seu progresso.</p>
        <div class="carousel-container">
          <div class="carousel" id="company-carousel-empresarial">
            <div class="nav-card company-card fade-in" data-card-id="facebook">
              <i class="fab fa-facebook" style="color: #1877f2;"></i>
              <h3>Micro Influenciador do Facebook</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('facebook', 'Micro Influenciador do Facebook', 'empresarial')">
                  <i class="fas fa-handshake"></i> Contratar
                </button>
                <button class="action-button" onclick="executarMissoes('facebook')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewServices('facebook')">
                  <i class="fas fa-eye"></i> Ver Serviços
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="facebook-golds">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="facebook-nivel">Iniciante de Campanha</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Trabalhadores ativos</span>
                  <span class="stat-value" id="facebook-seguidores">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="facebook-published">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="facebook-active">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="facebook-pending">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="facebook-progress" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="facebook-progress-text">0 / 250.000</span>
              </div>
            </div>
            
            <div class="nav-card company-card fade-in" data-card-id="instagram">
              <i class="fab fa-instagram" style="color: #e4405f;"></i>
              <h3>Micro Influenciador do Instagram</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('instagram', 'Micro Influenciador do Instagram', 'empresarial')">
                  <i class="fas fa-handshake"></i> Contratar
                </button>
                <button class="action-button" onclick="executarMissoes('instagram')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewServices('instagram')">
                  <i class="fas fa-eye"></i> Ver Serviços
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="instagram-golds">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="instagram-nivel">Estagiário de Conteúdo</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Seguidores</span>
                  <span class="stat-value" id="instagram-seguidores">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="instagram-published">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="instagram-active">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="instagram-pending">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="instagram-progress" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="instagram-progress-text">0 / 250.000</span>
              </div>
            </div>
            <div class="nav-card company-card fade-in" data-card-id="mobile">
              <i class="fas fa-mobile-alt" style="color: #4CAF50;"></i>
              <h3>Aplicativo Móvel</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('mobile', 'Aplicativo Móvel', 'empresarial')">
                  <i class="fas fa-handshake"></i> Contratar
                </button>
                <button class="action-button" onclick="executarMissoes('mobile')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewServices('mobile')">
                  <i class="fas fa-eye"></i> Ver Serviços
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Total de Instalações</span>
                  <span class="stat-value" id="mobile-instalacoes">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="mobile-golds">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="mobile-nivel">Programador Iniciante</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="mobile-published">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="mobile-active">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="mobile-pending">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="mobile-progress" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="mobile-progress-text">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="telegram">
              <i class="fab fa-telegram" style="color: #0088cc;"></i>
              <h3>Telegram</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('telegram', 'Telegram', 'empresarial')">
                  <i class="fas fa-handshake"></i> Contratar
                </button>
                <button class="action-button" onclick="executarMissoes('telegram')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewServices('telegram')">
                  <i class="fas fa-eye"></i> Ver Serviços
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Canais Ativos</span>
                  <span class="stat-value" id="telegram-canais">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="telegram-golds">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="telegram-nivel">Criador de Grupo</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="telegram-published">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="telegram-active">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="telegram-pending">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="telegram-progress" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="telegram-progress-text">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="tiktok">
              <i class="fab fa-tiktok" style="color: #000000;"></i>
              <h3>TikTok</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('tiktok', 'TikTok', 'empresarial')">
                  <i class="fas fa-handshake"></i> Contratar
                </button>
                <button class="action-button" onclick="executarMissoes('tiktok')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewServices('tiktok')">
                  <i class="fas fa-eye"></i> Ver Serviços
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Curtidas Recebidas</span>
                  <span class="stat-value" id="tiktok-curtidas">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="tiktok-golds">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="tiktok-nivel">Criador Iniciante</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="tiktok-published">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="tiktok-active">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="tiktok-pending">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="tiktok-progress" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="tiktok-progress-text">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="video">
              <i class="fas fa-video" style="color: #FF0000;"></i>
              <h3>Marketing de Vídeo</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('video', 'Marketing de Vídeo', 'empresarial')">
                  <i class="fas fa-handshake"></i> Contratar
                </button>
                <button class="action-button" onclick="executarMissoes('video')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewServices('video')">
                  <i class="fas fa-eye"></i> Ver Serviços
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Campanhas Publicadas</span>
                  <span class="stat-value" id="video-campanhas">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="video-golds">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="video-nivel">Editor Júnior</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="video-published">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="video-active">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="video-pending">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="video-progress" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="video-progress-text">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="discord">
              <i class="fab fa-discord" style="color: #7289DA;"></i>
              <h3>Discord</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('discord', 'Discord', 'empresarial')">
                  <i class="fas fa-handshake"></i> Contratar
                </button>
                <button class="action-button" onclick="executarMissoes('discord')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewServices('discord')">
                  <i class="fas fa-eye"></i> Ver Serviços
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Servidores Ativos</span>
                  <span class="stat-value" id="discord-servidores">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="discord-golds">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="discord-nivel">Moderador Iniciante</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="discord-published">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="discord-active">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="discord-pending">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="discord-progress" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="discord-progress-text">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="blog">
              <i class="fas fa-blog" style="color: #FF9800;"></i>
              <h3>Comente em outros Blogs</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('blog', 'Comente em outros Blogs', 'empresarial')">
                  <i class="fas fa-handshake"></i> Contratar
                </button>
                <button class="action-button" onclick="executarMissoes('blog')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewServices('blog')">
                  <i class="fas fa-eye"></i> Ver Serviços
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Comentários Publicados</span>
                  <span class="stat-value" id="blog-comentarios">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="blog-golds">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="blog-nivel">Leitor Participativo</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="blog-published">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="blog-active">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="blog-pending">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="blog-progress" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="blog-progress-text">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="reddit">
              <i class="fab fa-reddit" style="color: #FF4500;"></i>
              <h3>Reddit</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('reddit', 'Reddit', 'empresarial')">
                  <i class="fas fa-handshake"></i> Contratar
                </button>
                <button class="action-button" onclick="executarMissoes('reddit')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewServices('reddit')">
                  <i class="fas fa-eye"></i> Ver Serviços
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Upvotes Recebidos</span>
                  <span class="stat-value" id="reddit-upvotes">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="reddit-golds">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="reddit-nivel">Explorador de Tópicos</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="reddit-published">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="reddit-active">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="reddit-pending">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="reddit-progress" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="reddit-progress-text">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="seo">
              <i class="fas fa-search" style="color: #4285F4;"></i>
              <h3>SEO, Promover Conteúdo</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('seo', 'SEO, Promover Conteúdo', 'empresarial')">
                  <i class="fas fa-handshake"></i> Contratar
                </button>
                <button class="action-button" onclick="executarMissoes('seo')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewServices('seo')">
                  <i class="fas fa-eye"></i> Ver Serviços
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Palavras-chave Otimizadas</span>
                  <span class="stat-value" id="seo-palavras">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="seo-golds">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="seo-nivel">Analista de Busca</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="seo-published">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="seo-active">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="seo-pending">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="seo-progress" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="seo-progress-text">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="inscricoes">
              <i class="fas fa-rss" style="color: #FF9800;"></i>
              <h3>Serviços Internacionais</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('inscricoes', 'Serviços Internacionais', 'empresarial')">
                  <i class="fas fa-handshake"></i> Contratar
                </button>
                <button class="action-button" onclick="executarMissoes('inscricoes')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewServices('inscricoes')">
                  <i class="fas fa-eye"></i> Ver Serviços
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Inscrições Ativas</span>
                  <span class="stat-value" id="inscricoes-ativas">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="inscricoes-golds">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="inscricoes-nivel">Membro Iniciante</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="inscricoes-published">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="inscricoes-active">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="inscricoes-pending">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="inscricoes-progress" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="inscricoes-progress-text">0 / 250.000</span>
              </div>
            </div>

          </div>
        </div>
      </div>
    </section>

    <hr style="border: 0; border-top: 1px solid var(--border); margin: 2rem 0;">

    <section id="dashboard-section-pessoal" class="dashboard-section fade-in">
      <div id="pessoalSection">
        <h2><i class="fas fa-user"></i>Modo Pessoal</h2>
        <p style="margin-bottom: 0.75rem; color: var(--text-secondary); font-size: 0.85rem;">Publique seus pedidos pessoais e realize missões.</p>
        <div class="carousel-container">
          <div class="carousel" id="company-carousel-pessoal">
            <div class="nav-card company-card fade-in" data-card-id="facebook-pessoal">
              <i class="fab fa-facebook" style="color: #1877f2;"></i>
              <h3>Micro Influenciador do Facebook</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('facebook', 'Micro Influenciador do Facebook', 'pessoal')">
                  <i class="fas fa-plus"></i> Publicar Serviço
                </button>
                <button class="action-button" onclick="executarMissoes('facebook')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewUserServices('facebook')">
                  <i class="fas fa-eye"></i> Ver Serviços Publicados
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="facebook-golds-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="facebook-nivel-pessoal">Iniciante de Campanha</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Colaboradores</span>
                  <span class="stat-value" id="facebook-seguidores-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="facebook-published-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="facebook-active-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="facebook-pending-pessoal">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="facebook-progress-pessoal" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="facebook-progress-text-pessoal">0 / 250.000</span>
              </div>
            </div>
            
            <div class="nav-card company-card fade-in" data-card-id="instagram-pessoal">
              <i class="fab fa-instagram" style="color: #e4405f;"></i>
              <h3>Micro Influenciador do Instagram</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('instagram', 'Micro Influenciador do Instagram', 'pessoal')">
                  <i class="fas fa-plus"></i> Publicar Serviço
                </button>
                <button class="action-button" onclick="executarMissoes('instagram')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewUserServices('instagram')">
                  <i class="fas fa-eye"></i> Ver Serviços Publicados
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="instagram-golds-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="instagram-nivel-pessoal">Estagiário de Conteúdo</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Seguidores</span>
                  <span class="stat-value" id="instagram-seguidores-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="instagram-published-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="instagram-active-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="instagram-pending-pessoal">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="instagram-progress-pessoal" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="instagram-progress-text-pessoal">0 / 250.000</span>
              </div>
            </div>
            
            <div class="nav-card company-card fade-in" data-card-id="mobile-pessoal">
              <i class="fas fa-mobile-alt" style="color: #4CAF50;"></i>
              <h3>Aplicativo Móvel</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('mobile', 'Aplicativo Móvel', 'pessoal')">
                  <i class="fas fa-plus"></i> Publicar Serviço
                </button>
                <button class="action-button" onclick="executarMissoes('mobile')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewUserServices('mobile')">
                  <i class="fas fa-eye"></i> Ver Serviços Publicados
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Total de Instalações</span>
                  <span class="stat-value" id="mobile-instalacoes-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="mobile-golds-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="mobile-nivel-pessoal">Programador Iniciante</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="mobile-published-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="mobile-active-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="mobile-pending-pessoal">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="mobile-progress-pessoal" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="mobile-progress-text-pessoal">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="telegram-pessoal">
              <i class="fab fa-telegram" style="color: #0088cc;"></i>
              <h3>Telegram</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('telegram', 'Telegram', 'pessoal')">
                  <i class="fas fa-plus"></i> Publicar Serviço
                </button>
                <button class="action-button" onclick="executarMissoes('telegram')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewUserServices('telegram')">
                  <i class="fas fa-eye"></i> Ver Serviços Publicados
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Canais Ativos</span>
                  <span class="stat-value" id="telegram-canais-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="telegram-golds-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="telegram-nivel-pessoal">Criador de Grupo</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="telegram-published-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="telegram-active-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="telegram-pending-pessoal">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="telegram-progress-pessoal" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="telegram-progress-text-pessoal">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="tiktok-pessoal">
              <i class="fab fa-tiktok" style="color: #000000;"></i>
              <h3>TikTok</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('tiktok', 'TikTok', 'pessoal')">
                  <i class="fas fa-plus"></i> Publicar Serviço
                </button>
                <button class="action-button" onclick="executarMissoes('tiktok')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewUserServices('tiktok')">
                  <i class="fas fa-eye"></i> Ver Serviços Publicados
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Curtidas Recebidas</span>
                  <span class="stat-value" id="tiktok-curtidas-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="tiktok-golds-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="tiktok-nivel-pessoal">Criador Iniciante</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="tiktok-published-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="tiktok-active-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="tiktok-pending-pessoal">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="tiktok-progress-pessoal" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="tiktok-progress-text-pessoal">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="video-pessoal">
              <i class="fas fa-video" style="color: #FF0000;"></i>
              <h3>Marketing de Vídeo</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('video', 'Marketing de Vídeo', 'pessoal')">
                  <i class="fas fa-plus"></i> Publicar Serviço
                </button>
                <button class="action-button" onclick="executarMissoes('video')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewUserServices('video')">
                  <i class="fas fa-eye"></i> Ver Serviços Publicados
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Campanhas Publicadas</span>
                  <span class="stat-value" id="video-campanhas-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="video-golds-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="video-nivel-pessoal">Editor Júnior</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="video-published-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="video-active-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="video-pending-pessoal">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="video-progress-pessoal" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="video-progress-text-pessoal">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="discord-pessoal">
              <i class="fab fa-discord" style="color: #7289DA;"></i>
              <h3>Discord</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('discord', 'Discord', 'pessoal')">
                  <i class="fas fa-plus"></i> Publicar Serviço
                </button>
                <button class="action-button" onclick="executarMissoes('discord')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewUserServices('discord')">
                  <i class="fas fa-eye"></i> Ver Serviços Publicados
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Servidores Ativos</span>
                  <span class="stat-value" id="discord-servidores-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="discord-golds-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="discord-nivel-pessoal">Moderador Iniciante</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="discord-published-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="discord-active-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="discord-pending-pessoal">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="discord-progress-pessoal" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="discord-progress-text-pessoal">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="blog-pessoal">
              <i class="fas fa-blog" style="color: #FF9800;"></i>
              <h3>Comente em outros Blogs</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('blog', 'Comente em outros Blogs', 'pessoal')">
                  <i class="fas fa-plus"></i> Publicar Serviço
                </button>
                <button class="action-button" onclick="executarMissoes('blog')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewUserServices('blog')">
                  <i class="fas fa-eye"></i> Ver Serviços Publicados
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Comentários Publicados</span>
                  <span class="stat-value" id="blog-comentarios-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="blog-golds-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="blog-nivel-pessoal">Leitor Participativo</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="blog-published-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="blog-active-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="blog-pending-pessoal">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="blog-progress-pessoal" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="blog-progress-text-pessoal">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="reddit-pessoal">
              <i class="fab fa-reddit" style="color: #FF4500;"></i>
              <h3>Reddit</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('reddit', 'Reddit', 'pessoal')">
                  <i class="fas fa-plus"></i> Publicar Serviço
                </button>
                <button class="action-button" onclick="executarMissoes('reddit')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewUserServices('reddit')">
                  <i class="fas fa-eye"></i> Ver Serviços Publicados
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Upvotes Recebidos</span>
                  <span class="stat-value" id="reddit-upvotes-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="reddit-golds-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="reddit-nivel-pessoal">Explorador de Tópicos</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="reddit-published-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="reddit-active-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="reddit-pending-pessoal">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="reddit-progress-pessoal" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="reddit-progress-text-pessoal">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="seo-pessoal">
              <i class="fas fa-search" style="color: #4285F4;"></i>
              <h3>SEO, Promover Conteúdo</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('seo', 'SEO, Promover Conteúdo', 'pessoal')">
                  <i class="fas fa-plus"></i> Publicar Serviço
                </button>
                <button class="action-button" onclick="executarMissoes('seo')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewUserServices('seo')">
                  <i class="fas fa-eye"></i> Ver Serviços Publicados
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Palavras-chave Otimizadas</span>
                  <span class="stat-value" id="seo-palavras-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="seo-golds-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="seo-nivel-pessoal">Analista de Busca</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="seo-published-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="seo-active-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="seo-pending-pessoal">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="seo-progress-pessoal" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="seo-progress-text-pessoal">0 / 250.000</span>
              </div>
            </div>

            <div class="nav-card company-card fade-in" data-card-id="inscricoes-pessoal">
              <i class="fas fa-rss" style="color: #FF9800;"></i>
              <h3>Serviços Internacionais</h3>
              <div class="company-actions">
                <button class="action-button" onclick="openPublishModal('inscricoes', 'Serviços Internacionais', 'pessoal')">
                  <i class="fas fa-plus"></i> Publicar Serviço
                </button>
                <button class="action-button" onclick="executarMissoes('inscricoes')">
                  <i class="fas fa-tasks"></i> Executar Missões
                </button>
                <button class="action-button" onclick="viewUserServices('inscricoes')">
                  <i class="fas fa-eye"></i> Ver Serviços Publicados
                </button>
              </div>
              <div class="company-stats">
                <div class="stat-item">
                  <span class="stat-label">Inscrições Ativas</span>
                  <span class="stat-value" id="inscricoes-ativas-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Golds Acumulados</span>
                  <span class="stat-value" id="inscricoes-golds-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Nível Global</span>
                  <span class="stat-value" id="inscricoes-nivel-pessoal">Membro Iniciante</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Serviços Publicados</span>
                  <span class="stat-value" id="inscricoes-published-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Ativos</span>
                  <span class="stat-value" id="inscricoes-active-pessoal">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Pendentes</span>
                  <span class="stat-value" id="inscricoes-pending-pessoal">0</span>
                </div>
              </div>
              <div class="nivel-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="inscricoes-progress-pessoal" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="inscricoes-progress-text-pessoal">0 / 250.000</span>
              </div>
            </div>

          </div>
        </div>
      </div>
    </section>

    
  </main>
  <div id="cookieBanner" class="cookie-banner">
    <div class="content">
      <p>Usamos cookies para otimizar sua experiência e analisar o tráfego do site. Ao continuar, você concorda com nossa <a href="#" target="_blank">política de privacidade</a>.</p>
    </div>
    <div class="buttons">
      <button id="cookie-accept" class="accept">Aceitar</button>
      <button id="cookie-decline" class="decline">Recusar</button>
    </div>
  </div>
  <footer id="userInfoFooter">
    Usuário: <span id="footerUserName">Carregando...</span> | ID: <span id="footerUserId">---</span>
  </footer>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>
<script>
  // ====================================================================
  // 1. CONSTANTES GLOBAIS (NOVO/AJUSTADO)
  // ====================================================================
  let selectedCompanyId = null;
  let currentMode = 'empresarial'; // Variável global para o modo

  // Definição das novas taxas e constantes para clareza
  const GOLD_TO_REAL = 1000;
  const TAX_PERSONAL = 0.05; // 5%
  const TAX_EMPRESARIAL = 0.10; // 10%
  const COMPANY_SHARE_RATIO = 0.5; // 50/50 split

  // OBS: BASE_REWARD e FIXED_FEE antigos são mantidos (mas não usados na nova lógica de fee)
  // para evitar quebras em outras partes do código que possam depender delas.

  // Inicializa o Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDbxygCeFLDbf6Ge6YZHJqq0VvlSSfbc_I",
    authDomain: "yshippcommerce.firebaseapp.com",
    projectId: "yshippcommerce",
    storageBucket: "yshippcommerce.appspot.com",
    messagingSenderId: "680576769517",
    appId: "1:680576769517:web:ace30d8e451ee70511dbe4"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  // Variáveis globais
  let currentUser = null;
  let walletData = { goldsBalance: 0, reaisBalance: 0, name: "Usuário", id: "..." };

  // Constante para formatação de Golds (R$ padrão brasileiro com separador de milhar como ponto)
  const GOLD_FORMAT = new Intl.NumberFormat('pt-BR', { minimumFractionDigits: 0, maximumFractionDigits: 2 });
  const GOLD_FORMAT_NO_DECIMAL = new Intl.NumberFormat('pt-BR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });

  /**
   * Função auxiliar para formatar Golds
   * @param {number} value
   * @param {boolean} includeDecimals
   * @returns {string}
   */
  function formatGold(value, includeDecimals = true) {
      if (value === undefined || value === null) return "0";
      const numericValue = parseFloat(value);
      if (isNaN(numericValue)) return "0";
      return includeDecimals ? GOLD_FORMAT.format(numericValue) : GOLD_FORMAT_NO_DECIMAL.format(numericValue);
  }

  auth.onAuthStateChanged(async (user) => {
    if (user) {
      currentUser = user;
      const walletRef = db.collection('wallets').doc(user.uid);
      const snap = await walletRef.get();
      if (snap.exists) {
        walletData = { ...snap.data(), id: user.uid };
        console.log("💰 Carteira carregada:", walletData);
      } else {
        console.warn("⚠️ Nenhuma carteira encontrada para este usuário.");
        walletData = { goldsBalance: 0, reaisBalance: 0, name: "Usuário", id: user.uid };
      }
    } else {
      console.warn("❌ Nenhum usuário autenticado.");
      walletData = { goldsBalance: 0, reaisBalance: 0, name: "Usuário", id: "..." };
    }
  });

  // Definição dos níveis globais e metas para cada card (mantido)
  const niveisGlobais = {
    facebook: [
      { nivel: 1, nome: "Iniciante de Campanha", golds: 250000 },
      { nivel: 2, nome: "Gestor de Engajamento", golds: 500000 },
      { nivel: 3, nome: "Líder de Audiência", golds: 900000 },
      { nivel: 4, nome: "Diretor de Mídia Social", golds: 1500000 },
      { nivel: 5, nome: "Executivo Global de Influência", golds: 5000000 }
    ],
    instagram: [
      { nivel: 1, nome: "Estagiário de Conteúdo", golds: 250000 },
      { nivel: 2, nome: "Analista de Engajamento", golds: 500000 },
      { nivel: 3, nome: "Gestor de Parcerias", golds: 900000 },
      { nivel: 4, nome: "Diretor de Imagem Digital", golds: 1500000 },
      { nivel: 5, nome: "Embaixador Global de Influência", golds: 5000000 }
    ],
    mobile: [
      { nivel: 1, nome: "Programador Iniciante", golds: 250000 },
      { nivel: 2, nome: "Desenvolvedor de Interface", golds: 500000 },
      { nivel: 3, nome: "Arquiteto de Aplicações", golds: 900000 },
      { nivel: 4, nome: "Diretor Mobile", golds: 1500000 },
      { nivel: 5, nome: "Visionário Global de Tecnologia", golds: 5000000 }
    ],
    telegram: [
      { nivel: 1, nome: "Criador de Grupo", golds: 250000 },
      { nivel: 2, nome: "Gestor de Comunidade", golds: 500000 },
      { nivel: 3, nome: "Curador de Conteúdo", golds: 900000 },
      { nivel: 4, nome: "Diretor de Comunicação Digital", golds: 1500000 },
      { nivel: 5, nome: "Embaixador Global de Conexões", golds: 5000000 }
    ],
    tiktok: [
      { nivel: 1, nome: "Criador Iniciante", golds: 250000 },
      { nivel: 2, nome: "Influenciador Emergente", golds: 500000 },
      { nivel: 3, nome: "Gestor de Tendências", golds: 900000 },
      { nivel: 4, nome: "Diretor de Conteúdo Viral", golds: 1500000 },
      { nivel: 5, nome: "Ícone Global de Criatividade", golds: 5000000 }
    ],
    video: [
      { nivel: 1, nome: "Editor Júnior", golds: 250000 },
      { nivel: 2, nome: "Gestor de Campanha", golds: 500000 },
      { nivel: 3, nome: "Produtor Audiovisual", golds: 900000 },
      { nivel: 4, nome: "Diretor de Estratégia Visual", golds: 1500000 },
      { nivel: 5, nome: "Mestre Global de Conteúdo", golds: 5000000 }
    ],
    discord: [
      { nivel: 1, nome: "Moderador Iniciante", golds: 250000 },
      { nivel: 2, nome: "Gestor de Servidor", golds: 500000 },
      { nivel: 3, nome: "Líder de Comunidade", golds: 900000 },
      { nivel: 4, nome: "Diretor de Ecossistema Digital", golds: 1500000 },
      { nivel: 5, nome: "Executivo Global de Interação", golds: 5000000 }
    ],
    blog: [
      { nivel: 1, nome: "Leitor Participativo", golds: 250000 },
      { nivel: 2, nome: "Colaborador Ativo", golds: 500000 },
      { nivel: 3, nome: "Embaixador de Discussões", golds: 900000 },
      { nivel: 4, nome: "Diretor de Comunidades Digitais", golds: 1500000 },
      { nivel: 5, nome: "Crítico Global de Conteúdo", golds: 5000000 }
    ],
    reddit: [
      { nivel: 1, nome: "Explorador de Tópicos", golds: 250000 },
      { nivel: 2, nome: "Criador de Discussões", golds: 500000 },
      { nivel: 3, nome: "Líder de Subcomunidade", golds: 900000 },
      { nivel: 4, nome: "Diretor de Engajamento Global", golds: 1500000 },
      { nivel: 5, nome: "Mestre Mundial de Interação", golds: 5000000 }
    ],
    seo: [
      { nivel: 1, nome: "Analista de Busca", golds: 250000 },
      { nivel: 2, nome: "Gestor de Tráfego", golds: 500000 },
      { nivel: 3, nome: "Diretor de Performance", golds: 900000 },
      { nivel: 4, nome: "Estrategista Global de Marketing", golds: 1500000 },
      { nivel: 5, nome: "Arquiteto Supremo de Engajamento", golds: 5000000 }
    ],
    inscricoes: [
      { nivel: 1, nome: "Membro Iniciante", golds: 250000 },
      { nivel: 2, nome: "Participante Dedicado", golds: 500000 },
      { nivel: 3, nome: "Colaborador Premium", golds: 900000 },
      { nivel: 4, nome: "Líder de Comunidade", golds: 1500000 },
      { nivel: 5, nome: "Sócio Global Yshipp", golds: 5000000 }
    ]
  };

  // Definição das subcategorias e dificuldades (mantido)
  const subcategorias = {
      inscricoes: [
          { nome: "Somente envio de e-mail", goldsBase: 150, dificuldade: "Simples" },
          { nome: "Cadastro simples", goldsBase: 300, dificuldade: "Simples" },
          { nome: "Inscrição complexa", goldsBase: 1000, dificuldade: "Intermediário" }
      ],
      facebook: [
          { nome: "Curtir no Facebook", goldsBase: 1000, dificuldade: "Intermediário" },
          { nome: "Curtidas no Facebook (mais de 50 amigos)", goldsBase: 1200, dificuldade: "Intermediário" },
          { nome: "Curtidas no Facebook (mais de 100 amigos)", goldsBase: 1500, dificuldade: "Intermediário" },
          { nome: "Curtidas no Facebook (mais de 300 amigos)", goldsBase: 2000, dificuldade: "Intermediário" },
          { nome: "Adicionar comentário à conversa existente", goldsBase: 1500, dificuldade: "Intermediário" },
          { nome: "Adicione-me como amigo", goldsBase: 2000, dificuldade: "Intermediário" },
          { nome: "Junte-se a um grupo", goldsBase: 1500, dificuldade: "Intermediário" },
          { nome: "Mude sua foto de perfil (por 1 semana)", goldsBase: 3000, dificuldade: "Intermediário" },
          { nome: "Postar no Mural", goldsBase: 2000, dificuldade: "Intermediário" },
          { nome: "Publique no seu mural (mais de 50 amigos)", goldsBase: 2500, dificuldade: "Intermediário" },
          { nome: "Publique no seu mural (mais de 100 amigos)", goldsBase: 3000, dificuldade: "Intermediário" },
          { nome: "Publique no seu mural (mais de 300 amigos)", goldsBase: 3500, dificuldade: "Intermediário" },
          { nome: "Curtir + Publicar no mural (mais de 50 amigos)", goldsBase: 3000, dificuldade: "Intermediário" },
          { nome: "Curtir + Publicar no mural (mais de 100 amigos)", goldsBase: 3500, dificuldade: "Intermediário" },
          { nome: "Curtir + Publicar no mural (mais de 300 amigos)", goldsBase: 4000, dificuldade: "Intermediário" },
          { nome: "Curtir + Comentar + Publicar no Mural", goldsBase: 5000, dificuldade: "Intermediário" }
      ],
      instagram: [
          { nome: "Seguir", goldsBase: 1000, dificuldade: "Intermediário" },
          { nome: "Curtir", goldsBase: 1000, dificuldade: "Intermediário" },
          { nome: "Comentário", goldsBase: 1500, dificuldade: "Intermediário" },
          { nome: "Seguir + Curtir", goldsBase: 2000, dificuldade: "Intermediário" },
          { nome: "Curtir + Comentário", goldsBase: 2500, dificuldade: "Intermediário" },
          { nome: "Seguir + Curtir + Comentar", goldsBase: 3500, dificuldade: "Intermediário" },
          { nome: "Compartilhe uma publicação", goldsBase: 3000, dificuldade: "Intermediário" },
          { nome: "Seguir + Curtir + Comentar + Compartilhar", goldsBase: 5000, dificuldade: "Intermediário" }
      ],
      mobile: [
          { nome: "Somente download", goldsBase: 500, dificuldade: "Simples" },
          { nome: "Baixar + Instalar", goldsBase: 700, dificuldade: "Simples" },
          { nome: "Baixar + Instalar + Testar + Revisão de 25 palavras", goldsBase: 1500, dificuldade: "Intermediário" },
          { nome: "Baixar + Instalar + Cadastrar + KYC", goldsBase: 2000, dificuldade: "Intermediário" },
          { nome: "Baixar + Instalar + Reproduzir/Engajar (até 5 min ou menos)", goldsBase: 1000, dificuldade: "Intermediário" },
          { nome: "Baixar + Instalar + Reproduzir/Engajar (até 15 min + US$ 0,05 para cada 10 min)", goldsBase: 1500, dificuldade: "Intermediário" }
      ],
      telegram: [
          { nome: "Bot Junte-se", goldsBase: 500, dificuldade: "Simples" },
          { nome: "Junte-se ao grupo", goldsBase: 700, dificuldade: "Simples" },
          { nome: "Airdrop simples", goldsBase: 1000, dificuldade: "Intermediário" },
          { nome: "Lançamento aéreo complexo", goldsBase: 2000, dificuldade: "Intermediário" },
          { nome: "Bot Join (Usuários Premium)", goldsBase: 1500, dificuldade: "Intermediário" },
          { nome: "Ingresso em grupo (usuários premium)", goldsBase: 1500, dificuldade: "Intermediário" },
          { nome: "Airdrop simples (usuários premium)", goldsBase: 2000, dificuldade: "Intermediário" },
          { nome: "Airdrop complexo (usuários premium)", goldsBase: 3000, dificuldade: "Intermediário" }
      ],
      tiktok: [
          { nome: "Crie um vídeo (até 15s)", goldsBase: 2000, dificuldade: "Intermediário" },
          { nome: "Crie um vídeo (até 1 min)", goldsBase: 3000, dificuldade: "Intermediário" },
          { nome: "Crie um vídeo (até 3 min)", goldsBase: 5000, dificuldade: "Complexo" },
          { nome: "Assista a um vídeo (até 1 min)", goldsBase: 500, dificuldade: "Simples" },
          { nome: "Assista a um vídeo (até 3 min)", goldsBase: 1000, dificuldade: "Simples" },
          { nome: "Curtir / Seguir", goldsBase: 1000, dificuldade: "Intermediário" },
          { nome: "Comente um vídeo", goldsBase: 1500, dificuldade: "Intermediário" },
          { nome: "Compartilhe um vídeo", goldsBase: 2000, dificuldade: "Intermediário" },
          { nome: "Assistir + Curtir + Comentar + Compartilhar", goldsBase: 4000, dificuldade: "Intermediário" }
      ],
      video: [
          { nome: "Assista ao vídeo (3 min)", goldsBase: 500, dificuldade: "Simples" },
          { nome: "Assista ao vídeo (6 min)", goldsBase: 1000, dificuldade: "Simples" },
          { nome: "Assista ao vídeo (9 min)", goldsBase: 1500, dificuldade: "Intermediário" },
          { nome: "Assista ao vídeo (12 min)", goldsBase: 2000, dificuldade: "Intermediário" },
          { nome: "Assista ao vídeo (15+ min)", goldsBase: 2500, dificuldade: "Intermediário" },
          { nome: "Curtir um vídeo", goldsBase: 1000, dificuldade: "Intermediário" },
          { nome: "Comentário", goldsBase: 1500, dificuldade: "Intermediário" },
          { nome: "Inscreva-se no canal", goldsBase: 2000, dificuldade: "Intermediário" },
          { nome: "Quaisquer 2 tarefas", goldsBase: 2500, dificuldade: "Intermediário" },
          { nome: "Quaisquer 3 tarefas", goldsBase: 3500, dificuldade: "Intermediário" },
          { nome: "Quaisquer 4 tarefas", goldsBase: 4500, dificuldade: "Intermediário" },
          { nome: "1x Curtir Compartilhar, Comentário Inscrever + Assistir vídeo (6 min)", goldsBase: 4000, dificuldade: "Intermediário" },
          { nome: "1x Curtir Compartilhar, Comentário Inscrever + Assistir vídeo (9 min)", goldsBase: 4500, dificuldade: "Intermediário" },
          { nome: "1x Curtir Compartilhar, Comentário Inscrever + Assistir vídeo (12 min)", goldsBase: 5000, dificuldade: "Intermediário" }
      ],
      discord: [
          { nome: "Junte-se a um canal", goldsBase: 700, dificuldade: "Simples" },
          { nome: "Ingresso no servidor", goldsBase: 1000, dificuldade: "Intermediário" }
      ],
      blog: [
          { nome: "Comentário curto", goldsBase: 500, dificuldade: "Simples" },
          { nome: "Comentário curto 2x", goldsBase: 1000, dificuldade: "Simples" },
          { nome: "Comentário curto 3x", goldsBase: 1500, dificuldade: "Intermediário" },
          { nome: "Comentário curto com Link", goldsBase: 700, dificuldade: "Simples" },
          { nome: "Comentário curto 2x com Link", goldsBase: 1200, dificuldade: "Intermediário" }
      ],
      reddit: [
          { nome: "Votar positivamente em uma postagem", goldsBase: 1000, dificuldade: "Intermediário" },
          { nome: "Pesquisar + votar positivamente em uma postagem", goldsBase: 1500, dificuldade: "Intermediário" },
          { nome: "Comentar uma postagem", goldsBase: 1500, dificuldade: "Intermediário" },
          { nome: "Votar positivamente + comentar uma postagem", goldsBase: 2000, dificuldade: "Intermediário" },
          { nome: "Votar positivamente em uma postagem (NSFW)", goldsBase: 1200, dificuldade: "Intermediário" },
          { nome: "Pesquisar + votar positivamente em uma postagem (NSFW)", goldsBase: 1700, dificuldade: "Intermediário" },
          { nome: "Comentar uma postagem (NSFW)", goldsBase: 1700, dificuldade: "Intermediário" },
          { nome: "Votar positivamente + comentar uma postagem (NSFW)", goldsBase: 2200, dificuldade: "Intermediário" }
      ],
      seo: [
          { nome: "SEO + Promover conteúdo + Engajar 1x", goldsBase: 2000, dificuldade: "Intermediário" },
          { nome: "SEO + Promover conteúdo + Engajar 2x", goldsBase: 3000, dificuldade: "Intermediário" },
          { nome: "SEO + Promover conteúdo + Engajar 3x", goldsBase: 4000, dificuldade: "Intermediário" },
          { nome: "SEO + Promover conteúdo + Pesquisar + Engajar 1x", goldsBase: 2500, dificuldade: "Intermediário" },
          { nome: "SEO + Promover conteúdo + Pesquisar + Engajar 2x", goldsBase: 3500, dificuldade: "Intermediário" },
          { nome: "SEO + Promover conteúdo + Pesquisar + Engajar 3x", goldsBase: 4500, dificuldade: "Intermediário" },
          { nome: "SEO + Promover conteúdo + Pesquisar 2x + Engajar 2x", goldsBase: 4000, dificuldade: "Intermediário" },
          { nome: "SEO + Promover conteúdo + Pesquisar 3x + Engajar 3x", goldsBase: 5000, dificuldade: "Intermediário" },
          { nome: "SEO + Promover conteúdo + Tarefas 4x extensas", goldsBase: 6000, dificuldade: "Complexo" },
          { nome: "SEO + Promover conteúdo + Tarefas 5x extensas", goldsBase: 7000, dificuldade: "Complexo" }
      ]
  };

  // Variáveis globais para controle do modal e dados
  let currentCompanyId = null;
  let currentCompanyName = null;
  let currentStep = 1;
  const totalSteps = 4;
  let serviceSteps = [{ id: 1, description: "" }];
  const BASE_REWARD = 150; // Golds base por tarefa (mantido, mas pode ser removido)
  const FIXED_FEE = 50; // Taxa fixa adicional em Golds (mantido, mas não usado na nova lógica)

  /**
   * FUNÇÕES DO FLUXO GUIADO
   */

  // Função para calcular a recompensa por freelancer com base na complexidade (mantido, com nota de melhoria)
  function calculateRewardPerFreelancer() {
      let baseReward = BASE_REWARD;
      const totalSteps = serviceSteps.length;

      // ... Lógica de cálculo de recompensa por passos (mantida) ...

      let calculatedReward = baseReward;
      const subcategorySelect = document.getElementById("subcategory");
      const selectedOption = subcategorySelect.options[subcategorySelect.selectedIndex];
      if (selectedOption && selectedOption.dataset.goldsBase) {
          const subcategoryGolds = parseFloat(selectedOption.dataset.goldsBase);
          calculatedReward = subcategoryGolds;

          // Reajusta o multiplicador para ser proporcional ao BASE_REWARD de 150
          const stepMultiplier = [0, 75, 125, 250, 450]; // Aumento absoluto em Golds por passo
          let stepsBonus = 0;
          for(let i = 1; i < totalSteps; i++){
              stepsBonus += stepMultiplier[i];
          }
          calculatedReward += stepsBonus;

          // TODO: Implementar consulta ao DB para 'geradorBonus' e aplicá-lo aqui
          // reward = calculatedReward * (1 + gerador.rewardMultiplier);

          document.getElementById("basePriceDisplay").textContent = `${formatGold(subcategoryGolds)} Golds (Base)`;
          document.getElementById("calculatedReward").value = `${formatGold(calculatedReward)} Golds`;
          return calculatedReward;
      }
      // Se nenhuma subcategoria for selecionada, usa o valor base simplificado
      const multipliers = [1, 1.5, 2.5, 4, 6];
      const multiplier = multipliers[totalSteps - 1] || multipliers[multipliers.length - 1]; // Limita em 5 passos
      calculatedReward = baseReward * multiplier;
      document.getElementById("basePriceDisplay").textContent = `${formatGold(BASE_REWARD)} Golds (Base)`;
      document.getElementById("calculatedReward").value = `${formatGold(calculatedReward)} Golds (Base)`;
      return calculatedReward;
  }

  // Adiciona uma nova etapa (Passo do Serviço) (mantido)
  function addStep() {
      if (serviceSteps.length >= 5) {
          showNotification("Máximo de 5 passos atingido.");
          return;
      }
      const newStepId = serviceSteps.length + 1;
      const container = document.getElementById("serviceStepsContainer");

      const newStep = { id: newStepId, description: "" };
      serviceSteps.push(newStep);
      renderServiceSteps();

      document.getElementById("stepCount").textContent = serviceSteps.length;
      if (serviceSteps.length >= 5) {
          document.getElementById("addStepButton").disabled = true;
          document.getElementById("addStepButton").textContent = "Máximo de 5 passos atingido";
      }
      calculateRewardPerFreelancer();
      prepareSummary();
      updateModalSize();
  }

  // Remove uma etapa (Passo do Serviço) (mantido)
  function removeStep(id) {
      if (serviceSteps.length === 1) {
          showNotification("O serviço deve ter pelo menos 1 passo.");
          return;
      }

      serviceSteps = serviceSteps.filter(step => step.id !== id);
      renderServiceSteps();
      document.getElementById("stepCount").textContent = serviceSteps.length;
      if (serviceSteps.length < 5) {
          document.getElementById("addStepButton").disabled = false;
          document.getElementById("addStepButton").textContent = `+ Adicionar Passo (Total: ${serviceSteps.length})`;
      }
      calculateRewardPerFreelancer();
      prepareSummary();
      updateModalSize();
  }

  // Atualiza a descrição de um passo no array serviceSteps (mantido)
  function updateStepDescription(id, value) {
      const step = serviceSteps.find(s => s.id === id);
      if (step) {
          step.description = value;
      }
  }

  // Renderiza a lista de passos (mantido)
  function renderServiceSteps() {
      const container = document.getElementById("serviceStepsContainer");
      container.innerHTML = '';
      serviceSteps.forEach((step, index) => {
          const stepId = index + 1;
          const stepDiv = document.createElement('div');
          stepDiv.className = 'step-item';
          stepDiv.setAttribute('data-step-id', stepId);
          stepDiv.innerHTML = `
              <input type="text" placeholder="Passo ${stepId} (Obrigatório)" class="service-step-input" required value="${step.description || ''}" oninput="updateStepDescription(${stepId}, this.value)">
              <button class="bg-red-500 hover:bg-red-700 text-white" style="display: ${stepId === 1 ? 'none' : 'block'};" onclick="removeStep(${stepId})"><i class="fas fa-trash"></i></button>
          `;
          container.appendChild(stepDiv);
          step.id = stepId;
      });
      document.getElementById("stepCount").textContent = serviceSteps.length;
  }

  // Validação da etapa atual (mantido, mas com reforço de validação no server-side)
  function validateStep(step) {
      document.getElementById("errorMessage").style.display = "none";

      switch (step) {
          case 1:
              const subcategory = document.getElementById("subcategory").value;
              const freelancers = parseInt(document.getElementById("freelancers").value);
              const description = document.getElementById("serviceDescription").value.trim();
              if (!subcategory) {
                  document.getElementById("errorMessage").textContent = "Selecione a Categoria do Serviço.";
                  document.getElementById("errorMessage").style.display = "block";
                  return false;
              }
              if (!freelancers || freelancers <= 0 || isNaN(freelancers)) {
                  document.getElementById("errorMessage").textContent = "Informe uma quantidade válida de Freelancers (> 0).";
                  document.getElementById("errorMessage").style.display = "block";
                  return false;
              }
              // TODO: Adicionar validação de 'freelancers <= maxAllowed'
              if (description.length < 10) {
                  document.getElementById("errorMessage").textContent = "A Descrição Rápida deve ter pelo menos 10 caracteres.";
                  document.getElementById("errorMessage").style.display = "block";
                  return false;
              }
              return true;
          case 2:
              let allStepsValid = true;
              serviceSteps.forEach((step) => {
                  const inputElement = document.querySelector(`.step-item[data-step-id="${step.id}"] .service-step-input`);
                  if (!inputElement || inputElement.value.trim() === "") {
                      allStepsValid = false;
                  } else {
                      step.description = inputElement.value.trim();
                  }
              });

              if (!allStepsValid) {
                  document.getElementById("errorMessage").textContent = "Preencha a descrição de todos os passos do serviço.";
                  document.getElementById("errorMessage").style.display = "block";
                  return false;
              }

              calculateRewardPerFreelancer();
              return true;
          case 3:
              const proofDescription = document.getElementById("proofDescription").value.trim();
              const proofImage = document.getElementById("proofImage").checked;
              const proofText = document.getElementById("proofText").checked;
              const minProofCount = parseInt(document.getElementById("minProofCount").textContent);

              if (proofDescription.length < 10) {
                  document.getElementById("errorMessage").textContent = "A descrição da prova deve ter pelo menos 10 caracteres.";
                  document.getElementById("errorMessage").style.display = "block";
                  return false;
              }
              if (minProofCount === 2 && (!proofImage || !proofText)) {
                  document.getElementById("errorMessage").textContent = "Com a complexidade do serviço, você deve exigir pelo menos 2 tipos de prova (Imagem E Texto).";
                  document.getElementById("errorMessage").style.display = "block";
                  return false;
              }
              if (minProofCount === 1 && !proofImage && !proofText) {
                  document.getElementById("errorMessage").textContent = "Selecione pelo menos um tipo de prova (Imagem ou Texto).";
                  document.getElementById("errorMessage").style.display = "block";
                  return false;
              }

              prepareSummary();
              return true;
          case 4:
              return true;
          default:
              return true;
      }
  }

  // Navegação (mantido)
  function nextStep() {
      if (!validateStep(currentStep)) return;

      if (currentStep < totalSteps) {
          const currentElement = document.getElementById(`step-${currentStep}`);
          const nextElement = document.getElementById(`step-${currentStep + 1}`);
          currentElement.classList.remove('active', 'fade-in-step');

          currentStep++;
          document.getElementById("currentStepNumber").textContent = currentStep;

          setTimeout(() => {
              nextElement.classList.add('active');
              updateModalSize();
              setTimeout(() => nextElement.classList.add('fade-in-step'), 10);
          }, 300);
          updateNavigationButtons();

      }
  }

  // Navegação (mantido)
  function prevStep() {
      if (currentStep > 1) {
          const currentElement = document.getElementById(`step-${currentStep}`);
          const prevElement = document.getElementById(`step-${currentStep - 1}`);
          currentElement.classList.remove('active', 'fade-in-step');
          currentStep--;
          document.getElementById("currentStepNumber").textContent = currentStep;
          setTimeout(() => {
              prevElement.classList.add('active');
              updateModalSize();
              setTimeout(() => prevElement.classList.add('fade-in-step'), 10);
          }, 300);

          updateNavigationButtons();
      }
  }

  // Atualiza botões (mantido)
  function updateNavigationButtons() {
      const backButton = document.getElementById("backButton");
      const nextButton = document.getElementById("nextButton");
      backButton.style.display = currentStep > 1 ? 'block' : 'none';
      nextButton.style.display = currentStep < totalSteps ? 'block' : 'none';

      if (currentStep === totalSteps) {
          nextButton.style.display = 'none';
      }
  }

  // Atualiza tamanho do modal (mantido)
  function updateModalSize() {
      const modalContent = document.getElementById('modalContent');
      const activeStep = document.querySelector(`#step-${currentStep}`);

      if (activeStep) {
          const minHeight = 350;

          const contentHeight = activeStep.scrollHeight;
          const titleHeight = document.getElementById('modalTitle').getBoundingClientRect().height;
          const indicatorHeight = document.querySelector('.step-indicator').getBoundingClientRect().height;
          const navigationHeight = document.querySelector('.step-navigation').getBoundingClientRect().height;

          const style = window.getComputedStyle(modalContent);
          const paddingTop = parseFloat(style.paddingTop);
          const paddingBottom = parseFloat(style.paddingBottom);

          const fixedOverhead = titleHeight + indicatorHeight + navigationHeight + paddingTop + paddingBottom;

          const newHeight = Math.max(minHeight, contentHeight + fixedOverhead);

          modalContent.style.height = `${newHeight}px`;
          modalContent.style.width = `100%`;
      }
  }

  // Carrega subcategorias (mantido, com nota de DB Pricing)
  function loadSubcategories() {
      if (!currentCompanyId || !subcategorias[currentCompanyId]) return;
      // TODO: Ajustar para ler 'pricing' do companies/{id}/pricing se necessário.
      const subcategorySelect = document.getElementById("subcategory");
      subcategorySelect.innerHTML = '<option value="" disabled selected>Escolha uma subcategoria</option>';
      subcategorias[currentCompanyId].forEach(sub => {
          const option = document.createElement("option");
          option.value = sub.nome;
          option.textContent = sub.nome;
          option.dataset.goldsBase = sub.goldsBase;
          option.dataset.dificuldade = sub.dificuldade;
          subcategorySelect.appendChild(option);
      });

      // Reseta inputs
      document.getElementById("serviceDifficulty").value = "Aguardando seleção...";
      document.getElementById("freelancers").value = "";
      document.getElementById("serviceDescription").value = "";
      serviceSteps = [{ id: 1, description: "" }];
      renderServiceSteps();
      document.getElementById("addStepButton").disabled = false;
      document.getElementById("addStepButton").textContent = `+ Adicionar Passo (Total: 1)`;
      calculateRewardPerFreelancer();

      // Zera as provas
      document.getElementById("proofDescription").value = "";
      document.getElementById("proofImage").checked = true;
      document.getElementById("proofText").checked = false;
      document.getElementById("minProofCount").textContent = "1";

      updateModeInfoInStep2();
  }

  // NOVO: Atualiza a info da Etapa 2 (AJUSTADO: REMOVE TEXTO 'DOBRA')
  function updateModeInfoInStep2() {
    const infoBox = document.getElementById("modeDuplicationInfo");
    if (currentMode === 'empresarial') {
      infoBox.innerHTML = `
        <i class="fas fa-handshake" style="color: var(--secondary);"></i>
        <strong>Modo Empresarial:</strong> A taxa de serviço é de ${TAX_EMPRESARIAL * 100}% e será dividida (50% para a Empresa / 50% para o Banco Central).
      `;
    } else {
      infoBox.innerHTML = `
        <i class="fas fa-user" style="color: var(--text-secondary);"></i>
        <strong>Modo Pessoal:</strong> A taxa de serviço é de ${TAX_PERSONAL * 100}% e será destinada integralmente (100%) para o Banco Central.
      `;
    }
  }

  // Calcula dificuldade (mantido)
  function calculateDifficultyAndProof() {
      const subcategorySelect = document.getElementById("subcategory");
      const selectedOption = subcategorySelect.options[subcategorySelect.selectedIndex];
      if (selectedOption && selectedOption.dataset.dificuldade) {
          const dificuldade = selectedOption.dataset.dificuldade;
          document.getElementById("serviceDifficulty").value = dificuldade;

          let minProof = 1;
          if (dificuldade === "Complexo") {
              minProof = 2;
          }
          document.getElementById("minProofCount").textContent = minProof;
          calculateRewardPerFreelancer();
          prepareSummary();
      } else {
          document.getElementById("serviceDifficulty").value = "Aguardando seleção...";
          document.getElementById("minProofCount").textContent = "1";
          calculateRewardPerFreelancer();
          prepareSummary();
      }
  }

  // ====================================================================
  // 2. prepareSummary() - SOBRESCRITO: NOVA LÓGICA DE TAXA
  // ====================================================================
  function prepareSummary() {
      const rewardPerFreelancer = calculateRewardPerFreelancer();
      const freelancers = parseInt(document.getElementById("freelancers").value) || 0;
      const difficulty = document.getElementById("serviceDifficulty").value;

      // 1. Custo Bruto (valor que vai para os freelancers)
      const grossCost = rewardPerFreelancer * freelancers;

      // 2. Cálculo da Taxa (NOVA LÓGICA)
      const feePercent = (currentMode === 'empresarial') ? TAX_EMPRESARIAL : TAX_PERSONAL;
      // Arredonda para integer golds para evitar inconsistência
      const totalFee = Math.round(grossCost * feePercent);
      
      let companyShare = 0;
      let bcShare = 0;

      if (currentMode === 'empresarial') {
          // Divisão 50/50: 50% para a empresa, 50% para o BC
          companyShare = Math.round(totalFee * COMPANY_SHARE_RATIO);
          bcShare = totalFee - companyShare; // Garante que a soma bate, compensando o arredondamento na empresa
      } else {
          // Modo pessoal: 100% para o BC
          bcShare = totalFee;
      }

      // 3. Custo Final
      const finalCost = grossCost + totalFee;

      // ATUALIZAÇÃO DA UI (Remoção de referências a doubledCost / Custo Dobrado)
      const summaryDoubledCostRow = document.getElementById("summaryDoubledCostRow");
      const summaryDoubledCostEl = document.getElementById("summaryDoubledCost");
      const modeDuplicationSummaryEl = document.getElementById("modeDuplicationSummary");

      // Substituir o texto "Custo Dobrado"
      summaryDoubledCostRow.style.display = 'none'; // Não exibir a linha de "Custo Dobrado"
      modeDuplicationSummaryEl.style.display = 'block';
      modeDuplicationSummaryEl.innerHTML = `
          <i class="fas fa-info-circle" style="color: var(--accent);"></i>
          <strong>Detalhe do Custo Bruto:</strong> ${formatGold(grossCost, true)} Golds pagos aos trabalhadores (Freelancers).
      `;
      // NOVO: Exibir a divisão da taxa (Empresa / BC)
      const summaryFeeEl = document.getElementById("summaryFee");
      summaryFeeEl.innerHTML = `
          ${formatGold(totalFee, true)} Golds (${feePercent * 100}%)
          <span style="display: block; font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">
              Empresa (${currentCompanyName}): ${formatGold(companyShare, true)} Golds<br>
              Banco Central (BC): ${formatGold(bcShare, true)} Golds
          </span>
      `;
      
      const currentBalance = walletData.goldsBalance || 0;

      // Atualiza o Resumo
      document.getElementById("summaryUserName").textContent = walletData.name || "Usuário";
      document.getElementById("summaryUserId").textContent = walletData.id || "---";
      document.getElementById("summaryDifficulty").textContent = difficulty;
      document.getElementById("summaryReward").textContent = formatGold(rewardPerFreelancer, false);
      document.getElementById("summaryFreelancers").textContent = formatGold(freelancers, false);
      document.getElementById("summaryGrossCost").textContent = formatGold(grossCost, true);
      document.getElementById("summaryFinalCost").textContent = formatGold(finalCost, true);

      // Validação de Saldo
      const confirmButton = document.getElementById("confirmPublishButton");
      const summaryWarning = document.getElementById("summaryWarning");
      if (currentBalance < finalCost) {
          summaryWarning.textContent = `Saldo insuficiente! Você precisa de ${formatGold(finalCost, true)} Golds. Saldo atual: ${formatGold(currentBalance, true)} Golds.`;
          summaryWarning.style.display = "block";
          confirmButton.disabled = true;
          confirmButton.style.backgroundColor = 'var(--text-secondary)';
          confirmButton.style.cursor = 'not-allowed';
      } else {
          summaryWarning.style.display = "none";
          confirmButton.disabled = false;
          confirmButton.style.backgroundColor = 'var(--secondary)';
          confirmButton.style.cursor = 'pointer';
      }

      // NOVO: Retorna também os shares para a transação
      return { finalCost, totalFee, grossCost, rewardPerFreelancer, companyShare, bcShare };
  }

  // Função para abrir o modal de publicação (mantido)
  function openPublishModal(companyId, companyName, mode) {
      selectedCompanyId = companyId;
    currentCompanyId = companyId;
    currentCompanyName = companyName;
    currentMode = mode;
    document.getElementById("modalCompanyName").textContent = companyName;

    currentStep = 1;
    document.getElementById("currentStepNumber").textContent = currentStep;
    document.getElementById("errorMessage").style.display = "none";

    for(let i = 1; i <= totalSteps; i++) {
      const stepElement = document.getElementById(`step-${i}`);
      stepElement.classList.remove('active', 'fade-in-step');
    }
    document.getElementById("step-1").classList.add('active', 'fade-in-step');

    loadSubcategories();
    updateNavigationButtons();

    const modal = document.getElementById("guidedPublishModal");
    modal.classList.add("active");
    setTimeout(updateModalSize, 50);
  }

  // Função para fechar o modal (mantido)
  function closeModal() {
    for(let i = 1; i <= totalSteps; i++) {
      const stepElement = document.getElementById(`step-${i}`);
      if(stepElement) {
          stepElement.classList.remove('active', 'fade-in-step');
      }
    }
    document.getElementById("guidedPublishModal").classList.remove("active");

    currentCompanyId = null;
    currentCompanyName = null;
    currentMode = 'empresarial';
    currentStep = 1;
    serviceSteps = [{ id: 1, description: "" }];
  }

  // ====================================================================
  // 3. publishService() - SOBRESCRITO: NOVA TRANSAÇÃO ATÔMICA
  // ====================================================================
  
  async function publishService() {
      if (!validateStep(4)) return;
      const { finalCost, totalFee, grossCost, rewardPerFreelancer, companyShare, bcShare } = prepareSummary();
      const user = auth.currentUser;

      if (!user) {
          showNotification("Usuário não autenticado!");
          return;
      }
      // Validação de saldo no cliente para UX (a validação crítica é na transação)
      if (walletData.goldsBalance < finalCost) {
          showNotification("Saldo insuficiente para publicar o serviço.");
          return;
      }

      const subcategorySelect = document.getElementById("subcategory");
      const selectedOption = subcategorySelect.options[subcategorySelect.selectedIndex];
      const freelancers = parseInt(document.getElementById("freelancers").value);

      const serviceData = {
          userId: user.uid,
          empresa: currentCompanyName,
          empresaId: currentCompanyId,
          modo: currentMode,
          nome: selectedOption.value,
          descricao: document.getElementById("serviceDescription").value.trim(),
          recompensa: rewardPerFreelancer,
          freelancers: freelancers,
          freelancersAtivos: 0,
          subcategoria: selectedOption.value,
          dificuldade: selectedOption.dataset.dificuldade,
          passos: serviceSteps,
          provaDescricao: document.getElementById("proofDescription").value.trim(),
          provaTipoImagem: document.getElementById("proofImage").checked,
          provaTipoTexto: document.getElementById("proofText").checked,
          status: "ativo",
          // Novos campos de contabilização
          fee: totalFee,
          grossCost: grossCost,
          finalCost: finalCost,
          companyShare: companyShare,
          bcShare: bcShare,
          criadoEm: firebase.firestore.FieldValue.serverTimestamp()
      };

      try {
          await db.runTransaction(async (t) => {
              const userWalletRef = db.collection('wallets').doc(user.uid);
              // Coleção de Empresas: migrando para 'companies' (usando currentCompanyId como ID do documento)
              const empresaRef = db.collection('companies').doc(currentCompanyId);
              // Coleção do Banco Central: doc único 'reserve'
              const bcRef = db.collection('bankCentral').doc('reserve');
              const serviceRef = db.collection('services').doc(); // Novo documento de serviço

              // 1. Verificar Saldo
              const walletDoc = await t.get(userWalletRef);
              if (!walletDoc.exists) throw new Error('Carteira do usuário não encontrada.');

              const currentGoldsBalance = walletDoc.data().goldsBalance || 0;
              if (currentGoldsBalance < finalCost) {
                  throw new Error('Saldo insuficiente para esta publicação.');
              }

              // 2. Débito do Usuário (Atomicamente)
              const transactionData = {
                  type: 'debit',
                  amount: finalCost,
                  currency: 'golds',
                  description: `Publicação de serviço (${currentMode}): ${selectedOption.value}`,
                  companyShare: companyShare, // Para auditoria
                  bcShare: bcShare,           // Para auditoria
                  date: new Date().toISOString(),
                  serviceId: serviceRef.id
              };
              t.update(userWalletRef, {
                  goldsBalance: currentGoldsBalance - finalCost,
                  transactions: firebase.firestore.FieldValue.arrayUnion(transactionData)
              });

await db.runTransaction(async (t) => {
    // 1. Ler todos os documentos necessários primeiro
    const empresaDoc = await t.get(empresaRef);
    const bcDoc = await t.get(bcRef);
    
    // 2. Extrair os dados da empresa
    const empresaGolds = (empresaDoc.exists && empresaDoc.data().goldsEmpresa) || 0;
    const publishedCount = (empresaDoc.exists && empresaDoc.data().published) || 0;
    const activeCount = (empresaDoc.exists && empresaDoc.data().active) || 0;
    const ownerUserId = empresaDoc.exists ? empresaDoc.data().ownerUserId : user.uid;
    
    // 3. Extrair os dados do Banco Central
    const bcReserve = (bcDoc.exists && bcDoc.data().reserve) || 0;
    
    // 4. Fazer todas as escritas após as leituras
    if (companyShare > 0) {
        t.set(empresaRef, {
            goldsEmpresa: empresaGolds + companyShare,
            published: publishedCount + 1,
            active: activeCount + 1,
            ownerUserId: ownerUserId
        }, { merge: true });
    }
    
    t.set(bcRef, {
        reserve: bcReserve + bcShare,
        lastUpdate: firebase.firestore.FieldValue.serverTimestamp()
    }, { merge: true });
});
              
              // 5. Criação do Serviço (Atomicamente)
              // Aqui o serviceCard anterior é substituído pela criação do 'service' (melhorado)
              t.set(serviceRef, serviceData);
          });

          showNotification("Serviço publicado com sucesso! Contabilização e taxas aplicadas (BC/Empresa).");
          closeModal();
          carregarDadosCards();
          carregarEstatisticasServicos();

      } catch (error) {
          console.error("❌ Erro na transação de publicação:", error.message || error);
          showNotification(`Erro ao publicar serviço: ${error.message || 'Falha na transação.'}`);
          // Se falhar, o Firestore faz o rollback.
      }
  }

  // Funções restantes (mantidas) ...

  // Função para carregar estatísticas dos serviços publicados (mantido)
  async function carregarEstatisticasServicos() {
      const user = auth.currentUser;
      if (!user) return;
      const cardIds = [
          "facebook", "instagram", "mobile", "telegram",
          "tiktok", "video", "discord", "blog", "reddit", "seo", "inscricoes"
      ];
      for (const cardId of cardIds) {
          // Carrega serviços empresariais
          const empresarialSnapshot = await db.collection("services")
              .where("userId", "==", user.uid)
              .where("empresaId", "==", cardId)
              .where("modo", "==", "empresarial")
              .get();
          let empresarialPublished = 0;
          let empresarialActive = 0;
          let empresarialPending = 0;
          empresarialSnapshot.forEach(doc => {
              const data = doc.data();
              empresarialPublished++;
              if (data.status === "ativo") empresarialActive++;
              if (data.status === "pendente") empresarialPending++;
          });
          // Atualiza UI empresarial
          const publishedEl = document.getElementById(`${cardId}-published`);
          const activeEl = document.getElementById(`${cardId}-active`);
          const pendingEl = document.getElementById(`${cardId}-pending`);
          if (publishedEl) publishedEl.textContent = empresarialPublished;
          if (activeEl) activeEl.textContent = empresarialActive;
          if (pendingEl) pendingEl.textContent = empresarialPending;
          // Carrega serviços pessoais
          const pessoalSnapshot = await db.collection("services")
              .where("userId", "==", user.uid)
              .where("empresaId", "==", cardId)
              .where("modo", "==", "pessoal")
              .get();
          let pessoalPublished = 0;
          let pessoalActive = 0;
          let pessoalPending = 0;
          pessoalSnapshot.forEach(doc => {
              const data = doc.data();
              pessoalPublished++;
              if (data.status === "ativo") pessoalActive++;
              if (data.status === "pendente") pessoalPending++;
          });
          // Atualiza UI pessoal
          const publishedElPessoal = document.getElementById(`${cardId}-published-pessoal`);
          const activeElPessoal = document.getElementById(`${cardId}-active-pessoal`);
          const pendingElPessoal = document.getElementById(`${cardId}-pending-pessoal`);
          if (publishedElPessoal) publishedElPessoal.textContent = pessoalPublished;
          if (activeElPessoal) activeElPessoal.textContent = pessoalActive;
          if (pendingElPessoal) pendingElPessoal.textContent = pessoalPending;
      }
  }

  // Função para carregar dados do usuário (mantido)
  function carregarDadosUsuario(user) {
      const userId = user.uid;
      db.collection("wallets").doc(userId).get()
          .then(doc => {
              if (doc.exists) {
                  const data = doc.data();
                  walletData = { ...data, id: userId };
                  document.getElementById("footerUserName").textContent = data.name || "Usuário";
                  document.getElementById("footerUserId").textContent = userId;
              } else {
                  document.getElementById("footerUserName").textContent = "Usuário";
                  document.getElementById("footerUserId").textContent = userId;
              }
              carregarDadosCards();
              carregarEstatisticasServicos();
          })
          .catch(error => {
              console.error("❌ Erro ao carregar dados:", error);
              document.getElementById("footerUserName").textContent = "Usuário";
              document.getElementById("footerUserId").textContent = userId;
              carregarDadosCards();
              carregarEstatisticasServicos();
          });
  }

  // Função para visualizar serviços publicados (Modo Empresarial) (mantido)
  function viewServices(companyId) {
    const user = auth.currentUser;
    if (!user) {
      showNotification("Usuário não autenticado!");
      return;
    }
    window.location.href = `servicos.html?empresa=${encodeURIComponent(companyId)}&modo=empresarial`;
  }

  // NOVO: Função para visualizar serviços publicados (Modo Pessoal) (mantido)
  async function viewUserServices(companyId) {
      const user = auth.currentUser;
      if (!user) {
          showNotification("Usuário não autenticado!");
          return;
      }

      try {
          const servicesSnapshot = await db.collection("services")
              .where("userId", "==", user.uid)
              .where("empresaId", "==", companyId)
              .where("modo", "==", "pessoal")
              .get();

          let html = `
        <h2><i class="fas fa-eye"></i> Seus Serviços Publicados (${companyId})</h2>
        <p style="margin-bottom: 1rem;">Aqui estão todos os serviços pessoais que você publicou.</p>
      `;

          if (servicesSnapshot.empty) {
              html += `
          <p>Nenhum serviço publicado ainda.</p>
          <p style="font-size: 0.85rem; color: var(--text-secondary);">
            Publique um novo serviço no Modo Pessoal para vê-lo aqui.
          </p>
        `;
          } else {
              servicesSnapshot.forEach(doc => {
                  const data = doc.data();
                  html += `
            <div class="service-card" style="
              background: var(--surface);
              padding: 12px;
              border-radius: 10px;
              margin-bottom: 10px;
              box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            ">
              <h4 style="margin-bottom: 4px;">${escapeHtml(data.nome || '')}</h4>
              <p style="font-size: 0.9rem; margin-bottom: 6px;">${escapeHtml(data.descricao || '')}</p>
              <span style="font-size: 0.8rem; color: var(--text-secondary);">Status: ${escapeHtml(data.status || '—')}</span>
              <div style="margin-top: 10px;">
                <button style="background: var(--secondary); color: white; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; margin-right: 5px;"
                  onclick="editService('${doc.id}')">
                  <i class="fas fa-edit"></i> Editar
                </button>
                <button style="background: var(--accent); color: white; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer;"
                  onclick="deleteService('${doc.id}')">
                  <i class="fas fa-trash"></i> Excluir
                </button>
              </div>
            </div>
          `;
              });
          }

          showSimpleModal("Serviços Publicados", html);

      } catch (error) {
          console.error("Erro ao carregar serviços pessoais:", error);
          showNotification("Erro ao carregar serviços publicados.");
      }
  }

  // Função auxiliar simples para evitar injeção de HTML no modal (mantido)
  function escapeHtml(str) {
      return String(str)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
  }

  // STUBs (mantido)
  function editService(serviceId) {
      showNotification("Abrir edição para serviço: " + serviceId);
  }

  // Exclui o serviço do Firestore (mantido)
  async function deleteService(serviceId) {
      if (!confirm("Deseja realmente excluir este serviço?")) return;
      try {
          await db.collection("services").doc(serviceId).delete();
          showNotification("Serviço excluído com sucesso.");
      } catch (err) {
          console.error("Erro ao excluir serviço:", err);
          showNotification("Erro ao excluir serviço.");
      }
  }

  function simulateAction(action, companyId) {
      showNotification(`Ação simulada: ${action} para ${companyId} (Modo Pessoal)`);
  }

  // Função utilitária para mostrar um modal simples (mantido)
  function showSimpleModal(title, content) {
      const modal = document.getElementById("guidedPublishModal");
      const modalContent = document.getElementById("modalContent");

      for(let i = 1; i <= totalSteps; i++) {
        const stepElement = document.getElementById(`step-${i}`);
        if(stepElement) {
            stepElement.classList.remove('active', 'fade-in-step');
        }
      }
      document.querySelector('.step-navigation').style.display = 'none';
      document.querySelector('.step-indicator').style.display = 'none';

      document.getElementById("modalTitle").textContent = title;
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = content;
      modalContent.prepend(tempDiv);

      modalContent.style.height = 'auto';
      modal.classList.add("active");

      const closeBtn = modalContent.querySelector('.close');
      closeBtn.onclick = () => {
          modal.classList.remove("active");
          tempDiv.remove();
          document.querySelector('.step-navigation').style.display = 'flex';
          document.querySelector('.step-indicator').style.display = 'block';
      };

      document.getElementById("modalTitle").textContent = title;
      modal.classList.add("active");
      setTimeout(() => modalContent.style.height = '350px', 50);
  }

  // Função para exibir notificações (mantido)
  function showNotification(message) {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.classList.add('show');
    setTimeout(() => {
      notification.classList.remove('show');
    }, 3000);
  }

  // Funções para os botões dos cards (mantido)
  function contratar(cardId) {
    const card = document.querySelector(`[data-card-id="${cardId}"]`);
    const title = card.querySelector('h3')?.textContent || 'card';
    openPublishModal(cardId, title, 'empresarial');
  }

  function executarMissoes(cardId) {
    const card = document.querySelector(`[data-card-id="${cardId}"]`);
    const title = card.querySelector('h3')?.textContent || 'card';
    showNotification(`Executando missões em ${title}... (simulado)`);
  }

  // Função para determinar o nível global com base nos Golds (mantido)
  function determinarNivelGlobal(cardId, golds) {
    const niveis = niveisGlobais[cardId] || [];
    let nivelAtual = niveis[0];
    let proximaMeta = niveis[0].golds;
    for (let i = niveis.length - 1; i >= 0; i--) {
      if (golds >= niveis[i].golds) {
        nivelAtual = niveis[i];
        proximaMeta = i < niveis.length - 1 ? niveis[i + 1].golds : niveis[i].golds;
        break;
      }
    }
    return { nivelAtual, proximaMeta };
  }

  // Função para atualizar progresso e nível de um card específico (mantido)
  function atualizarProgressoDoCard(cardId, golds, metricValue) {
    // Empresarial
    const { nivelAtual, proximaMeta } = determinarNivelGlobal(cardId, golds);
    const percentual = Math.min((Number(golds) / proximaMeta) * 100, 100);
    const fillEl = document.getElementById(`${cardId}-progress`);
    const textEl = document.getElementById(`${cardId}-progress-text`);
    const nivelEl = document.getElementById(`${cardId}-nivel`);
    const goldsEl = document.getElementById(`${cardId}-golds`);
    const metricEl = document.getElementById(`${cardId}-${cardId === 'facebook' || cardId === 'instagram' ? 'seguidores' :
                                                    cardId === 'mobile' ? 'instalacoes' :
                                                    cardId === 'telegram' ? 'canais' :
                                                    cardId === 'tiktok' ? 'curtidas' :
                                                    cardId === 'video' ? 'campanhas' :
                                                    cardId === 'discord' ? 'servidores' :
                                                    cardId === 'blog' ? 'comentarios' :
                                                    cardId === 'reddit' ? 'upvotes' :
                                                    cardId === 'seo' ? 'palavras' : 'ativas'}`);
    if (fillEl) fillEl.style.width = `${percentual}%`;
    if (textEl) textEl.textContent = `${formatGold(golds)} / ${formatGold(proximaMeta)}`;
    if (nivelEl) nivelEl.textContent = nivelAtual.nome;
    if (goldsEl) goldsEl.textContent = formatGold(golds);
    if (metricEl && metricValue !== undefined) metricEl.textContent = formatGold(metricValue, false);

    // Pessoal
    const fillElPessoal = document.getElementById(`${cardId}-progress-pessoal`);
    const textElPessoal = document.getElementById(`${cardId}-progress-text-pessoal`);
    const nivelElPessoal = document.getElementById(`${cardId}-nivel-pessoal`);
    const goldsElPessoal = document.getElementById(`${cardId}-golds-pessoal`);
    const metricElPessoal = document.getElementById(`${cardId}-${cardId === 'facebook' || cardId === 'instagram' ? 'seguidores' :
                                                    cardId === 'mobile' ? 'instalacoes' :
                                                    cardId === 'telegram' ? 'canais' :
                                                    cardId === 'tiktok' ? 'curtidas' :
                                                    cardId === 'video' ? 'campanhas' :
                                                    cardId === 'discord' ? 'servidores' :
                                                    cardId === 'blog' ? 'comentarios' :
                                                    cardId === 'reddit' ? 'upvotes' :
                                                    cardId === 'seo' ? 'palavras' : 'ativas'}-pessoal`);

    if (fillElPessoal) fillElPessoal.style.width = `${percentual}%`;
    if (textElPessoal) textElPessoal.textContent = `${formatGold(golds)} / ${formatGold(proximaMeta)}`;
    if (nivelElPessoal) nivelElPessoal.textContent = nivelAtual.nome;
    if (goldsElPessoal) goldsElPessoal.textContent = formatGold(golds);
    if (metricElPessoal && metricValue !== undefined) metricElPessoal.textContent = formatGold(metricValue, false);
  }

  // Função para carregar dados dos cards (AJUSTADO: LER 'companies' em vez de 'serviceCards')
  function carregarDadosCards() {
    const cardIds = [
      "facebook", "instagram", "mobile", "telegram",
      "tiktok", "video", "discord", "blog", "reddit", "seo", "inscricoes"
    ];
    cardIds.forEach(cardId => {
      // AJUSTE: Lendo da coleção 'companies' e usando 'goldsEmpresa'
      db.collection("companies").doc(cardId).onSnapshot((doc) => {
        if (doc.exists) {
          const data = doc.data();
          // NOVO CAMPO: goldsEmpresa
          const golds = data.goldsEmpresa || 0; 
          const metricKey = cardId === 'facebook' || cardId === 'instagram' ? 'seguidores' :
                         cardId === 'mobile' ? 'instalacoes' :
                         cardId === 'telegram' ? 'canais' :
                         cardId === 'tiktok' ? 'curtidas' :
                         cardId === 'video' ? 'campanhas' :
                         cardId === 'discord' ? 'servidores' :
                         cardId === 'blog' ? 'comentarios' :
                         cardId === 'reddit' ? 'upvotes' :
                         cardId === 'seo' ? 'palavras' : 'ativas';
          const metricValue = data[metricKey] || 0;
          atualizarProgressoDoCard(cardId, golds, metricValue);
        } else {
          // Se não existir na coleção 'companies', tenta carregar de 'serviceCards' (apenas para exibição legada)
          db.collection("serviceCards").doc(cardId).get().then(snap => {
            if(snap.exists) {
              const data = snap.data();
              const golds = (data.golds || 0) + (data.fee || 0); // Lógica antiga de progresso
              atualizarProgressoDoCard(cardId, golds, 0);
            } else {
              atualizarProgressoDoCard(cardId, 0, 0);
            }
          });
        }
      }, (err) => {
        console.error("Erro onSnapshot:", err);
      });
    });
  }

  // Controle do carrossel com toque (mantido)
  let currentCardEmpresarial = 0;
  const carouselEmpresarial = document.getElementById('company-carousel-empresarial');
  const cardsEmpresarial = carouselEmpresarial.querySelectorAll('.nav-card');
  const totalCardsEmpresarial = cardsEmpresarial.length;
  let currentCardPessoal = 0;
  const carouselPessoal = document.getElementById('company-carousel-pessoal');
  const cardsPessoal = carouselPessoal.querySelectorAll('.nav-card');
  const totalCardsPessoal = cardsPessoal.length;
  let touchStartX = 0;
  let touchEndX = 0;

  function updateCarousel() {
    const firstCardEmpresarial = carouselEmpresarial.querySelector('.nav-card');
    if (firstCardEmpresarial) {
        const widthEmpresarial = firstCardEmpresarial.offsetWidth + 12;
        carouselEmpresarial.style.transform = `translateX(-${currentCardEmpresarial * widthEmpresarial}px)`;
    }
    const firstCardPessoal = carouselPessoal.querySelector('.nav-card');
    if (firstCardPessoal) {
        const widthPessoal = firstCardPessoal.offsetWidth + 12;
        carouselPessoal.style.transform = `translateX(-${currentCardPessoal * widthPessoal}px)`;
    }
  }

  // Event listeners para o carrossel (mantido)
  carouselEmpresarial.addEventListener('touchstart', (e) => {
    touchStartX = e.changedTouches[0].screenX;
  });

  carouselEmpresarial.addEventListener('touchend', (e) => {
    touchEndX = e.changedTouches[0].screenX;
    const swipeDistance = touchEndX - touchStartX;
    if (swipeDistance > 50 && currentCardEmpresarial > 0) {
      currentCardEmpresarial--;
    } else if (swipeDistance < -50 && currentCardEmpresarial < totalCardsEmpresarial - 1) {
      currentCardEmpresarial++;
    }
    updateCarousel();
  });

  carouselPessoal.addEventListener('touchstart', (e) => {
    touchStartX = e.changedTouches[0].screenX;
  });

  carouselPessoal.addEventListener('touchend', (e) => {
    touchEndX = e.changedTouches[0].screenX;
    const swipeDistance = touchEndX - touchStartX;
    if (swipeDistance > 50 && currentCardPessoal > 0) {
      currentCardPessoal--;
    } else if (swipeDistance < -50 && currentCardPessoal < totalCardsPessoal - 1) {
      currentCardPessoal++;
    }
    updateCarousel();
  });

  // Carrega dados do usuário e verifica autenticação (mantido)
  document.addEventListener('DOMContentLoaded', () => {
    auth.onAuthStateChanged(user => {
      if (user) {
        carregarDadosUsuario(user);
      } else {
        document.getElementById("footerUserName").textContent = "Nenhum usuário ativo";
        document.getElementById("footerUserId").textContent = "---";
        window.location.href = "cadastro.html";
      }
    });

    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body;
    themeToggle.addEventListener('click', () => {
      const currentTheme = body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      body.setAttribute('data-theme', currentTheme);
      localStorage.setItem('theme', currentTheme);
    });

    const savedTheme = localStorage.getItem('theme') || 'light';
    body.setAttribute('data-theme', savedTheme);

    const menuToggles = {
      'menu-icon': 'main-menu'
    };

    Object.entries(menuToggles).forEach(([toggleId, menuId]) => {
      const toggle = document.getElementById(toggleId);
      const menu = document.getElementById(menuId);
      if (!toggle || !menu) {
        console.error(`Elemento ${toggleId} ou ${menuId} não encontrado`);
        return;
      }
      toggle.addEventListener('click', e => {
        e.stopPropagation();
        menu.classList.toggle('open');
        toggle.classList.toggle('active');
      });
    });

    document.addEventListener('click', e => {
      if (!e.target.closest('.menu') && !e.target.closest('.top-bar__icon')) {
        Object.values(menuToggles).forEach(menuId => {
          const menu = document.getElementById(menuId);
          if (menu) menu.classList.remove('open');
        });
        document.querySelectorAll('.top-bar__icon').forEach(icon => {
          if (icon) icon.classList.remove('active');
        });
      }
    });

    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        Object.values(menuToggles).forEach(menuId => {
          const menu = document.getElementById(menuId);
          if (menu) menu.classList.remove('open');
        });
        document.querySelectorAll('.top-bar__icon').forEach(icon => {
          if (icon) icon.classList.remove('active');
        });
        closeModal();
      }
    });

    document.getElementById("logout-button").addEventListener("click", () => {
      auth.signOut().then(() => window.location.href = "cadastro.html");
    });

    const cookieBanner = document.getElementById('cookieBanner');
    const cookieAccept = document.getElementById('cookie-accept');
    const cookieDecline = document.getElementById('cookie-decline');

    function showCookieBannerOncePerDay() {
      const today = new Date().toISOString().split('T')[0];
      const lastShown = localStorage.getItem('cookieBannerLastShown');
      if (lastShown !== today) {
        cookieBanner.classList.add('active');
        localStorage.setItem('cookieBannerLastShown', today);
      }
    }

    showCookieBannerOncePerDay();

    cookieAccept.addEventListener('click', () => {
      cookieBanner.classList.remove('active');
    });

    cookieDecline.addEventListener('click', () => {
      cookieBanner.classList.remove('active');
    });

    window.addEventListener('resize', updateCarousel);

    setTimeout(updateCarousel, 100);

    // Adiciona event listeners para os inputs da Etapa 1 e 2
    document.getElementById("subcategory").addEventListener("change", calculateDifficultyAndProof);
    document.getElementById("freelancers").addEventListener("input", prepareSummary);
    document.getElementById("serviceStepsContainer").addEventListener("input", prepareSummary);
  });
  function navigateTo(page) {
    let url;
    switch (page) {
        case 'home':
            url = 'index.html';
            break;
        case 'yshippcommerce':
            url = 'yshippcommerce.html';
            break;
        case 'market':
            url = 'https://linkpremiado51-cmd.github.io/yshippcommerce/mercado.html';
            break;
        case 'store':
            url = 'store.html';
            break;
        case 'generator':
            url = 'https://linkpremiado51-cmd.github.io/yshippcommerce/gerador.html';
            break;
        case 'wallet':
            url = 'https://linkpremiado51-cmd.github.io/yshippcommerce/carteira.html';
            break;
        default:
            url = 'index.html';
            break;
    }
    window.location.href = url;
  }
// 🌐 Função pública (mantida)
async function viewPublicServices() {
    try {
        const snapshot = await db.collection("services")
            .where("status", "==", "ativo")
            .get();
        
        let html = `
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h2><i class="fas fa-store"></i> Mercado de Serviços</h2>
        <button class="btn ghost" onclick="closeModal()">Fechar</button>
      </div>
      <p style="margin-bottom:1rem;color:var(--text-secondary);">
        Aqui estão todos os serviços publicados no sistema que você pode executar e ganhar Golds.
      </p>
    `;
        
        if (snapshot.empty) {
            html += `<p>Nenhum serviço disponível no momento. Volte mais tarde.</p>`;
        } else {
            snapshot.forEach(doc => {
                const data = doc.data();
                html += `
          <div class="service-card" style="
            background: var(--surface);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
          ">
            <h3>${data.nome || "(Sem título)"}</h3>
            <p style="font-size:0.9rem;">${data.descricao || "Sem descrição disponível."}</p>
            <div style="font-size:0.85rem;margin-top:6px;">
              <span>Empresa: ${data.empresa || "Independente"}</span><br>
              <span>Recompensa: ${data.recompensa || 0} Golds</span>
            </div>
            <div style="margin-top:10px;">
              <button style="background: var(--primary); color: white; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer;"
                onclick="applyForService('${doc.id}', '${data.nome || ""}')">
                <i class="fas fa-hand-pointer"></i> Executar Missão
              </button>
            </div>
          </div>
        `;
            });
        }
        
        showSimpleModal("Mercado de Serviços", html);
    } catch (error) {
        console.error("Erro ao carregar serviços públicos:", error);
        showNotification("Erro ao carregar o mercado de serviços.");
    }
}

// ✋ Função simulada para aplicar em um serviço (mantida)
async function applyForService(serviceId, serviceName) {
    const user = auth.currentUser;
    if (!user) return showNotification("Você precisa estar autenticado para executar serviços.");
    
    showNotification(`Você iniciou a missão: ${serviceName}. (Integração com execução real será implementada depois.)`);
}
</script>

</body>
</html>
